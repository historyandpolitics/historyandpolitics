$(window).load(function(){var theme=PageData.theme_format;if(theme=='sulu'){var total_car_num=7;var next_car_num=1;var car_speed=3200;total_car_num=$(".hover_post").length;$("#carousel_slides").css("width",100*total_car_num+"%").find(".overlay_post").css("width",100/7+"%");window.carousel=setInterval(move_carousel,car_speed);function move_carousel(){var w=$("#ft_main").outerWidth();$("#carousel_slides").css("left",w*next_car_num*-1);$(".slide_btn").removeClass("active");$(".slide_btn:eq("+next_car_num+")").addClass("active");next_car_num++;if(next_car_num==total_car_num){next_car_num=0;}}
$(".slide_btn").click(function(){var i=$(this).attr("slide");next_car_num=i;window.clearInterval(carousel);move_carousel();carousel=setInterval(move_carousel,car_speed);});$(".nav_trigger").on('click',function(e){e.preventDefault();if($(".bottom_nav_list").hasClass('is_visible')){$(".bottom_nav_list").removeClass('is_visible');}else{$(".bottom_nav_list").addClass('is_visible');}
$(this).toggleClass('menu_is_open');});}else{if(theme=='arcadia'||theme=='nova'){header_img_size();$(".category_toggle").click(function(e){e.stopPropagation();$(".header_categories").toggleClass("open");if($(".header_categories").hasClass("open")){$(".category_toggle .icon").addClass("open");}else{$(".category_toggle .icon").removeClass("open");}});$(document).click(function(){if($(".header_categories").hasClass("open")){$(".header_categories, .category_toggle .icon").removeClass("open");}});}else if(theme=='inspire'){$(".nav_trigger").on('click',function(e){e.preventDefault();if($(".bottom_nav_list").hasClass('is_visible')){$(".bottom_nav_list").removeClass('is_visible');}else{$(".bottom_nav_list").addClass('is_visible');}
$(this).toggleClass('menu_is_open');});$(".header_row_1 .nav_trigger").on('click',function(e){if($(this).hasClass('menu_is_open')){$(".menu_wrap").addClass("menu_open");$(".category_toggle").addClass("open");}else{$(".menu_wrap").removeClass("menu_open");$(".category_toggle").removeClass("open");}});$(".menu_wrap .menu_link").on('click',function(e){$(".menu_wrap").removeClass("menu_open");});$(".search_toggle").on('click',function(){if($(this).hasClass("shown")){$(this).removeClass("shown");$(".search_posts").removeClass("shown");}else{$(this).addClass("shown");$(".search_posts").addClass("shown");$(".search_input").focus();}});$(".search_btn").on('click',function(e){e.stopPropagation();if(!($(".search_input").val().trim()==="")){window.location="?search="+$(".search_input").val().trim();}else{}});$(".search_input").keypress(function(e){if(e.keyCode==13){var searchq=$(this).val().trim();if(!($(this).val().trim()==="")){window.location="?search="+$(".search_input").val().trim();}}});}else if(theme=='nest'||theme=='collage'||theme=='hambur'){$(".nav_trigger").on('click',function(e){e.preventDefault();if($(".bottom_nav_list").hasClass('is_visible')){$(".bottom_nav_list").removeClass('is_visible');}else{$(".bottom_nav_list").addClass('is_visible');}
$(this).toggleClass('menu_is_open');});$(".header_row_1 .nav_trigger").on('click',function(e){if($(this).hasClass('menu_is_open')){$(".menu_wrap").addClass("menu_open");$(".category_toggle").addClass("open");}else{$(".menu_wrap").removeClass("menu_open");$(".category_toggle").removeClass("open");}});$(".menu_wrap .menu_link").on('click',function(e){$(".menu_wrap").removeClass("menu_open");});}else if(theme=='titan'){$(".search_btn").on('click',function(e){e.stopPropagation();if(!$(".search_input").hasClass("shown")){$(".search_input").addClass("shown").focus();}else{if(!($(".search_input").val().trim()==="")){$(".search_btn").addClass("clicked");window.location="?search="+$(".search_input").val().trim();}else{}}});$(".search_input").on('click',function(e){e.stopPropagation();});$(".search_form").submit(function(e){e.preventDefault();});$(".search_input").keypress(function(e){if(e.keyCode==13){var searchq=$(this).val().trim();if(!($(this).val().trim()==="")){window.location="?search="+$(".search_input").val().trim();}}});$(document).click(function(){if($(".search_input").hasClass("shown")){$(".search_input").removeClass("shown");}});}
var side_gall_pos,w=$(window);$(window).scroll(function(){if(theme=='arcadia'){if($(".rect_side:first").length){side_gall_pos=$(".rect_side:first").offset().top;}}else if(theme=='inspire'){if($("h3.trending").length){side_gall_pos=$("h3.trending").offset().top;}}else if(theme=='nest'){if($(".overlay_post_wrapper:first").length){side_gall_pos=$(".overlay_post_wrapper:first").offset().top;}}else if(theme=='nova'){if($(".rect_side:first").length){side_gall_pos=$(".rect_side:first").offset().top;}}else if(theme=='titan'||theme=='collage'||theme=='hambur'){if($(".overlay_post_wrapper:first").length){side_gall_pos=$(".overlay_post_wrapper:first").offset().top;}}
if(!PageData.MOBILE){var position=side_gall_pos-w.scrollTop();if(position<0){if(!$(".subscribe_option").hasClass("fixed_pos")){$(".subscribe_option").addClass("fixed_pos");$("#right_col").addClass("subscribe_fixed");}}else{if($(".subscribe_option").hasClass("fixed_pos")){$(".subscribe_option").removeClass("fixed_pos");$("#right_col").removeClass("subscribe_fixed");}}}});}});function get_page(tag){if(!PageData.next_page||PageData.next_page===undefined){return;}
var theme=PageData.theme_format;if(theme=='penny'){$("#user_feed_loader").show();var params={'page':PageData.next_page,'per_page':10,'sort':PageData.gallery_sort,'format':'penny',};}else if(theme=='sulu'){$("#loading_row").show();var params={'page':PageData.next_page,'per_page':22,'tag':tag};}else if(theme=='collage'){$("#loading_row").show();var params={'page':PageData.next_page,'per_page':25,'tag':tag,'sort':PageData.gallery_sort};}else{$("#loading_row").show();var params={'page':PageData.next_page,'per_page':20,'tag':tag,'sort':PageData.gallery_sort};}
if(PageData.feed.include_user_id){params.include_user_id=PageData.feed.include_user_id;if(theme=='sulu'){params.sort='new';}}
if(theme!='penny'){if(PageData.MOBILE){params.per_page=10;}}
Api.send_api_request(get_success,"sulu_homepage",params);}
function get_success(data){if(!(data.display_images&&data.display_images.length)){PageData.next_page=undefined;return;}
data.result={};Render.render_get_feed(data);PageData.next_page=(data.next_page&&data.next_page>1)?data.next_page:undefined;if(!PageData.next_page&&PageData.theme_format=='penny'){$('#user_feed_loader').hide();}else if(!PageData.next_page){$('#loading_row').hide();}}
function header_img_size(){var header_img=document.getElementById("small_header_img");if(header_img){img_size=header_img.naturalWidth;}
if(header_img){if(img_size<400){$(".image-container").addClass("small_img");}}}
var JSON;if(!JSON){JSON={};}
(function(){'use strict';function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());function setup_new_fb_js(){$('#homepage_signup_form, #login_dialog_wrapper, #login_dialog_container, #upsell_form, #gallery_homepage_bottom_upsell, #homepage_signup, #landing_content_container, #fl_login_iframe').on({'click':function(e){var redirect_url='';if(typeof PageData!=="undefined"&&!PageData.gallery_homepage){redirect_url=window.location.href;};var $this=$(this);show_signin_spinny($this);fb_login();$.post('//'+window.location.host+'/api/track_event',{path:'fb_login/click'});return false;}},'#signup_fb_button, #signup_fb_button_upsell');$('#common_dialog_wrapper, #verify_profile_wrapper').on({'click':function(e){show_signin_spinny($(this));fb_login(fb_verification_cb,null,fb_verification_cb);$.post('//'+window.location.host+'/api/track_event',{path:'fb_verification/click'});return false;}},'#link_facebook_action');function fb_login(callback,redirect_url,error_callback){var perms="user_friends,email,user_birthday";var pd=window.pass_to_js||window.PageData;if(pd&&pd.experiment_config){if(pd.experiment_config.desktop_fb_permissions){perms=pd.experiment_config.desktop_fb_permissions;}
if(pd.experiment_config.education_work){perms+=','+pd.experiment_config.education_work;}}
redirect_url=redirect_url||'/';$("#feed_example .scrollable").addClass('still');FB.login(function(response){if(response&&response.authResponse){var params={'access_token':response.authResponse.accessToken,'expires':response.authResponse.expires||response.authResponse.expiresIn,'fb_uid':response.authResponse.userID};params.state=$("input[name='referer_url']").val();params.signup_action=$('#signup_action').val();params.in_iframe=$('#signup_in_iframe').val()||'';if(pd.force_stream_partner){params.force_stream_partner="1";}
if(pd.token){params.token=pass_to_js.token;}
xhr=$.ajax({type:"POST",url:'//'+window.location.host+'/api/complete_facebook_login',data:$.param(params),dataType:"json",success:function(data){if(data&&data.success){params=null;if(callback){callback(data);return;}
if(data&&data.oauth_info&&data.oauth_info.new_user){redirect_url=data.redirect_url||'/friends';}
var pass_to_js=window.pass_to_js||PageData;var cd_signup_frame=(window.parent&&pass_to_js&&pass_to_js.cd_signup_iframe);var success_redirect=redirect_url;if(cd_signup_frame){parent.postMessage('likes-success-redirect: '+'http://'+window.location.host+success_redirect,'*');}else{top.location=success_redirect;}}else{if(error_callback){error_callback({'error':(data&&data.oauth_info&&data.oauth_info.errors)?data.oauth_info.errors[0]:"There was a problem signing up with your Facebook account. Please try again!"});return;}
hide_fb_signin_spinny();var gallery_upsell=($("#signup_form_gallery_upsell").length)?true:false;var signup_error_selector=(gallery_upsell)?ERROR_SELECTOR+"_gallery_upsell":ERROR_SELECTOR;render_signin_errors(data&&data.oauth_info&&data.oauth_info.errors||["There was a problem signing up with your Facebook account. Please try again!"]);}},error:function(){$("#feed_example .scrollable").removeClass('still');if(error_callback){error_callback({'error':"There was a problem connecting to our server. Please try again!"});return;}
hide_fb_signin_spinny();render_signin_errors(["There was a problem connecting to our server. Please try again!"]);}});}else{$("#feed_example .scrollable").removeClass('still');if(error_callback){error_callback({'error':"There was a problem connecting to Facebook. Please try again!"});return;}
hide_fb_signin_spinny();render_signin_errors(["There was a problem connecting to Facebook. Please try again!"]);$.post('//'+window.location.host+'/api/track_event',{path:'fb_login/error',fbresponse:JSON.stringify(response)});}},{'scope':perms});}}
$().ready(function(){setup_new_fb_js();});$().ready(function(){$("#update_new_account_info_button").on({'click':function(){var data={'email':$("#email").val(),'name':$("#name").val(),'user_name':$("#user_name").val(),};PageData.save_twitter_user_info(data);}});});;(function($){"use strict";var feature={};feature.fileapi=$("<input type='file'/>").get(0).files!==undefined;feature.formdata=window.FormData!==undefined;$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this;}
var method,action,url,$form=this;if(typeof options=='function'){options={success:options};}
method=this.attr('method');action=this.attr('action');url=(typeof action==='string')?$.trim(action):'';url=url||window.location.href||'';if(url){url=(url.match(/^([^#]+)/)||[])[1];}
options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||'GET',iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options);var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this;}
if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this;}
var traditional=options.traditional;if(traditional===undefined){traditional=$.ajaxSettings.traditional;}
var elements=[];var qx,a=this.formToArray(options.semantic,elements);if(options.data){options.extraData=options.data;qx=$.param(options.data,traditional);}
if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this;}
this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this;}
var q=$.param(a,traditional);if(qx){q=(q?(q+'&'+qx):qx);}
if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+q;options.data=null;}
else{options.data=q;}
var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm();});}
if(options.clearForm){callbacks.push(function(){$form.clearForm(options.includeHidden);});}
if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?'replaceWith':'html';$(options.target)[fn](data).each(oldSuccess,arguments);});}
else if(options.success){callbacks.push(options.success);}
options.success=function(data,status,xhr){var context=options.context||this;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form]);}};var fileInputs=$('input:file:enabled[value]',this);var hasFileInputs=fileInputs.length>0;var mp='multipart/form-data';var multipart=($form.attr('enctype')==mp||$form.attr('encoding')==mp);var fileAPI=feature.fileapi&&feature.formdata;log("fileAPI :"+fileAPI);var shouldUseFrame=(hasFileInputs||multipart)&&!fileAPI;var jqxhr;if(options.iframe!==false&&(options.iframe||shouldUseFrame)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){jqxhr=fileUploadIframe(a);});}
else{jqxhr=fileUploadIframe(a);}}
else if((hasFileInputs||multipart)&&fileAPI){jqxhr=fileUploadXhr(a);}
else{jqxhr=$.ajax(options);}
$form.removeData('jqxhr').data('jqxhr',jqxhr);for(var k=0;k<elements.length;k++)
elements[k]=null;this.trigger('form-submit-notify',[this,options]);return this;function deepSerialize(extraData){var serialized=$.param(extraData).split('&');var len=serialized.length;var result={};var i,part;for(i=0;i<len;i++){part=serialized[i].split('=');result[decodeURIComponent(part[0])]=decodeURIComponent(part[1]);}
return result;}
function fileUploadXhr(a){var formdata=new FormData();for(var i=0;i<a.length;i++){formdata.append(a[i].name,a[i].value);}
if(options.extraData){var serializedData=deepSerialize(options.extraData);for(var p in serializedData)
if(serializedData.hasOwnProperty(p))
formdata.append(p,serializedData[p]);}
options.data=null;var s=$.extend(true,{},$.ajaxSettings,options,{contentType:false,processData:false,cache:false,type:method||'POST'});if(options.uploadProgress){s.xhr=function(){var xhr=jQuery.ajaxSettings.xhr();if(xhr.upload){xhr.upload.onprogress=function(event){var percent=0;var position=event.loaded||event.position;var total=event.total;if(event.lengthComputable){percent=Math.ceil(position/total*100);}
options.uploadProgress(event,position,total,percent);};}
return xhr;};}
s.data=null;var beforeSend=s.beforeSend;s.beforeSend=function(xhr,o){o.data=formdata;if(beforeSend)
beforeSend.call(this,xhr,o);};return $.ajax(s);}
function fileUploadIframe(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var useProp=!!$.fn.prop;var deferred=$.Deferred();if($(':input[name=submit],:input[id=submit]',form).length){alert('Error: Form elements must not have name or id of "submit".');deferred.reject();return deferred;}
if(a){for(i=0;i<elements.length;i++){el=$(elements[i]);if(useProp)
el.prop('disabled',false);else
el.removeAttr('disabled');}}
s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id='jqFormIO'+(new Date().getTime());if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr('name');if(!n)
$io.attr('name',id);else
id=n;}
else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:'absolute',top:'-1000px',left:'-1000px'});}
io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=(status==='timeout'?'timeout':'aborted');log('aborting upload... '+e);this.aborted=1;if(io.contentWindow.document.execCommand){try{io.contentWindow.document.execCommand('Stop');}catch(ignore){}}
$io.attr('src',s.iframeSrc);xhr.error=e;if(s.error)
s.error.call(s.context,xhr,e,status);if(g)
$.event.trigger("ajaxError",[xhr,s,e]);if(s.complete)
s.complete.call(s.context,xhr,e);}};g=s.global;if(g&&0===$.active++){$.event.trigger("ajaxStart");}
if(g){$.event.trigger("ajaxSend",[xhr,s]);}
if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--;}
deferred.reject();return deferred;}
if(xhr.aborted){deferred.reject();return deferred;}
sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+'.x']=form.clk_x;s.extraData[n+'.y']=form.clk_y;}}}
var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=frame.contentWindow?frame.contentWindow.document:frame.contentDocument?frame.contentDocument:frame.document;return doc;}
var csrf_token=$('meta[name=csrf-token]').attr('content');var csrf_param=$('meta[name=csrf-param]').attr('content');if(csrf_param&&csrf_token){s.extraData=s.extraData||{};s.extraData[csrf_param]=csrf_token;}
function doSubmit(){var t=$form.attr('target'),a=$form.attr('action');form.setAttribute('target',id);if(!method){form.setAttribute('method','POST');}
if(a!=s.url){form.setAttribute('action',s.url);}
if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});}
if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT);},s.timeout);}
function checkState(){try{var state=getDoc(io).readyState;log('state = '+state);if(state&&state.toLowerCase()=='uninitialized')
setTimeout(checkState,50);}
catch(e){log('Server abort: ',e,' (',e.name,')');cb(SERVER_ABORT);if(timeoutHandle)
clearTimeout(timeoutHandle);timeoutHandle=undefined;}}
var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){if(s.extraData.hasOwnProperty(n)){if($.isPlainObject(s.extraData[n])&&s.extraData[n].hasOwnProperty('name')&&s.extraData[n].hasOwnProperty('value')){extraInputs.push($('<input type="hidden" name="'+s.extraData[n].name+'">').attr('value',s.extraData[n].value).appendTo(form)[0]);}else{extraInputs.push($('<input type="hidden" name="'+n+'">').attr('value',s.extraData[n]).appendTo(form)[0]);}}}}
if(!s.iframeTarget){$io.appendTo('body');if(io.attachEvent)
io.attachEvent('onload',cb);else
io.addEventListener('load',cb,false);}
setTimeout(checkState,15);form.submit();}
finally{form.setAttribute('action',a);if(t){form.setAttribute('target',t);}else{$form.removeAttr('target');}
$(extraInputs).remove();}}
if(s.forceSync){doSubmit();}
else{setTimeout(doSubmit,10);}
var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return;}
try{doc=getDoc(io);}
catch(ex){log('cannot access response document: ',ex);e=SERVER_ABORT;}
if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort('timeout');deferred.reject(xhr,'timeout');return;}
else if(e==SERVER_ABORT&&xhr){xhr.abort('server abort');deferred.reject(xhr,'error','server abort');return;}
if(!doc||doc.location.href==s.iframeSrc){if(!timedOut)
return;}
if(io.detachEvent)
io.detachEvent('onload',cb);else
io.removeEventListener('load',cb,false);var status='success',errMsg;try{if(timedOut){throw'timeout';}
var isXml=s.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&window.opera&&(doc.body===null||!doc.body.innerHTML)){if(--domCheckCount){log('requeing onLoad callback, DOM not available');setTimeout(cb,250);return;}}
var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml)
s.dataType='xml';xhr.getResponseHeader=function(header){var headers={'content-type':s.dataType};return headers[header];};if(docRoot){xhr.status=Number(docRoot.getAttribute('status'))||xhr.status;xhr.statusText=docRoot.getAttribute('statusText')||xhr.statusText;}
var dt=(s.dataType||'').toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName('textarea')[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute('status'))||xhr.status;xhr.statusText=ta.getAttribute('statusText')||xhr.statusText;}
else if(scr){var pre=doc.getElementsByTagName('pre')[0];var b=doc.getElementsByTagName('body')[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerText;}
else if(b){xhr.responseText=b.textContent?b.textContent:b.innerText;}}}
else if(dt=='xml'&&!xhr.responseXML&&xhr.responseText){xhr.responseXML=toXml(xhr.responseText);}
try{data=httpData(xhr,dt,s);}
catch(e){status='parsererror';xhr.error=errMsg=(e||status);}}
catch(e){log('error caught: ',e);status='error';xhr.error=errMsg=(e||status);}
if(xhr.aborted){log('upload aborted');status=null;}
if(xhr.status){status=(xhr.status>=200&&xhr.status<300||xhr.status===304)?'success':'error';}
if(status==='success'){if(s.success)
s.success.call(s.context,data,'success',xhr);deferred.resolve(xhr.responseText,'success',xhr);if(g)
$.event.trigger("ajaxSuccess",[xhr,s]);}
else if(status){if(errMsg===undefined)
errMsg=xhr.statusText;if(s.error)
s.error.call(s.context,xhr,status,errMsg);deferred.reject(xhr,'error',errMsg);if(g)
$.event.trigger("ajaxError",[xhr,s,errMsg]);}
if(g)
$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop");}
if(s.complete)
s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)
clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)
$io.remove();xhr.responseXML=null;},100);}
var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s);}
else{doc=(new DOMParser()).parseFromString(s,'text/xml');}
return(doc&&doc.documentElement&&doc.documentElement.nodeName!='parsererror')?doc:null;};var parseJSON=$.parseJSON||function(s){return window['eval']('('+s+')');};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader('content-type')||'',xml=type==='xml'||!type&&ct.indexOf('xml')>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==='parsererror'){if($.error)
$.error('parsererror');}
if(s&&s.dataFilter){data=s.dataFilter(data,type);}
if(typeof data==='string'){if(type==='json'||!type&&ct.indexOf('json')>=0){data=parseJSON(data||"null");}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data);}}
return data;};return deferred;}};$.fn.ajaxForm=function(options){options=options||{};options.delegation=options.delegation&&$.isFunction($.fn.on);if(!options.delegation&&this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log('DOM not ready, queuing ajaxForm');$(function(){$(o.s,o.c).ajaxForm(options);});return this;}
log('terminating; zero elements found by selector'+($.isReady?'':' (DOM not ready)'));return this;}
if(options.delegation){$(document).off('submit.form-plugin',this.selector,doAjaxSubmit).off('click.form-plugin',this.selector,captureSubmittingElement).on('submit.form-plugin',this.selector,options,doAjaxSubmit).on('click.form-plugin',this.selector,options,captureSubmittingElement);return this;}
return this.ajaxFormUnbind().bind('submit.form-plugin',options,doAjaxSubmit).bind('click.form-plugin',options,captureSubmittingElement);};function doAjaxSubmit(e){var options=e.data;if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options);}}
function captureSubmittingElement(e){var target=e.target;var $el=$(target);if(!($el.is(":submit,input:image"))){var t=$el.closest(':submit');if(t.length===0){return;}
target=t[0];}
var form=this;form.clk=target;if(target.type=='image'){if(e.offsetX!==undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY;}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top;}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop;}}
setTimeout(function(){form.clk=form.clk_x=form.clk_y=null;},100);}
$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin');};$.fn.formToArray=function(semantic,elements){var a=[];if(this.length===0){return a;}
var form=this[0];var els=semantic?form.getElementsByTagName('*'):form.elements;if(!els){return a;}
var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue;}
if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val(),type:el.type});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}
continue;}
v=$.fieldValue(el,true);if(v&&v.constructor==Array){if(elements)
elements.push(el);for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]});}}
else if(feature.fileapi&&el.type=='file'&&!el.disabled){if(elements)
elements.push(el);var files=el.files;if(files.length){for(j=0;j<files.length;j++){a.push({name:n,value:files[j],type:el.type});}}
else{a.push({name:n,value:'',type:el.type});}}
else if(v!==null&&typeof v!='undefined'){if(elements)
elements.push(el);a.push({name:n,value:v,type:el.type,required:el.required});}}
if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}}
return a;};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic));};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return;}
var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]});}}
else if(v!==null&&typeof v!='undefined'){a.push({name:this.name,value:v});}});return $.param(a);};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length)){continue;}
if(v.constructor==Array)
$.merge(val,v);else
val.push(v);}
return val;};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true;}
if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1)){return null;}
if(tag=='select'){var index=el.selectedIndex;if(index<0){return null;}
var a=[],ops=el.options;var one=(t=='select-one');var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes['value']&&!(op.attributes['value'].specified))?op.text:op.value;}
if(one){return v;}
a.push(v);}}
return a;}
return $(el).val();};$.fn.clearForm=function(includeHidden){return this.each(function(){$('input,select,textarea',this).clearFields(includeHidden);});};$.fn.clearFields=$.fn.clearInputs=function(includeHidden){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=='textarea'){this.value='';}
else if(t=='checkbox'||t=='radio'){this.checked=false;}
else if(tag=='select'){this.selectedIndex=-1;}
else if(includeHidden){if((includeHidden===true&&/hidden/.test(t))||(typeof includeHidden=='string'&&$(this).is(includeHidden)))
this.value='';}});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType)){this.reset();}});};$.fn.enable=function(b){if(b===undefined){b=true;}
return this.each(function(){this.disabled=!b;});};$.fn.selected=function(select){if(select===undefined){select=true;}
return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio'){this.checked=select;}
else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one'){$sel.find('option').selected(false);}
this.selected=select;}});};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug)
return;var msg='[jquery.form] '+Array.prototype.join.call(arguments,'');if(window.console&&window.console.log){window.console.log(msg);}
else if(window.opera&&window.opera.postError){window.opera.postError(msg);}}})(jQuery);(function($){function maybeCall(thing,ctx){return(typeof thing=='function')?(thing.call(ctx)):thing;};function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;this.fixTitle();};Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).prependTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,gravity=maybeCall(this.options.gravity,this.$element[0]);var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+pos.width/2-15;}else{tp.left=pos.left+pos.width/2-actualWidth+15;}}
$tip.css(tp).addClass('tipsy-'+gravity);$tip.find('.tipsy-arrow')[0].className='tipsy-arrow tipsy-arrow-'+gravity.charAt(0);if(this.options.className){$tip.addClass(maybeCall(this.options.className,this.$element[0]));}
if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity},this.options.fade);}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(this.options.fade,function(){$(this).remove();});}else{this.tip().remove();}},fixTitle:function(){var $e=this.$element;if($e.attr('title')||typeof($e.attr('original-title'))!='string'){$e.attr('original-title',$e.attr('title')||'').removeAttr('title');}},getTitle:function(){var title,$e=this.$element,o=this.options;this.fixTitle();var title,o=this.options;if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){var tipsy=this.data('tipsy');if(tipsy)tipsy[options]();return this;}
if(this.data('tipsy'))return this;options=$.extend({},$.fn.tipsy.defaults,options);if(options.fade===true)options.fade=600;function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{tipsy.fixTitle();setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}};function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}};if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:0.9,title:'title',trigger:'hover'};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};$.fn.tipsy.autoBounds=function(margin,prefer){return function(){var dir={ns:prefer[0],ew:(prefer.length>1?prefer[1]:false)},boundTop=$(document).scrollTop()+margin,boundLeft=$(document).scrollLeft()+margin,$this=$(this);if($this.offset().top<boundTop)dir.ns='n';if($this.offset().left<boundLeft)dir.ew='w';if($(window).width()+$(document).scrollLeft()-$this.offset().left<margin)dir.ew='e';if($(window).height()+$(document).scrollTop()-$this.offset().top<margin)dir.ns='s';return dir.ns+(dir.ew?dir.ew:'');}};})(jQuery);function nicetime(date){if(typeof(date)=='number'){date=new Date(date*1000);}
if(!date)return'';var diff=(((new Date()).getTime()-date.getTime())/1000),day_diff=Math.floor(diff/86400);if(isNaN(day_diff)||day_diff<0)
return'';return day_diff==0&&(diff<5&&"just now"||diff<60&&(Math.floor(diff)+' seconds ago')||diff<120&&"1 minute ago"||diff<3600&&Math.floor(diff/60)+" minutes ago"||diff<7200&&"1 hour ago"||diff<86400&&Math.floor(diff/3600)+" hours ago")||day_diff==1&&"Yesterday"||day_diff<7&&day_diff+" days ago"||day_diff<14&&"1 week ago"||day_diff<30&&Math.floor(day_diff/7)+" weeks ago"||day_diff<60&&"1 month ago"||Math.floor(day_diff/30)+" months ago";}
function format_date(date,format_string){if(typeof(date)=='number'){date=new Date(date*1000);}
if(!date)return'';if(!format_string)format_string="%a %b %d %Y";var mthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var zeroPad=function(number){return("0"+number).substr(-2,2);};var dateMarkers={d:['getDate',function(v){return zeroPad(v)}],m:['getMonth',function(v){return zeroPad(v+1)}],b:['getMonth',function(v){return mthNames[v];}],a:['getDay',function(v){return dayNames[v];}],Y:['getFullYear'],H:['getHours',function(v){return zeroPad(v)}],M:['getMinutes',function(v){return zeroPad(v)}],S:['getSeconds',function(v){return zeroPad(v)}],i:['toISOString']};return format_string.replace(/%(.)/g,function(m,p){var rv=date[(dateMarkers[p])[0]]();if(dateMarkers[p][1]!=null)rv=dateMarkers[p][1](rv);return rv;});}
function nicetime_v2(date){if(typeof(date)=='number'){date=new Date(date*1000);}
var diff=(((new Date()).getTime()-date.getTime())/1000),day_diff=Math.floor(diff/86400);if(day_diff<=365){format_string="%a, %b %d at %H:%M";}else{format_string="%a, %b %d %Y at %H:%M";}
if(day_diff<=1){return nicetime(date);}else{return format_date(date,format_string);}}
function format_number(num,opt_prec){var precision=opt_prec;if(num==parseInt(num)){var rounded=opt_prec?+num.toPrecision(precision):+num;var characters=rounded.toString();var output='';for(var offset=characters.length;offset>0;offset-=3){output=characters.slice(Math.max(offset-3,0),offset)+(output?','+output:'');}
return output;}
if(precision!==undefined&&num)return num.toFixed(precision);return num;}
function format_num_k(num,opt_prec){if(!num&&num!==0)return num;opt_prec=opt_prec||3;num=parseInt(num);if(num<1000)return''+num;if(num<10000)return format_number(num,opt_prec);if(num<1000000){num=+num.toPrecision(opt_prec)/1000;return num+'K';}
num=+num.toPrecision(opt_prec)/1000000;return num+'M';}
function format_duration(duration){if(!duration)return"0:00";duration=parseInt(duration);var mins=parseInt(duration/60);var secs=duration%60;return mins.toString()+':'+(secs<10?'0':'')+secs.toString();}
function pluralize(numbered_string){var pluralize_re=/([0-9]+)( *)([^ ]+)/;var match=pluralize_re.exec(numbered_string);if(!match){return numbered_string;}
match.splice(0,1);if(match[0]!='1'&&match[2][match[2].length-1]!='s'){match.push('s');}
pluralize_re=null;return match.join('');}
function get_params_from_url(url){var query=url.split("?")[1]||'';var param_list=query.split('&');var params={};for(var i=0;i<param_list.length;i++){var param=param_list[i].split('=');if(decodeURIComponent(param[0]).length){params[decodeURIComponent(param[0])]=decodeURIComponent(param[1]);}}
return params;};function add_or_replace_param(url,param_name,param_val){var path=url.split("?")[0];var params=get_params_from_url(url);var added=false;for(var key in params){if(key==param_name&&!added){params[param_name]=param_val;added=true;}}
if(!added&&param_name){params[param_name]=param_val;}
var new_url=path;var first=true;for(var key in params){var param_string=encodeURIComponent(key)+"="+encodeURIComponent(params[key]);if(first){new_url=new_url+"?"+param_string;first=false;}else{new_url=new_url+"&"+param_string;}}
return new_url;}
var GRID_LIST=['50l cb','25','25','25','25','75r cb','25','25','25'],GRID_LIST_MINI=['75l cb','25','25','25','50l cb','50l','75l cb'],MIX_GRID_LIST=['50l cb','25','25','25','25','25 cb','25','50r','25','25'];function grid_size(info){var grid_list=GRID_LIST;var array_length=info.array_length;if(array_length&&array_length<5){if(array_length==1){return'75l';}else if(array_length==2||array_length==4){return'50l';}else if(array_length==3){return info.index<2?'50l':'75l';}else{grid_list=GRID_LIST_MINI;}}
return grid_list[info.index%grid_list.length];}
function grid_size_mix(info){return MIX_GRID_LIST[info.index%MIX_GRID_LIST.length];}
function thumbnail(image_url,size){size=size||'90x90';var MYLIKES_IMAGE_RE=/http:\/\/.*\.cloudfront\.net\/uimg\/[0-9a-f]+$/;if(image_url.match(MYLIKES_IMAGE_RE)){return image_url+'.'+size;}
return image_url;}
function crop(image_url,opt_size){if(!image_url)return image_url;if(!image_url.match(/^http:.*/))return image_url;if(image_url.match(/http:\/\/d2l8ua2kqfocke.cloudfront.net.*/))return image_url;var size=opt_size||'100';return'http://d2l8ua2kqfocke.cloudfront.net/crop?url='+encodeURIComponent(image_url)+'&size='+size;}
var USER_THUMB_CDN='s.likes-media.com';function user_thumb(thumb_key,size){return get_thumb_url(thumb_key,size,USER_THUMB_CDN,'uimg');}
function get_thumb_url(thumb_key,size,cdn,dir_name){if(!thumb_key||thumb_key.match(/^http/)||(thumb_key.length!=32)||!thumb_key.match(/^[0-9a-f]+$/)){return thumb_key?thumb_key:'';}
if(size==null||size==undefined||size.length==0){size='';}else{size='.'+size;}
return'//'+cdn+'/'+dir_name+'/'+thumb_key+size;}
function breakwords(text){if(!text){return text;}
var words=text.split(/ +/);for(var i=0,l=words.length;i<l;i++){if(words[i].length>8){var parts=[];for(var j=0,wl=words[i].length;j<wl;j+=8){parts.push(escapeHTMLMustache(words[i].slice(j,j+8)));}
words[i]=parts.join('&shy;');}else{words[i]=escapeHTMLMustache(words[i]);}}
return words.join(' ');}
var USERNAME_RE=/(.*)@:([0-9]+):([a-zA-Z0-9_]+)(.*)/;function escape_and_link(text){var words=text.split(/ +/);for(var i=0,l=words.length;i<l;i++){var match=USERNAME_RE.exec(words[i]);if(match){words[i]=escapeHTMLMustache(match[1])+'<a class="bright-blue show_hover_card" user_id="'+match[2]+'" href="/'+match[3]+'">@'+match[3]+'</a>'+escapeHTMLMustache(match[4]);}else if(words[i].length>8){var parts=[];for(var j=0,wl=words[i].length;j<wl;j+=8){parts.push(escapeHTMLMustache(words[i].slice(j,j+8)));}
words[i]=parts.join('&shy;');}else{words[i]=escapeHTMLMustache(words[i]);}}
return words.join(' ');}
function get_from_context(contexts,name){if(typeof(contexts)=="object"&&contexts.length==undefined)return contexts[name];for(var i=0;i<contexts.length;i++){if(contexts[i]&&contexts[i][name]!==undefined)return contexts[i][name];}}
function push_context(context,contexts){if(contexts&&Array.isArray(contexts)){var new_contexts=contexts.slice();new_contexts.unshift(context);return new_contexts;}else if(contexts&&typeof(contexts)=="object"){return[context,contexts];}
return[context];}
function increment_forloop(forloop,item){forloop.index++;forloop.counter=forloop.index+1;forloop.first=forloop.index==0;forloop.last=forloop.array_length&&forloop.index==forloop.array_length-1;forloop.even=forloop.counter%2==0;forloop.odd=!forloop.even;forloop.item=item;}
function slice(obj){if(!obj)return obj;var args=Array.prototype.slice.call(arguments,1);return Array.prototype.slice.apply(obj,args);}
function count(obj,word,show_zero){if(obj===undefined)obj=0;var length=(typeof obj!='number')?obj.length:obj;if(length==0&&!show_zero){return'';}
if(!word)return length;return length+' '+word+(length!=1?'s':'');}
var escapeHTMLMustache;function linkify(text,link_class){if(!(text||text.length))return text;link_class=link_class||'blue underline';var link_re=/(?:[A-Za-z]{3,5}:\/\/)(?:[A-Za-z0-9\-]+\.)?(?:[A-Za-z0-9\-]+\.)?(?:[A-Za-z0-9\-]+\.)?[A-Za-z0-9\-]+\.[A-Za-z]{2,3}(?:\/[^\s]+)?/g;function linky(match){return"<a href='"+match+"' target='_blank' onclick='window.open(this.href,'_blank');return false;' class='"+link_class+"'>"+match+"</a>";}
text=escapeHTMLMustache(text);return text.replace(link_re,linky);}
function linkify_tags(text,link_class){if(!(text||text.length))return text;link_class=link_class||'blue grid_tag underline';var tag_re=/#[0-9A-Za-z\-]+/g;function linky(match){return"<a href='/tagged/"+match.substring(1)+"' class='"+link_class+"'>"+match+"</a>";}
return text.replace(tag_re,linky);}
function number(text){return parseInt(text)||0;}
function nopad(url){return(url||'')+'.nopad';}
function noanim(url){return(url||'')+'.noanim';}
function truncate_html(html,opt_length,ellipsis){var len=opt_length||30,ellipsis=ellipsis||'...';var $div=$('<div>'+html+'</div>');if($div.text().length<=len)return html;while($div.text().length>len){html=html.slice(0,html.length-1).replace(/<[^>]*$/,'');$div.html(html);}
return $div.html()+ellipsis;}
var RTL_RE=/[\u0509-\u06ff]/g;function is_rtl(text){if(!text)return false;return RTL_RE.test(text);}
function translation_link(text,target_lang){if(!target_lang)target_lang='en';return"http://translate.google.com/#auto/"+target_lang+"/"+encodeURIComponent(text);}
function message_pic_sizing(message,max_width,max_height){if(!max_width)max_width=250;if(!max_height)max_height=250;if(!message||!message.width||!message.height){return'';}
var width=message['width'],height=message['height'],resize_height,resize_width;resize_width=message['width'];resize_height=message['height'];if(width>max_width){resize_height=max_width*height/width;resize_width=max_width;}
if(resize_height>max_height){resize_width=max_height*width/height;resize_height=max_height;}
return'width: '+resize_width+'px; height: '+resize_height+'px';}
var Mustache=function(){var _toString=Object.prototype.toString;Array.isArray=Array.isArray||function(obj){return _toString.call(obj)=="[object Array]";}
var _trim=String.prototype.trim,trim;if(_trim){trim=function(text){return text==null?"":_trim.call(text);}}else{var trimLeft,trimRight;if((/\S/).test("\xA0")){trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}else{trimLeft=/^\s+/;trimRight=/\s+$/;}
trim=function(text){return text==null?"":text.toString().replace(trimLeft,"").replace(trimRight,"");}}
var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;'};function escapeHTML(string){return String(string).replace(/&(?!\w+;)|[<>\"\']/g,function(s){return escapeMap[s]||s;});}
escapeHTMLMustache=escapeHTML;var regexCache={};var Renderer=function(){};var OPERATE_RE_1=/\|\||&&/;var OPERATE_RE_2=/[<>]|[<>!=]=/;var OPERATE_RE_3=/[+*\/\-%]/;var LITERAL_RE=/^('(\\'|[^'])*'|"(\\"|[^"])*"|-?[0-9\.]+)$/;Renderer.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(template,context,partials,in_recursion){if(!in_recursion){this.context=context;this.buffer=[];}
if(!this.includes("",template)){if(in_recursion){return template;}else{this.send(template);return;}}
template=this.render_pragmas(template);var html=this.render_section(template,context,partials);if(html===false){html=this.render_tags(template,context,partials,in_recursion);}
if(in_recursion){return html;}else{this.sendLines(html);}},send:function(line){if(line!==""){this.buffer.push(line);}},sendLines:function(text){if(text){var lines=text.split("\n");for(var i=0;i<lines.length;i++){this.send(lines[i]);}}},render_pragmas:function(template){if(!this.includes("%",template)){return template;}
var that=this;var regex=this.getCachedRegex("render_pragmas",function(otag,ctag){return new RegExp(otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+ctag,"g");});return template.replace(regex,function(match,pragma,options){if(!that.pragmas_implemented[pragma]){throw({message:"This implementation of mustache doesn't understand the '"+
pragma+"' pragma"});}
that.pragmas[pragma]={};if(options){var opts=options.split("=");that.pragmas[pragma][opts[0]]=opts[1];}
return"";});},render_partial:function(name,context,partials){name=trim(name);if(name.indexOf('var:')===0){name=this.find(name.slice(4),context);}
if(!partials||partials[name]===undefined){throw({message:"unknown_partial '"+name+"'"});}
if(!context||typeof get_from_context(context,name)!="object"){return this.render(partials[name],context,partials,true);}
return this.render(partials[name],push_context(get_from_context(context,name),context),partials,true);},render_section:function(template,context,partials){if(!this.includes("#",template)&&!this.includes("^",template)){return false;}
var that=this;var regex=this.getCachedRegex("render_section",function(otag,ctag){return new RegExp("^([\\s\\S]*?)"+
otag+"(\\^|\\#)\\s*(.+)\\s*"+
ctag+"\n*([\\s\\S]*?)"+
otag+"\\/\\s*\\3\\s*"+
ctag+"\\s*([\\s\\S]*)$","g");});return template.replace(regex,function(match,before,type,name,content,after){var renderedBefore=before?that.render_tags(before,context,partials,true):"",renderedAfter=after?that.render(after,context,partials,true):"",renderedContent,value=that.find(name,context);if(type==="^"){if(!value||Array.isArray(value)&&value.length===0){renderedContent=that.render(content,context,partials,true);}else{renderedContent="";}}else if(type==="#"){if(Array.isArray(value)){var forloop={index:-1,array_length:value.length};renderedContent=that.map(value,function(row){increment_forloop(forloop,row);return that.render(content,that.create_context(row,context,forloop),partials,true);}).join("");}else if(that.is_object(value)){renderedContent=that.render(content,that.create_context(value,context),partials,true);}else if(typeof value=="function"){renderedContent=value.call(context[0],content,function(text){return that.render(text,context,partials,true);});}else if(value){renderedContent=that.render(content,context,partials,true);}else{renderedContent="";}}
return renderedBefore+renderedContent+renderedAfter;});},render_tags:function(template,context,partials,in_recursion){var that=this;var new_regex=function(){return that.getCachedRegex("render_tags",function(otag,ctag){return new RegExp(otag+"(=|!|>|jinja_now>|jinja>|\\{|%)?([^#\\^]+?)\\1?"+ctag+"+","g");});};var regex=new_regex();var tag_replace_callback=function(match,operator,name){switch(operator){case"!":return"";case"=":that.set_delimiters(name);regex=new_regex();return"";case">":return that.render_partial(name,context,partials);case"jinja>":case"jinja_now>":name=name.replace(/ /g,'');var ctx={},min_ctx=0;if(name.indexOf(':')>-1){var parts=name.split(':');name=parts[0];var var_name=parts[1];if(var_name.indexOf('=')>-1){parts=var_name.split('=');var_name=parts[0];ctx[var_name]=that.find(parts[1],context);}else{ctx[var_name]=context[0];min_ctx=1;}}
for(var i=context.length-1;i>=min_ctx;i--){ctx=$.extend(ctx,context[i]);}
return jinja[name.replace(/\.html$/,'')](ctx,true);case"{":return that.find(name,context);default:return escapeHTML(that.find(name,context));}};var lines=template.split("\n");for(var i=0;i<lines.length;i++){lines[i]=lines[i].replace(regex,tag_replace_callback,this);if(!in_recursion){this.send(lines[i]);}}
if(in_recursion){return lines.join("\n");}},set_delimiters:function(delimiters){var dels=delimiters.split(" ");this.otag=this.escape_regex(dels[0]);this.ctag=this.escape_regex(dels[1]);},escape_regex:function(text){if(!arguments.callee.sRE){var specials=['/','.','*','+','?','|','(',')','[',']','{','}','\\'];arguments.callee.sRE=new RegExp('(\\'+specials.join('|\\')+')','g');}
return text.replace(arguments.callee.sRE,'\\$1');},get_filter:function(f_name){var args=[];while(true){var match=f_name.match(/^([^:"]+|"[^"]*?"):(.*)$/);if(!match){args.push(f_name);break;}
args.push(match[1]);f_name=match[2];}
var f_func=Mustache.FILTERS[args[0]];if(args.length>1){return function(m){for(var i=1;i<args.length;i++){if(args[i].match(LITERAL_RE)){args[i]=$.parseJSON(args[i]);}}
args[0]=m;return f_func.apply(this,args);};}
return f_func;},parse_operator_1:function(name,context){var sides=name.split(OPERATE_RE_1);if(sides.length>2){sides=[sides[0],name.slice(sides[0].length+2)];}
var operator=name.match(OPERATE_RE_1)[0];var left=this.find(sides[0],context),right=this.find(sides[1],context);if(operator=='&&')return left&&right;if(operator=='||')return left||right;},parse_operator_2:function(name,context){var sides=name.split(OPERATE_RE_2);var operator=name.match(OPERATE_RE_2)[0];var left=this.find(sides[0],context),right=this.find(sides[1],context);if(operator=='<')return left<right;if(operator=='>')return left>right;if(operator=='<=')return left<=right;if(operator=='>=')return left>=right;if(operator=='==')return left==right;if(operator=='!=')return left!=right;},parse_operator_3:function(name,context){var sides=name.split(OPERATE_RE_3);var operator=name.match(OPERATE_RE_3)[0];var left=this.find(sides[0],context),right=this.find(sides[1],context);if(operator=='+')return left+right;if(operator=='-')return left-right;if(operator=='*')return left*right;if(operator=='/')return left/right;if(operator=='%')return left%right;},find:function(name,context){name=trim(name);if(name.match(LITERAL_RE))return $.parseJSON(name);if(name.match(OPERATE_RE_1))return this.parse_operator_1(name,context);if(name.match(OPERATE_RE_2))return this.parse_operator_2(name,context);if(name.match(OPERATE_RE_3))return this.parse_operator_3(name,context);function is_kinda_truthy(bool){return bool===false||bool===0||bool;}
var value;var filters=[];var parts=name.split('|');name=parts[0];for(var i=1;i<parts.length;i++){filters.push(this.get_filter(parts[i]));}
if(name.match(/([a-z_]+)\./ig)){var childValue=this.walk_context(name,context);if(is_kinda_truthy(childValue)){value=childValue;}}else{if(is_kinda_truthy(get_from_context(context,name))){value=get_from_context(context,name);}}
for(var i=0;i<filters.length;i++){try{value=filters[i](value);}catch(e){console.error("Filter broken: "+filters[i]+" -- "+name+"\n"+e.message+"\n"+e.stack);}}
if(typeof value=="function"){return value.apply(context[0]);}
if(value!==undefined){return value;}
return"";},walk_context:function(name,context){var path=name.split('.');var value_context=context[0];var value=get_from_context(context,path.shift());while(value!==undefined&&value!==null&&path.length>0){value_context=value;value=value[path.shift()];}
if(typeof value=="function"){return value.apply(value_context);}
return value;},includes:function(needle,haystack){return haystack.indexOf(this.otag+needle)!=-1;},create_context:function(_context,contexts,opt_forloop){if(opt_forloop){contexts=push_context({forloop:opt_forloop},contexts);}
if(this.is_object(_context)){return push_context(_context,contexts);}else{var iterator=".";if(this.pragmas["IMPLICIT-ITERATOR"]){iterator=this.pragmas["IMPLICIT-ITERATOR"].iterator;}
var ctx={};ctx[iterator]=_context;return push_context(ctx,contexts);}},is_object:function(a){return a&&typeof a=="object";},map:function(array,fn){if(typeof array.map=="function"){return array.map(fn);}else{var r=[];var l=array.length;for(var i=0;i<l;i++){r.push(fn(array[i]));}
return r;}},getCachedRegex:function(name,generator){var byOtag=regexCache[this.otag];if(!byOtag){byOtag=regexCache[this.otag]={};}
var byCtag=byOtag[this.ctag];if(!byCtag){byCtag=byOtag[this.ctag]={};}
var regex=byCtag[name];if(!regex){regex=byCtag[name]=generator(this.otag,this.ctag);}
return regex;}};return({name:"mustache.js",version:"0.4.0-dev",to_html:function(template,view,partials,send_fun){var renderer=new Renderer();if(send_fun){renderer.send=send_fun;}
renderer.render(template,[view||{}],partials);if(!send_fun){return renderer.buffer.join("\n");}},FILTERS:{truncate:function(m,opt_length){if(m){var length=+opt_length||30;return m.length>length-3?m.substr(0,length-3)+'...':m;}
return m;},truncate_html:truncate_html,length:function(m){if(!m)return 0;if(m.length!==undefined)return m.length;var key_count=0;for(var key in m){if(m.hasOwnProperty(key))key_count++;}
return key_count;},is_context:function(m){return m&&(Array.isArray(m)||typeof m=="object");},is_not_context:function(m){return!Mustache.FILTERS.is_context(m);},quote_plus:function(m){return encodeURIComponent(m).replace(/%20/g,'+');},iter_items:function(m){var items=[];for(var key in m){if(m.hasOwnProperty(key)){items.push([key,m[key]]);}}
return items;},replace:function(m,opt_find,opt_replace){if(opt_find&&opt_replace!==undefined){return m.replace(opt_find,opt_replace);}
return m;},json:function(m){return JSON.stringify(m).replace(/<\//g,'<\\/');},child_tag:function(tag){return(tag.indexOf(':')!==-1)?tag.split(':')[1]:tag;},escape_unsafe_tags:function(text){var WL=new RegExp("<br ?/?>|<b>|</b>|<p>|</p>","ig");var last_index=0;var escaped_text='';text.replace(WL,function(tag,offset,string){escaped_text+=escapeHTMLMustache(text.substring(last_index,offset))+tag;last_index=offset+tag.length;});escaped_text+=escapeHTMLMustache(text.substring(last_index));return escaped_text;},format_number:format_number,format_num_k:format_num_k,format_duration:format_duration,format_date:format_date,nicetime:nicetime,nicetime_v2:nicetime_v2,timestamp:function(dt){return dt;},pluralize:pluralize,grid_size:grid_size,grid_size_mix:grid_size_mix,thumbnail:thumbnail,crop:crop,breakwords:breakwords,escape_and_link:escape_and_link,slice:slice,count:count,linkify:linkify,linkify_tags:linkify_tags,number:number,is_rtl:is_rtl,user_thumb:user_thumb,is_online:function(user_id){return window.RT&&window.RT.online_users[user_id];},in_list:function(obj,arr){if(!arr)return false;return arr.indexOf&&arr.indexOf(obj)>-1;},add_url_param:function(url,param){if(!param)return url;return(url.match(/[?]/)?'&':'?')+param;},add_or_replace_param:add_or_replace_param,translation_link:translation_link,message_pic_sizing:message_pic_sizing}});}();(function(){function trim(stuff){if(''.trim)return stuff.trim();else return stuff.replace(/^\s+/,'').replace(/\s+$/,'');}
var ich={VERSION:"0.9",templates:{},$:(typeof window!=='undefined')?window.jQuery||window.Zepto||null:null,addTemplate:function(name,templateString){if(ich[name])throw"Invalid name: "+name+".";if(ich.templates[name])throw"Template \" + name + \" exists";ich.templates[name]=templateString;ich[name]=function(data,raw){data=$.extend({},window.global_ich_data||{},data||{});var result=Mustache.to_html(ich.templates[name],data,ich.templates);return(ich.$&&!raw)?ich.$(result):result;};},clearAll:function(){for(var key in ich.templates){delete ich[key];}
ich.templates={};},refresh:function(){ich.clearAll();ich.grabTemplates();},grabTemplates:function(){var i,scripts=document.getElementsByTagName('script'),l=(scripts!==undefined?scripts.length:0),script,trash=[];for(i=0;i<l;i++){script=scripts[i];if(script&&script.innerHTML&&script.id&&(script.type==="text/html"||script.type==="text/x-icanhaz")){ich.addTemplate(script.id,trim(script.innerHTML));trash.unshift(script);}}
for(i=0,l=trash.length;i<l;i++){trash[i].parentNode.removeChild(trash[i]);}}};window.ich=ich;ich.$().ready(function(){ich.grabTemplates();});})();(function(){var e_c={};window.$$=function(selector){if(!e_c[selector]){e_c[selector]=$(selector);}
return e_c[selector];};})();var ElementCache=(function(){var my={};my.cache={};my.get=function(image_id,selector){selector=selector||null;if(!selector&&my.cache[image_id].length){return my.cache[image_id];}
var found_images=[];var i,l;var $image;for(i=0,l=my.cache[image_id].length;i<l;i++){$image=my.cache[image_id][i];if($image.is(selector))continue;found_images.push($image);}
return found_images;};my.set=function(image_id,$value){if(my.cache[image_id]===undefined){my.cache[image_id]=[];}
my.cache[image_id].push($value);};my.refresh=function(image_id,selector){selector=selector||null;};my.filter=function(image_id,callback){var k;var i;var l;var all_images=[];var filtered_images=[];var $image;if(image_id){all_images=my.cache[image_id];}else{for(k in my.cache){for(i=0,l=my.cache.length;i<l;i++){all_images.push([k,my.cache[i]]);}}}
for(i=0,l=all_images.length;i<l;i++){image_id=all_images[i][0];$image=all_images[i][1];if(!callback(image_id,$image)){continue;}
filtered_images.push($image);}
return filtered_images;};my.remove_tmp=function(){var k;for(k in my.cache){if(k.slice(0,2)=='>>'){my.cache[k]=null;delete my.cache[k];}}};my.remove_all=function(selector){var k,i,l;var $image;var image_id;var removed_image_ids={};for(k in my.cache){if(removed_image_ids[k]){continue;}
if(my.cache[k].length){for(i=0,l=my.cache[k].length;i<l;i++){my.remove(k,selector);removed_image_ids[k]=1;}}}};my.remove=function(image_id,selector){if(!my.cache[image_id]||my.cache[image_id]===undefined){return null;}
selector=selector||null;if(!selector){my.cache[image_id]=[];return true;}
var $image,images;var i,l;var new_images=[];images=my.cache[image_id];for(i=0,l=images.length;i<l;i++){$image=images[i];if($image.is(selector)){continue;}
new_images.push($image);}
my.cache[image_id]=new_images;return true;};my.populate=function(selector){selector=selector||'[image_id]';var $images=$(selector);var $image;var image_id;var i;var l;for(i=0,l=$images.length;i<l;i++){$image=$($images[i]);image_id=$image.attr('image_id');if(!image_id)continue;if(image_id.slice(0,2)!='>>'){image_id=parseInt(image_id);}
if(my.cache[image_id]===undefined){my.cache[image_id]=[];}
my.cache[image_id].push($image);}}
return my;}());var xhr;var sort_start_pos;var sort_end_pos;var history_support=window.history&&'pushState'in history&&window.History&&window.History.Adapter;window.onbeforeunload=function(){if(xhr&&xhr.abort){xhr.abort();}
PageData.page_store('scroll_pos',document.body.scrollTop);};var State=(function(my){var pathname=window.location.pathname;var hash=window.location.hash;var page_title=document.title;my.visible=(function(){var stateKey,eventKey,keys={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(stateKey in keys){if(stateKey in document){eventKey=keys[stateKey];break;}}
return function(c){if(c)document.addEventListener(eventKey,c);return!document[stateKey];};})();my.get_uri=function(){var uri;var parts;var path;var sub;var subsub;if(window.subdomain){uri=window.subdomain+pathname;}else{uri=pathname.substring(1);}
parts=uri.split('/');return{path:parts[0]||'',sub:parts[1]||'',subsub:parts[2]||''};};my.get_args=function(){var args;var parts,part;var keyval;var parsed={};var i,l;args=window.location.href.split('?')[1];if(!args)return null;parts=args.split('&');for(i=0,l=parts.length;i<l;i++){part=parts[i];keyval=part.split('=');parsed[keyval[0]]=keyval[1];}
return parsed;};my.page_state=null;my.get_page_state=function(){var page_state;var uri=my.get_uri();switch(uri.path){case'':if(pass_to_js.show_partner_homepage){page_state='partner';}else{page_state=(pass_to_js.onboarding)?"onboarding":"home";}
break;case'feed':page_state=(pass_to_js.onboarding)?"onboarding":"home";break;case'friends':page_state=(pass_to_js.onboarding)?"onboarding":"matches";break;case'verification':page_state="verification";break;case'finish':case'keywords':case'start':page_state="onboarding";break;case'discover':case'everything':case'people':case'matches':case'tagged':case'label':case'inbox':case'messages':case'partner':case'settings':case'notifications':case'livestream_iframe':case'create_livestream':case'update_account_info':page_state=uri.path;break;default:if(uri.sub&&(uri.sub=='subscribers'||uri.sub=='subscriptions'||uri.sub=='subscribed_to'||uri.sub=='subscribing'||uri.sub=='subscribed_to_tags'||uri.sub=='fb_friends'||uri.sub=='friends'||uri.sub=='followers'||uri.sub=='following'||uri.sub=='blocked_users'||uri.sub=='friend_requests'||uri.sub=='sent_requests')){page_state=uri.sub;}else if(uri.sub.match(/^[0-9]+$/)){page_state="single_image";}else{page_state='user';}}
my.page_state=page_state;return page_state;};my.handle_args=function(){var args=State.args=my.get_args()||{};};my.in_image_infos=function(image_id){original_image_id_map={};Object.keys(PageData.images).forEach(function(key){original_image_id_map[PageData.images[key].original_image_id]=PageData.images[key].image_id;});return original_image_id_map[image_id];};my.is_logged_in=function(){return PageData.my_info&&PageData.my_info.user_id>0;};my.is_new_user=function(){return State.args&&'new_user'in State.args;};my.is_my_channel=function(){var my_user_id=PageData.my_info&&PageData.my_info.user_id;var feed_user_id=PageData.feed.user_id;return my_user_id&&feed_user_id&&my_user_id==feed_user_id;};my.maybe_open_player=function(){var uri=my.get_uri();var i,l;if(!(uri.sub.length||my.page_state!='users'))return;if(!$.isEmptyObject(PageData.images[uri.sub])){var opts={};opts.ads=(State.args.ads)?true:false;State.page_state="single_image";}};my.is_user_feed=function(feed){feed=feed||PageData.feed;return feed.user_id?true:false;};my.has_facebook=function(){return PageData&&PageData.my_info&&PageData.my_info.fb_uid&&true;};my.already_subscribed_tag=function(tag){var subscription_map=PageData.my_info.subscribed_tag_map;return subscription_map&&subscription_map[tag]!==undefined;};my.already_subscribed=function(user_id){var subscription_map=PageData.my_info.subscription_map;return subscription_map&&subscription_map[user_id]!==undefined;};my.feed_func=function(){var state=State.page_state;var func;switch(state){case'user':if(State.page_load_uri=="/likes"){func=PageData.get_user_likes;}else{func=PageData.get_user_page_feed;}
break;case'matches':func=PageData.get_user_matches;break;case'people':func=PageData.get_people_feed;break;case'tagged':func=PageData.get_tag_feed;break;case'discover':func=PageData.get_discover_feed;break;case'everything':func=PageData.get_everything_feed;break;case'home':func=PageData.get_feed;break;case'label':if(PageData.feed&&PageData.feed.label){func=PageData.get_label_feed;}else{func=function(){};}
break;default:func=function(){};break;};return func;};my.handle_grid=function(){if(!State.view){State.view="list";$("#list_view_icon").addClass("set");$("#feed_view_toggle").addClass("list");}
var saved_from_cache=false,back_button_pressed=$('#back_button_input').val();PageData.page_store();if(window.localStorage&&PageData.page_path.match(/home|people/)&&back_button_pressed&&PageData.page_store('saved_page_count')&&+PageData.page_store('last_updated')>(new Date()).getTime()-600*1000&&PageData.page_store('feed_page_0')){window.no_scroll_load=true;for(var i=0;i<+PageData.page_store('saved_page_count');i++){var data=JSON.parse(PageData.page_store('feed_page_'+i));PageData.handle_api_response(data);PageData.get_feed_success(data,true);saved_from_cache=true;}
PageData.back_button_load_time=(new Date).getTime();setTimeout(function(){var rt_feed_page=PageData.page_store('feed_page_rt');if(rt_feed_page&&!PageData.experiment_config.insert_in_place){var data=JSON.parse(rt_feed_page);Events.new_feed_items(data,true);var rt_count=parseInt(PageData.page_store('rt_feed_count'));if(rt_count==1){$header_new_images_counter.text('new post').fadeIn();}else{$header_new_images_counter.text('new posts').fadeIn();}}
window.scrollTo(0,+(PageData.page_store('scroll_top')||0));window.no_scroll_load=false;},10);}else if(window.localStorage&&PageData.page_store('saved_page_count')){for(i=0;i<+PageData.page_store('saved_page_count');i++){PageData.page_store('feed_page_'+i,null);}
PageData.page_store('saved_page_count',null);PageData.page_store('last_updated',null);PageData.page_store('feed_page_rt',null);PageData.page_store('rt_feed_count',null);}
if(State.is_new_user())return;if(State.page_state=="home"&&!saved_from_cache){my.feed_func()(0);if(window._t){_t.load=(new Date).getTime();_t.platform='desktop';var url='/api/log_latency?page=feed&';for(var key in _t){if(key!='start'&&key!='platform'&&_t.hasOwnProperty(key)){url+='&'+key+'='+(_t[key]-_t.start);}}
$.get(url);}}else if(State.page_state=="user"&&!PageData.custom_profile&&!saved_from_cache){my.feed_func()(0);}
else if(State.page_state=="discover"){var page_title=document.title;if(page_title.indexOf(')')!==-1&&page_title.indexOf('(')!==1&&page_title.indexOf('(')===0){var pos_closing_paren=page_title.indexOf(')');page_title=page_title.substr(pos_closing_paren+1);}
page_title=page_title.trim();var discover_feed_type=page_title.toLowerCase().split(" ").join("_");my.feed_func()(discover_feed_type,0);}
$('#back_button_input').val('1');};my.setup_link_click_handlers=function(){$('body').on({'click':function(e){var $this=$(this);if($this.hasClass('noajax')||this.target.length||$(e.target).closest('a')[0]!=this){return true;}
if(this.href.length&&my.change_page_url(this.href,true)){e.preventDefault();e.stopPropagation();return false;}
return true;}},'a');};my.handle_history=function(){my.page_load_uri=window.location.pathname;};my.change_page_url=function(new_path,add_to_history,opt_title){new_path=new_path.replace(/[#\/]+$/,'');if(!new_path||new_path[0]!='/')new_path='/'+new_path;var handled=false;my.within_history_handler=true;if(add_to_history){window.History.pushState(null,opt_title||page_title,new_path);handled=my.page_navigation_handler(new_path);}else{window.History.replaceState(null,opt_title||page_title,new_path);handled=true;}
my.within_history_handler=false;return handled;};var last_user_action=now();var action_callback=function(){if(!my.is_active()){window.get_suggested_streams&&get_suggested_streams(true);}
last_user_action=now();};var event='onwheel'in document?'wheel':'onmousewheel'in document?'mousewheel':'DOMMouseScroll';window.addEventListener(event,action_callback);$(window).on('mousemove',action_callback);$(window).on('mousedown',action_callback);$('body').on('keydown',action_callback);my.is_active=function(){if($$('#backpage').is(":visible")&&($$("#livestream_wrapper").hasClass('my_stream')||$$("#livestream_dialog").hasClass('my_stream')))return true;return now()-last_user_action<1000*(window.PageData&&window.PageData.experiment_config&&window.PageData.experiment_config.active_user_timeout||300);};$.fn.onVisibilityChange&&$(document).onVisibilityChange(function(hidden){if(!hidden){action_callback();}});my.set_uri_from_state=function(add_state,use_history,image_id,user_name,opts){opts=opts||{};if(!add_state&&use_history&&history_support){History.back();return null;}
var uri='/';image_id=image_id||0;if(!user_name&&PageData.user_info){user_name=PageData.user_info.user_name;}
var set_user=false;switch(my.page_state){case'home':break;case'tagged':if(!add_state){uri+=my.page_state+'/'+(PageData.feed.tag||'');}
break;case'discover':case'everything':case'people':case'settings':if(!add_state){uri+=my.page_state;}
break;case'subscribers':case'subscribing':case'subscribed_to':case'subscriptions':case'subscribed_to_tags':case'friends':case'friend_requests':case'sent_requests':uri+=user_name+'/'+my.page_state;set_user=true;break;case'user':uri+=user_name;set_user=true;break;default:set_user=true;}
var title=opts.title||page_title;if(add_state){var id_str='/';id_str+=image_id;if(!set_user){uri+=user_name;}
uri+=id_str;}
State.change_page_url(uri,use_history,title);return uri;};my.page_navigation_handler=function(url){if(my.within_history_handler)return false;var History=window.History;var state=History.getState();return false;};return my;}(State||{}));function check_fb_token(){if(window.FB&&window.refresh_fb_token){FB.getLoginStatus(function(response){if(response.status=='connected'&&response.authResponse){var params={access_token:response.authResponse.accessToken,expires:response.authResponse.expiresIn,fb_uid:response.authResponse.userID,update_friends:1};$.post('/api/complete_facebook_login',params,function(response){});}});}}
$().ready(function(){var pass_to_js=window.pass_to_js||{};window.DEBUG=pass_to_js.DEBUG||false;window.internal_only=pass_to_js.internal_only||false;window.MOBILE=pass_to_js.MOBILE||false;window.new_user=pass_to_js.new_user||null;window.empty_feed=pass_to_js.empty_feed||false;window.new_facebook_user=pass_to_js.new_facebook_user||null;window.mature_session=pass_to_js.mature_session||false;window.subdomain=pass_to_js.subdomain||null;window.page_loaded=false;window.feed_loaded=false;State.handle_history();if(window.MOBILE)history_support=false;State.handle_args();State.get_page_state();PageData.initialize(pass_to_js);if(window.mature_session&&State.is_logged_in()){PageData.my_info.mature_session=1;}
window.pass_to_js=null;State.maybe_open_player();if(!window.MOBILE&&!PageData.feed.custom_profile){if(PageData.my_info.authenticated_email==0&&!State.is_new_user()){Render.unvalidated_email_notification(PageData.my_info.email_verification_sent);}else if(State.args.emailvalid&&!State.is_new_user()){Render.email_validated_success();}
if(State.page_state!="single_image"){Render.maybe_setup_content_height&&Render.maybe_setup_content_height();}
Render.position_fixed_elements&&Render.position_fixed_elements();}
if(!window.MOBILE&&!PageData.onboarding&&!PageData.not_fl){State.handle_grid();}
if(State.page_state=="settings"){Render.settings_initialize();}
if(window.MOBILE&&Render.initial_page_load){Render.initial_page_load();}
var no_emoji=false;if(PageData.experiment_config&&PageData.experiment_config.disable_emoji_mac_chrome){no_emoji=!!navigator.userAgent.match(/Mac OS.*Chrome\//);}
if(!no_emoji){var node=document.createElement('canvas'),ctx=node.getContext('2d');ctx.textBaseline='top';ctx.font='32px Arial';ctx.fillText('\ud83d\ude03',0,0);if(ctx.getImageData(16,16,1,1).data[0]===0){no_emoji=true;}}
if(no_emoji){window.no_emoji_support=true;$('head').append('<link href="//'+window.location.host+'/emoji-symbola.css" rel="stylesheet" type="text/css"/>');}
setTimeout(check_fb_token,2000);PageData.setup_ud_handlers();});$(window).load(function(){window.page_loaded=true;});var ImageUtils=(function(){var my={};my.MIN_IMAGE_WIDTH=200;my.MIN_IMAGE_HEIGHT=180;my.LARGE_LANDSCAPE_RATIO=1.4;my.COL_WIDTH=240;my.THUMB_HEIGHT=189;my.PORTRAIT_WIDTH=210;my.LANDSCAPE_WIDTH=450;my.SEARCH_RESULT_WIDTH=my.PORTRAIT_WIDTH;my.SEARCH_RESULT_HEIGHT=my.THUMB_HEIGHT;my.preload_completed=true;function check_for_complete(){var i;var $preloaded_images=$('.preloaded_image');var $preloaded_image;if(!$preloaded_images.length){my.preload_completed=true;return;}
for(i=0;i<$preloaded_images.length;i++){$preloaded_image=$($preloaded_images[i]);if(!($preloaded_image[0].complete||$preloaded_image.width())){return setTimeout(check_for_complete,500);}}
my.preload_completed=true;if(my.callback){my.callback();}else{my.preload_success();}}
my.preload_success=function(){};my.preload_images=function(image_urls){var image_url;var image;var image_id;var image_info;var i,l;for(i=0,l=image_urls.length;i<l;i++){image_url=image_urls[i];image=new Image();image.src=image_url;}};my.remove_preloaded_images=function(selector){selector=selector||'.preloaded_image';$(selector).remove();};my.large_enough=function($image){return $image.width()>=my.MIN_IMAGE_WIDTH&&$image.height()>=my.MIN_IMAGE_HEIGHT;};my.get_classname=function($image){if(!$image.length)return;var ratio;var width,height;var src;width=$image.width();height=$image.height();ratio=width/height;if(ratio>my.LARGE_LANDSCAPE_RATIO){return'landscape';}
return'portrait';};my.center_grid_thumbnail=function($image){var classname,class_w,class_h,thumb_w,thumb_h,margin_l,margin_t;classname=$image.classname;class_w=parseInt($(".classname").css('width'));class_h=parseInt($(".classname").css('height'));thumb_w=$image.width();thumb_h=$image.height();margin_l=0;margin_t=0;if(thumb_w>class_w){margin_l=-((thumb_w-class_w)/2);}else if(thumb_h>class_h){margin_t=-((thumb_h-class_h)/2);}
return{'margin-left':margin_l+"px",'margin-top':margin_t+"px"};};my.filter_preloaded_images=function(filter_func){if(filter_func===undefined)return;var $images=$('.preloaded_image');var $image;var num_filtered=0;var i;for(i=0;i<$images.length;i++){$image=$($images[i]);if(!filter_func($image)){$image.remove();num_filtered++;}}
return num_filtered;};my.show_preloaded_images=function($images){$images.removeClass('preloaded_image');$images.show();};my.get_bottom_row=function(){return $('.image_row1, .imagerow2').filter(':last');};my.get_num_cols_from_width=function(width){return 4;};my.get_curr_col=function(total_cols){return 0;};my.add_cols=function(next_cols,curr_cols,total_cols){return curr_cols>=total_cols?0:next_cols+curr_cols;};my.get_next_cols=function(classname){var l=classname.length;if(classname.substr(0,9)==='landscape'||classname.substr(l-5,l)==='large'){return 2;}
return 1;};my.reorder_images_for_grid=function(image_ids,image_map,cols,start_col){if(!PageData||!PageData.feed||!PageData.feed.image_ids){return;}
var old_ids=image_ids;image_map=image_map||PageData.images;image_ids=image_ids||PageData.feed.image_ids.slice();cols=cols||4;start_col=start_col||0;var curr_cols=start_col;var new_order=[];var image_id;var image;var extra_image;var extra_image_id;var classname;var extra_classname;var cols_left;var next_item_cols;var extra_item_cols;var i,l;while(image_id=image_ids.shift()){image=PageData.images[image_id];classname=image.classname;if(!classname||classname===undefined)return old_ids;cols_left=cols-curr_cols;if(cols_left===0){cols_left=cols;curr_cols=0;}
next_item_cols=my.get_next_cols(classname);if(cols_left>=next_item_cols){curr_cols=my.add_cols(next_item_cols,curr_cols,cols);new_order.push(image_id);}else{for(i=0,l=image_ids.length;i<l;i++){extra_image=image_map[image_ids[i]];extra_classname=extra_image.classname;extra_item_cols=my.get_next_cols(extra_classname);if(extra_item_cols<=cols_left){extra_image_id=image_ids.splice(i,1)[0];new_order.push(extra_image_id);image_ids.unshift(image_id);curr_cols=my.add_cols(extra_item_cols,curr_cols,cols);break;}}}}
return new_order;};my.gif_preload=function(image_id){var image_info=PageData.images[image_id];var suffix='.noanim';var new_url=image_info.thumb_url.replace(suffix,'');var image=new Image();image.src=new_url;my.gif_check_finished(image_id,image,my.gif_preload_success);};my.gif_preload_success=function(image_id){var $img=$("#image_"+image_id).find(".image_grid_thumbnail");var old_url=PageData.images[image_id].thumb_url;var suffix='.noanim';var new_url=old_url.replace(suffix,'');$img.attr('src',new_url);$(".gif_loading_spinny").hide();$("#image_"+image_id).find(".gif_pause").hide();};my.gif_check_finished=function(image_id,img,callback){callback=callback===undefined?my.gif_preload_success:callback;if(!img.complete){setTimeout(function(){my.gif_check_finished(image_id,img,callback);},100);return;}
if(callback){callback(image_id);}};my.get_thumb_dims=function(w,h,unprocessed){if(true||unprocessed){return{height:224,width:220,classname:'unprocessed'};}
var classname,thumb_w,thumb_h,ratio,ret;ratio=w/h;if(ratio>=my.LARGE_LANDSCAPE_RATIO){ret={classname:'landscape',width:my.LANDSCAPE_WIDTH};}else{ret={classname:'portrait',width:my.PORTRAIT_WIDTH};}
ret.height=my.THUMB_HEIGHT;return ret;};my.preload=function(image,callback){callback=callback||my.preload_success;if(!image||image.complete===undefined)return;if(image.complete===false||!image.width){return setTimeout(function(){my.preload(image,callback);},100);}
if(callback){callback($(image));}};my.resize_thumb=function($img,dims,vertical_center){if(!$img.length)return;vertical_center=vertical_center===undefined?true:vertical_center;var w=$img[0].width,h=$img[0].height;dims=dims||my.get_thumb_dims(w,h)||{};var ratio=w/h,image_id=$img.attr('image_id'),classname=dims.classname,thumb_w=dims.width,thumb_h=dims.height,desired_h=my.THUMB_HEIGHT,resize_w,resize_h,offset_w,offset_h,$domimage,css;if(thumb_w>=w){resize_w=w;resize_h=Math.round(resize_w/ratio);}else{resize_w=Math.round(desired_h*ratio);if(resize_w<thumb_w){resize_w=thumb_w;resize_h=Math.round(resize_w/ratio);}}
if(vertical_center&&resize_h!==desired_h){offset_h=-Math.round((resize_h-desired_h)/2);}
resize_w=Math.min(w,resize_w);css={'width':resize_w+'px'};if(offset_h){css['margin-top']=offset_h+'px';}
Helpers.on_create('image_'+image_id,function($image,extra){$image.css(extra).show();},'.image_grid_thumbnail',css)};my.handle_thumb_sizes=function($images,dims){if(!$images.length)return;var i,l,image;for(i=0,l=$images.length;i<l;i++){image=$images[i];my.preload(image,function($image){var _dims=dims||my.get_thumb_dims($image[0].width,$image[0].height);my.resize_thumb($image,_dims,true);});}};return my;}());;(function($){jQuery.event.props.push("dataTransfer");var default_opts={fallback_id:'',url:'',refresh:1000,paramname:'userfile',allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:empty,dragStart:empty,dragEnter:empty,dragOver:empty,dragLeave:empty,docEnter:empty,docOver:empty,docLeave:empty,beforeEach:empty,afterAll:empty,rename:empty,error:function(err,file,i,status){alert(err);},uploadStarted:empty,uploadFinished:empty,progressUpdated:empty,globalProgressUpdated:empty,speedUpdated:empty,alternateHandler:empty},errors=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError"],doc_leave_timer,stop_loop=false,files_count=0,files;$.fn.filedrop=function(options){var opts=$.extend({},default_opts,options),global_progress=[];this.on('drop',drop).on('dragstart',opts.dragStart).on('dragenter',dragEnter).on('dragover',dragOver).on('dragleave',dragLeave);$(document).on('drop',docDrop).on('dragenter',docEnter).on('dragover',docOver).on('dragleave',docLeave);$('#'+opts.fallback_id).change(function(e){opts.drop(e);files=e.target.files;files_count=files.length;upload();});function drop(e){if(opts.drop.call(this,e)===false)return false;files=e.dataTransfer.files;if(files===null||files===undefined||files.length===0){opts.alternateHandler(e);return false;}
files_count=files.length;upload();e.preventDefault();return false;}
function getBuilder(filename,filedata,mime,boundary){var dashdash='--',crlf='\r\n',builder='';if(opts.data){var params=$.param(opts.data).split(/&/);$.each(params,function(){var pair=this.split("=",2),name=decodeURIComponent(pair[0]),val=decodeURIComponent(pair[1]);builder+=dashdash;builder+=boundary;builder+=crlf;builder+='Content-Disposition: form-data; name="'+name+'"';builder+=crlf;builder+=crlf;builder+=val;builder+=crlf;});}
builder+=dashdash;builder+=boundary;builder+=crlf;builder+='Content-Disposition: form-data; name="'+opts.paramname+'"';builder+='; filename="'+filename+'"';builder+=crlf;builder+='Content-Type: '+mime;builder+=crlf;builder+=crlf;builder+=filedata;builder+=crlf;builder+=dashdash;builder+=boundary;builder+=dashdash;builder+=crlf;return builder;}
function progress(e){if(e.lengthComputable){var percentage=Math.round((e.loaded*100)/e.total);if(this.currentProgress!==percentage){this.currentProgress=percentage;opts.progressUpdated(this.index,this.file,this.currentProgress);global_progress[this.global_progress_index]=this.currentProgress;globalProgress();var elapsed=new Date().getTime();var diffTime=elapsed-this.currentStart;if(diffTime>=opts.refresh){var diffData=e.loaded-this.startData;var speed=diffData/diffTime;opts.speedUpdated(this.index,this.file,speed);this.startData=e.loaded;this.currentStart=elapsed;}}}}
function globalProgress(){if(global_progress.length===0){return;}
var total=0,index;for(index in global_progress){if(global_progress.hasOwnProperty(index)){total=total+global_progress[index];}}
opts.globalProgressUpdated(Math.round(total/global_progress.length));}
function upload(){stop_loop=false;if(!files){opts.error(errors[0]);return false;}
if(opts.allowedfiletypes.push&&opts.allowedfiletypes.length){for(var fileIndex=files.length;fileIndex--;){if(!files[fileIndex].type||$.inArray(files[fileIndex].type,opts.allowedfiletypes)<0){opts.error(errors[3],files[fileIndex]);return false;}}}
var filesDone=0,filesRejected=0;if(files_count>opts.maxfiles&&opts.queuefiles===0){opts.error(errors[1]);return false;}
var workQueue=[];var processingQueue=[];var doneQueue=[];for(var i=0;i<files_count;i++){workQueue.push(i);}
var pause=function(timeout){setTimeout(process,timeout);return;};var process=function(){var fileIndex;if(stop_loop){return false;}
if(opts.queuefiles>0&&processingQueue.length>=opts.queuefiles){return pause(opts.queuewait);}else{fileIndex=workQueue[0];workQueue.splice(0,1);processingQueue.push(fileIndex);}
try{if(beforeEach(files[fileIndex])!==false){if(fileIndex===files_count){return;}
var reader=new FileReader(),max_file_size=1048576*opts.maxfilesize;reader.index=fileIndex;if(files[fileIndex].size>max_file_size){opts.error(errors[2],files[fileIndex],fileIndex);$.each(processingQueue,function(key,value){if(value===fileIndex){processingQueue.splice(key,1);}});filesRejected++;return true;}
reader.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:opts.error(errors[4]);return false;case e.target.error.NOT_READABLE_ERR:opts.error(errors[5]);return false;case e.target.error.ABORT_ERR:opts.error(errors[6]);return false;default:opts.error(errors[7]);return false;};};reader.onloadend=!opts.beforeSend?send:function(e){opts.beforeSend(files[fileIndex],fileIndex,function(){send(e);});};reader.readAsBinaryString(files[fileIndex]);}else{filesRejected++;}}catch(err){$.each(processingQueue,function(key,value){if(value===fileIndex){processingQueue.splice(key,1);}});opts.error(errors[0]);return false;}
if(workQueue.length>0){process();}};var send=function(e){var fileIndex=((typeof(e.srcElement)==="undefined")?e.target:e.srcElement).index;if(e.target.index===undefined){e.target.index=getIndexBySize(e.total);}
var xhr=new XMLHttpRequest(),upload=xhr.upload,file=files[e.target.index],index=e.target.index,start_time=new Date().getTime(),boundary='------multipartformboundary'+(new Date()).getTime(),global_progress_index=global_progress.length,builder,newName=rename(file.name),mime=file.type;if(opts.withCredentials){xhr.withCredentials=opts.withCredentials;}
if(typeof newName==="string"){builder=getBuilder(newName,e.target.result,mime,boundary);}else{builder=getBuilder(file.name,e.target.result,mime,boundary);}
upload.index=index;upload.file=file;upload.downloadStartTime=start_time;upload.currentStart=start_time;upload.currentProgress=0;upload.global_progress_index=global_progress_index;upload.startData=0;upload.addEventListener("progress",progress,false);if(jQuery.isFunction(opts.url)){xhr.open("POST",opts.url(),true);}else{xhr.open("POST",opts.url,true);}
xhr.setRequestHeader('content-type','multipart/form-data; boundary='+boundary);$.each(opts.headers,function(k,v){xhr.setRequestHeader(k,v);});xhr.sendAsBinary(builder);global_progress[global_progress_index]=0;globalProgress();opts.uploadStarted(index,file,files_count);xhr.onload=function(){var serverResponse=null;if(xhr.responseText){try{serverResponse=jQuery.parseJSON(xhr.responseText||"null");}
catch(e){serverResponse=xhr.responseText;}}
var now=new Date().getTime(),timeDiff=now-start_time,result=opts.uploadFinished(index,file,serverResponse,timeDiff,xhr);filesDone++;$.each(processingQueue,function(key,value){if(value===fileIndex){processingQueue.splice(key,1);}});doneQueue.push(fileIndex);global_progress[global_progress_index]=100;globalProgress();if(filesDone===(files_count-filesRejected)){afterAll();}
if(result===false){stop_loop=true;}
if(xhr.status<200||xhr.status>299){opts.error(xhr.statusText,file,fileIndex,xhr.status);}};};process();}
function getIndexBySize(size){for(var i=0;i<files_count;i++){if(files[i].size===size){return i;}}
return undefined;}
function rename(name){return opts.rename(name);}
function beforeEach(file){return opts.beforeEach(file);}
function afterAll(){return opts.afterAll();}
function dragEnter(e){clearTimeout(doc_leave_timer);e.preventDefault();opts.dragEnter.call(this,e);}
function dragOver(e){clearTimeout(doc_leave_timer);e.preventDefault();opts.docOver.call(this,e);opts.dragOver.call(this,e);}
function dragLeave(e){clearTimeout(doc_leave_timer);opts.dragLeave.call(this,e);e.stopPropagation();}
function docDrop(e){e.preventDefault();opts.docLeave.call(this,e);return false;}
function docEnter(e){clearTimeout(doc_leave_timer);e.preventDefault();opts.docEnter.call(this,e);return false;}
function docOver(e){clearTimeout(doc_leave_timer);e.preventDefault();opts.docOver.call(this,e);return false;}
function docLeave(e){doc_leave_timer=setTimeout((function(_this){return function(){opts.docLeave.call(_this,e);};})(this),200);}
return this;};function empty(){}
try{if(XMLHttpRequest.prototype.sendAsBinary){return;}
XMLHttpRequest.prototype.sendAsBinary=function(datastr){function byteValue(x){return x.charCodeAt(0)&0xff;}
var ords=Array.prototype.map.call(datastr,byteValue);var ui8a=new Uint8Array(ords);this.send(ui8a.buffer);};}catch(e){}})(jQuery);var Forms=(function(){var my={};my.has_scrolled=false;my.global_selector='input[type=text], input[type=password], textarea';my.options={'init_css':{'font-style':'normal','color':'#222'},'default_css':{"color":"#ccc","font-style":"normal"},'changed_css':{"color":"#222","font-style":"normal"}};my.placeholderIsSupported=function(){var test=document.createElement('input');return('placeholder'in test);};my.updateDefaultValue=function($elem){var val=$elem.val();var default_val=$elem.attr('placeholder')||'';if(val===default_val||val===''){$elem.val('');$elem.css({'color':'#222','font-style':'normal'});}};my.setDefaultValue=function($elem){var val=$elem.val();$elem.val($elem.attr('placeholder'));var css_package=(val===$elem.attr('placeholder')||val==='')?my.options.default_css:my.options.changed_css;$elem.css(css_package);};my.initDefaults=function(selector,parent,skip_focus_first){parent=parent||"body";selector=selector||my.global_selector;skip_focus_first=skip_focus_first||false;var i;var $fields,$field;var default_val;var $first_input;$fields=$(selector);$first_input=$(parent).find('.first_input').filter(':visible').filter(':first');if($first_input.length){if(!skip_focus_first){$first_input.focus();}}
for(i=0;i<$fields.length;i++){$field=$($fields[i]);default_val=$field.attr('placeholder')||'';if(i==0&&!$first_input.length){if(!skip_focus_first){$field.focus();}}
$field.data('defaults_set',true);}};my.handleFieldError=function(msg,$field,foffset){foffset=foffset||10;var offset=$field.offset();var field_id=$field.attr('id');var $error_div=$("#"+field_id+"_error");if(!$error_div.length){var markup=ich.error_msg({field_id:field_id,left:offset.left
+$field.width()
+foffset+20+'px',top:offset.top+'px',msg:msg});$error_div=$(markup);$error_div.appendTo('body');}
$error_div.css({left:offset.left
+$field.width()
+foffset+20+'px',top:offset.top+'px'});$error_div.show();};my.setupEvents=function(selector,parent){selector=selector||my.global_selector;parent=parent||"body";$(parent).on({'keydown':function(e){Forms.updateDefaultValue($(this));},'focus':function(e){Forms.updateDefaultValue($(this));},'blur':function(e){if($(this).val()===''){Forms.setDefaultValue($(this));}}},selector);my.calledsetupalready=true;};my.getFieldErrors=function(){};my.handleError=function(msg,timeToFade,fadeOutDuration){Notifications.renderTemporaryNotification('error',msg,5000);};return my;}(Forms));$(function(){Forms.initDefaults(undefined,undefined,true);});$(function(){$(document).mousedown(function(e){if(!$(e.target).closest('.nice_select_options').length){$(".nice_select_options").hide();}});$(document).on({click:function(e){$(this).next(".nice_select_options").show();e.stopPropagation();}},".nice_select");$(document).on({click:function(){var $this=$(this);var value=($this.hasClass("default_tag"))?$this.attr("tag_id"):$this.attr("id");var $container=$this.closest(".nice_select_container");var selected_name=(value!="other")?$this.text():"";$container.find(".nice_select_current").html(selected_name).attr("data",value);if($container.find(".nice_select_input").length){$container.find(".nice_select_input").val(value);}
if(value=="other"){$this.closest("#add_tag_container").find("#custom_tags").css('display','inline-block').find('input').focus();}else{$this.closest("#add_tag_container").find("#custom_tags").hide();}
var $nice_select_options=$this.closest(".nice_select_options");$nice_select_options.hide();}},".nice_select_option");});var Api=(function(){var my={};var extra_opts={lock:true,spinny_id:true,no_spinny:true,break_cache:true};my.curr_requests={};my.uri_prefix='//'+window.location.host+'/api/';my.before_send=function(params,jqxhr,settings,request_key,$spinny,callback){my.curr_requests[request_key]=jqxhr;if($spinny&&$spinny.length){$spinny.show();}
if(callback){callback(params);}};my.ajax_complete=function(request_key,$spinny){if($spinny&&$spinny.length){$spinny.hide();}
$spinny=null;spinny_id=null;delete my.curr_requests[request_key];};my.send_api_request=function(callback,request_type,params,opts){opts=opts||{};params=params||{};var spinny_id;var $spinny;var k;var ajax_opts;var lock=opts.lock!==undefined?opts.lock:true;var break_cache=opts.break_cache!==undefined?opts.break_cache:true;var no_spinny=opts.no_spinny||false;if(window.PageData&&window.PageData.ft){form_token=window.PageData.ft+':';if(window.PageData.ud_coords){form_token+=window.PageData.ud_coords;}
params['__token']=form_token;}
var request_key=opts.request_key||request_type;if(my.curr_requests[request_key]&&lock){return false;}
if(break_cache){params.break_cache=new Date().getTime().toString()+Math.random().toString();}
if(!no_spinny){if(opts.spinny_id){spinny_id=opts.spinny_id;}else{spinny_id='#'+request_type+'_spinny';}
$spinny=$(spinny_id);}
ajax_opts={type:'POST',url:my.get_uri(request_type),data:$.param(my.clean_params(params)),cache:false,dataType:"json",beforeSend:function(jqxhr,settings){my.before_send(params,jqxhr,settings,request_key,$spinny,opts.before_send||null);},success:function(data){my.handle_response_data(data,callback,opts.error||null);},error:function(data){my.handle_api_request_error(data,opts.error||null);},complete:function(){my.ajax_complete(request_key,$spinny);}};for(k in opts){if(!extra_opts[k]){ajax_opts[k]=opts[k];}}
xhr=$.ajax(ajax_opts);return true;};my.get_uri=function(uri){return my.uri_prefix+(uri||'');};my.handle_api_request_error=function(data,callback){if(data&&data.error){if(typeof data.error!='function'){Forms.handleError(data.error);}
if(callback){callback(data);}}else if(window.xhr&&window.xhr.status!=401){my.handle_response_data({error:"Oops! Your request could not be completed. Please try again."},callback);}};my.handle_response_data=function(data,callback,error_callback){if(data){if(data.error){Forms.handleError(data.error);if(error_callback){error_callback(data);}}else{if(window.PageData){PageData.handle_api_response(data);}
if(callback){callback(data);}}}};my.clean_params=function(params){var new_params={};var item;for(var k in params){item=params[k];if(item===undefined){continue;}
new_params[k]=item;}
return new_params;};my.pollers={};my.start_polling_uri=function(endpoint,params,poll_interval_secs,success_callback,error_callback){if(endpoint in my.pollers){console.log("Already polling "+endpoint);return;}
if(poll_interval_secs==null||poll_interval_secs==undefined){console.log("Need to supply a poll interval");}
var poller=function(){var req_attr={};req_attr['xhr']=$.ajax({url:my.get_uri(endpoint),cache:false,dataType:'json',data:$.param(my.clean_params(params)),success:function(data){my.handle_response_data(data,success_callback,error_callback);}});req_attr['timeout_id']=setTimeout(poller,poll_interval_secs*1000);my.pollers[endpoint]=req_attr;};poller();};my.stop_polling_uri=function(endpoint){if(endpoint in my.pollers){var req_attr=my.pollers[endpoint];clearTimeout(req_attr.timeout_id);req_attr.xhr.abort();req_attr.xhr=null;delete my.pollers[endpoint];}};return my;}());var PageData={'initialized':false,'my_info':{},'images':{},'users':{},'comments':{},'galleries':{},'ads':{},'ads_track_id':0,pending_attachment:{},'feed':{'user_id':null,'image_ids':[]},'curr_feed_page':0,'prefixes':{'remove':1,'prepend':1,'new':1},'getting_a_feed':false,'hover_cards':{user_cards:{},tag_cards:{},_get_card_type:function(type){return type+'_cards';},get:function(id,type){var card_type=this._get_card_type(type);return this[card_type][id];},add:function(id,type,data){var card_type=this._get_card_type(type);this[card_type][id]=data;},update:function(id,type,subkey,val){var card_type=this._get_card_type(type);this[card_type][id][subkey]=val;},remove:function(id,type){var card_type=this._get_card_type(type);delete this[card_type][id];},is_present:function(id,type){var card_type=this._get_card_type(type);if(this[card_type].hasOwnProperty(id)){return true;}else{return false;}}},'page_title':document.title,'initialize':function(initial_data){var k;for(k in initial_data){if(initial_data.hasOwnProperty(k)){PageData[k]=initial_data[k];}}
if(!$.isEmptyObject(PageData.my_info)){PageData.setup_my_info(PageData.my_info);}
PageData.initialized=true;},'setup_my_info':function(my_info){var k;var l;var new_key;for(k in my_info){if(!my_info.hasOwnProperty(k))continue;l=k.length;if(k.substr(l-4)=='_ids'){new_key=k.slice(0,l-3)+'map';my_info[new_key]=Helpers.getMapFromIds(my_info[k]);}}},'_merge_api_obj':function(obj,pd_key){var attr;if(!PageData[pd_key]){PageData[pd_key]={};}
for(attr in obj){if(PageData[pd_key][attr]){PageData[pd_key][attr]=Helpers.copyObj(obj[attr],PageData[pd_key][attr],false,false,pd_key,attr);}else{PageData[pd_key][attr]=obj[attr];}}},'get_prefix':function(attr){if(!attr||!attr.split)return false;var parts=attr.split('_');var possible_prefix=parts[0];var prefix;var new_attr;if(PageData.prefixes[possible_prefix]){prefix=possible_prefix;new_attr=parts.splice(1,parts.length-1).join('_');}else{new_attr=attr;}
return{prefix:prefix||null,attr:new_attr};},'handle_action_prefix':function(attr_info,key,data,root_key,sub_key,return_item){var value=data[key];var attr=attr_info.attr;var prefix=attr_info.prefix;var new_value;var obj_to_change;if(sub_key){obj_to_change=PageData[root_key][sub_key][attr];}else{obj_to_change=PageData[root_key][attr];}
switch(prefix){case'remove':var filtered_value=$.grep(obj_to_change,function(val,i){for(i=0,l=value.length;i<l;i++){if(value[i]==val)return false;if(attr=="image_ids"&&typeof val=="string"&&typeof value[i]!="string"){if("i:"+value[i].toString()==val)return false;}}
return true;});new_value=filtered_value;break;case'prepend':if(obj_to_change&&obj_to_change.length){for(var i=0,l=value.length;i<l;i++){if(attr=="image_ids"&&typeof obj_to_change[0]=="string"&&typeof value[i]!="string"){value[i]="i:"+value[i].toString();}}}
Helpers.extendArray(value,obj_to_change,true);new_value=value;break;case'new':new_value=value;break;}
if(return_item){return new_value;}else{if(sub_key){PageData[root_key][sub_key][attr]=new_value;}else{PageData[root_key][attr]=new_value;}}
return null;},'handle_api_response':function(data,reset){var i;if(reset){PageData.images={};PageData.users={};PageData.galleries={};PageData.comments={};PageData.feed.image_ids=[];PageData.feed.user_id=null;}
if(data.result){data=data.result;}
var root_fields=['images','users','comments','galleries','ads'];for(i=0,l=root_fields.length;i<l;i++){var f=root_fields[i];if(data[f]&&$.isPlainObject(data[f])){PageData._merge_api_obj(data[f],f);}}
if(data.my_info&&$.isPlainObject(data.my_info)){for(var attr in data.my_info){var offset=attr.length-4;var value;if(attr.substr(offset)=='_ids'){value=data.my_info[attr];var action_prefix=PageData.get_prefix(attr);var pd_attr=action_prefix.attr;if(!PageData.my_info[pd_attr]){PageData.my_info[pd_attr]=[];}
if(action_prefix.prefix){PageData.handle_action_prefix(action_prefix,attr,data.my_info,'my_info');}else{Helpers.extendArray(PageData.my_info[attr],data.my_info[attr],true);}
var map_prefix=pd_attr.substr(0,pd_attr.length-4);PageData.my_info[map_prefix+"_map"]=Helpers.getMapFromIds(PageData.my_info[pd_attr]);}}}
if(data.feed){var feed_pages=['user','discover','label','home','tagged','everything'];var attr_info=null;if(data.feed.remove_image_ids){attr_info=PageData.get_prefix("remove_image_ids");PageData.handle_action_prefix(attr_info,"remove_image_ids",data.feed,'feed');}
if(data.feed.prepend_image_ids){attr_info=PageData.get_prefix("prepend_image_ids");PageData.handle_action_prefix(attr_info,"prepend_image_ids",data.feed,'feed');}
if(data.feed.image_ids&&feed_pages.indexOf(State.page_state)!=-1){var extend_feed=(typeof data.feed.image_ids[0]=="string"&&data.feed.image_ids[0].substring(0,1)==">")?false:true;if(extend_feed){if(data.feed.skip_count){PageData.feed.skip_count=data.feed.skip_count;}
if(data.feed.user_id){PageData.feed.user_id=data.feed.user_id;}
Helpers.extendArray(PageData.feed.image_ids,data.feed.image_ids,true);if(data.feed.image_rows){if(!PageData.feed.image_rows){PageData.feed.image_rows=[];}
Helpers.extendArray(PageData.feed.image_rows,data.feed.image_rows);}}}
var feeds=['suggested_user_ids','friend_request_ids'];var feed_name;for(i=0,l=feeds.length;i<l;i++){feed_name=feeds[i];if(!data.feed[feed_name])continue;PageData.feed[feed_name]=PageData.feed[feed_name]||[];if(!PageData.feed[feed_name].length){PageData.feed[feed_name]=data.feed[feed_name];}else{Helpers.extendArray(PageData.feed[feed_name],data.feed[feed_name],true);}}}
if(data.track_id){PageData.ads_track_id=data.track_id;if(window.likes_tracking){window.likes_tracking.current_track_id=data.track_id;}}},'update_sort_order':function(image_ids){var params={'image_ids':image_ids.join(',')};Api.send_api_request(null,'update_sort_order',params);},'handle_add_caption':function($caption,params){var caption;if($caption.val().length>250){params.error="Sorry your caption is too long.";return params;}
if($caption.val()===$caption.attr('placeholder')){caption="";}else{caption=$caption.val();};params.caption=caption;PageData.handle_add_tags(params);return params;},'handle_add_title':function($title,params,required){required=required||false;if(!$title.val()&&required){params.error="Whoops, you need a gallery title.";return params;}
var title;if($title.val().length>250){params.error="Sorry, your title is too long.";return params;}
if($title.val()===$title.attr('placeholder')){title="";}else{title=$title.val();};params.gallery_title=title;return params;},'handle_add_tags':function(params){if($("#common_dialog_wrapper #reshared_gallery_id").length){return;}
var dom_tags=[];var ft_tag_input,user_tags;if($("#common_dialog_wrapper").is(":visible")){ft_tag_input=$("#common_dialog_wrapper #featured_tag_input");}else{ft_tag_input=$("#featured_tag_input");}
if(ft_tag_input.length){var ft_tag=ft_tag_input.val();if(ft_tag&&ft_tag!="other"){dom_tags.push(ft_tag);}}
if($("#common_dialog_wrapper").is(":visible")){user_tags=$("#common_dialog_wrapper #add_new_tag").val();}else{user_tags=$("#add_new_tag").val();}
if(user_tags){new_tags=user_tags.trim().split(" ");$.each(new_tags,function(i,val){var new_val=val.replace("#","");if(new_val){dom_tags.push(new_val);}});}
var unique_tags=[];$.each(dom_tags,function(i,val){if($.inArray(val,unique_tags)===-1)unique_tags.push(val);});if(unique_tags.length>0){if(!params.reshared_image_ids){if(PageData.my_info.tag_tutorial_status=="locked"||PageData.my_info.tag_tutorial_status=="unlocked"){params.tag_tutorial_status="completed";}
if(unique_tags.length>3){params.error="You have over 3 tags! Delete some and try again";}else{params.tags=unique_tags.join(",");}}}
params['tag_length']=unique_tags.length;return params;},'handle_gallery_item':function($item){var params={};params.source_url=$item.find(".pic_url_field").val();params.gallery_pos=$item.attr("item_number");params.attribution_url=$item.find(".attribution_url").val();params.add_source=$item.find(".add_source").val();params.caption=not_placeholder_val($item.find(".add_image_caption"));params.description=not_placeholder_val($item.find(".add_image_description"));if($item.attr("image_id").length){params.image_id=$item.attr("image_id");}
return params;},'submit_gallery_form':function(){var i,l;var $fields,field;var params={};var $title=$('#add_gallery_title');params=PageData.handle_add_title($title,params,true);if($("#add_gallery_title").val()){var title=not_placeholder_val($("#add_gallery_title"));try{if($(title).length>0){Notifications.renderTemporaryNotification('error',"Sorry, we do not allow HTML content in the gallery title field. Please try again.");return;}}
catch(err){}}
if($("#add_gallery_description").val()){params.gallery_description=not_placeholder_val($("#add_gallery_description"));try{if($(params.gallery_description).length>0){Notifications.renderTemporaryNotification('error',"Sorry, we do not allow HTML content in the gallery description field. Please try again.");return;}}
catch(err){}}
params.sponsored=($("#resharable_checkbox").is(":checked"))?1:0;$fields=$("#gallery_create_top input[type='hidden']");for(i=0,l=$fields.length;i<l;i++){field=$fields[i];if(field.value&&field.value.length){params[field.name]=field.value;}}
PageData.handle_add_tags(params);l=$(".create_item_container").length;var final_items=[];for(i=0;i<l;i++){var item=PageData.handle_gallery_item($(".create_item_container:eq("+i.toString()+")"));final_items.push(item);}
for(var i=0;i<final_items.length;i++){var cap=final_items[i].caption;var desc=final_items[i].description;try{if($(cap).length>0){Notifications.renderTemporaryNotification('error',"Sorry, we do not allow HTML content in the gallery item title field. Please try again.");return;}
if($(desc).length>0){Notifications.renderTemporaryNotification('error',"Sorry, we do not allow HTML content in the gallery item description field. Please try again.");return;}}
catch(err){}}
var cover_item;var $cover_image=$("#cover_image_pic");if($cover_image.is(":visible")){cover_item=PageData.handle_gallery_item($cover_image);cover_item.cover_image=true;}
if(!final_items.length){params.error="Please add items to your gallery.";}else if(final_items.length==1){if(cover_item){final_items.push(cover_item);}
if(params.gallery_type!="onepager"){if(params.gallery_id){params.error="Galleries need at least 2 images.";}else{open_one_image_gallery_options();return;}}else{$.extend(params,final_items[0]);}}else if(final_items.length>20){params.error="Galleries are limited to 20 items. Please remove some items or create a new gallery.";}else{if(cover_item){final_items.push(cover_item);}
params.images=JSON.stringify(final_items);}
if(params.error){Notifications.renderTemporaryNotification("error",params.error);return;}else{var opts={'spinny_id':'#gallery_create_spinny'};$(opts.spinny_id).height($("#share_image_form").height());Api.send_api_request(PageData.submit_gallery_success,'add_image',params,opts);}},'submit_gallery_success':function(data){if(data.error){Notifications.renderTemporaryNotification("error",'Sorry, we\'re having trouble adding your gallery');return;}
if(data.result){if(!data.edit&&data.result.galleries[data.gallery_id].gallery_type=="onepager"&&show_gallery_dialog){data.from_add_form=1;show_gallery_dialog(data);return;}
for(var image_id in data.result.images){var image=data.result.images[image_id];var source_url=image.source_url;}}
if(data.gallery_url&&show_gallery_dialog){data.from_add_form=(!data.edit);show_gallery_dialog(data,true);return;}},'submit_image_form':function(){var i,l;var $fields,field;var params={'source_url':$('#add_image_url').val(),'nsfw':($("#nsfw").prop("checked"))?1:0};if(State.page_state==='search'&&Search.latest_query){params.query=Search.latest_query;}
$fields=$("input[type='hidden']");for(i=0,l=$fields.length;i<l;i++){field=$fields[i];if(field.value&&field.value.length){params[field.name]=field.value;}}
var $caption=$("#add_image_caption");params=PageData.handle_add_caption($caption,params);var $title=$('#add_image_gallery_title');if($title.length){params=PageData.handle_add_title($title,params);}
if($(".video_form_submit").length){params.gallery_type='onepager';params.video=true;params.type='video';}
if(params.error){Notifications.renderTemporaryNotification("error",params.error);return;}else{$("#add_image_spinny").height($("#share_image_form").height());setupSimpleSpinny("add_image_form");Api.send_api_request(PageData.submit_image_success,'add_image',null,{data:params,spinny_id:"#add_image_form_spinny"});}},'submit_image_success':function(data){if(data.error){Notifications.renderTemporaryNotification("error",'Sorry, we\'re having trouble adding your image.');return;}
var new_id=data.image_id;var source_url=data.result.images[new_id].source_url;if(PageData.images[new_id]){PageData.images[new_id].already_shared=1;}
PageData.my_info.current_images++;PageData.my_info.current_added_images++;if(PageData.my_info.mylikes_user_id&&data.gallery_url&&show_gallery_dialog){data.from_adpd_form=1;show_gallery_dialog(data,true);return;}
var temp_id=Search.adding_temp_id;Search.adding_temp_id=null;var content=(State.is_my_channel())?"Success! Your image has been added to your profile. Now redirecting..":"Success! Your image has been added to your profile. <a href='/"+PageData.my_info.user_name+"'>Click here to see it.</a>";Notifications.renderTemporaryNotification("success_white",content,7000);hide_common_dialog();if($$("#backpage").is(":visible")){$(".add_image").removeClass("add_image").addClass("added_image").text("Added");$("#"+temp_id).next('.image_overlay').find('.add_image_button').addClass("shared");}else{$(".sharing").removeClass("sharing").addClass("shared");}
var refresh_page=true;if(State.page_state=='user'&&PageData.feed.user_id==PageData.my_info.user_id&&refresh_page){Helpers.extendArray(PageData.feed.image_ids,[data.image_id]);window.location.href=$("#profile_tab").attr("href");}},'reshare_gallery_mobile':function(gallery_id){gallery_id=gallery_id||0;if(!gallery_id){return;}
var params={'reshared_gallery_id':gallery_id,'caption':'','add_source':'mobile_reshare'};Api.send_api_request(PageData.add_image_success,'reshare_gallery',params);},'reshare_image':function(image_id){var params={};params.reshared_image_id=image_id;params.caption='';params.add_source='mobile_reshare';Api.send_api_request(PageData.add_image_success,'reshare_image',params);},'add_image':function(){var params=Render.get_add_image_params();params=PageData.handle_add_caption(Render.$add_form_comment,params);var $title=$('#add_image_gallery_title');if($title.length){params=PageData.handle_add_title($title,params);}
if(params.error){Notifications.renderTemporaryNotification("error",params.error);if(window.MOBILE){Render.reset_send_state();}
return;}else{var endpoint=params.reshared_image_id?'reshare_image':'add_image';if(params.source_url||params.reshared_image_id){Api.send_api_request(PageData.add_image_success,endpoint,params);}}},'upload_image_success':function(data){if(!data.thumbnailed_img_url)return;var source_url=data.thumbnailed_img_url;Render.upload_image_success(source_url);},'add_image_success':function(data){PageData.current_images=PageData.current_images++;Render.reset_add_form();Render.hide_dialog_form("add");var reshared_image_id=(data.reshared_gallery_id)?PageData.galleries[data.reshared_gallery_id].cover_image_id:data.reshared_image_id;if(reshared_image_id){var reshared_image=PageData.images[reshared_image_id];if(reshared_image){reshared_image.num_shares=reshared_image.num_shares||0;reshared_image.num_shares++;}
render_share_unshare(reshared_image_id,false);}else{PageData.current_added_images=PageData.current_added_images++;window.location.href='/'+PageData.my_info.user_name;}},'add_comment':function(image_id,comment_text){var params={'image_id':image_id,'comment_text':comment_text.replace(/[\u2001-\u200b]/g,'')};add_attachment_params(params,image_id);Api.send_api_request(PageData.add_comment_success,'add_comment',null,{'data':params,'error':PageData.add_comment_failure});},'add_comment_failure':function(data){PageData.handle_api_response(data);if(data&&data.image_id){$("#"+data.image_id+"_livestream_comment_text").attr('disabled',false);$("#"+data.image_id+"_comment_text").attr('disabled',false);}},'add_comment_success':function(data){var image_id=data.image_id;var new_comment_info=Helpers.copyObj(PageData.comments[data.comment_id]);PageData.pending_attachment[image_id]={};Render.render_add_comment(image_id,new_comment_info);},'delete_my_comment':function(comment_id){var params={'comment_id':comment_id,'my_comment':true};if($("#livestream_wrapper").size()){params.in_stream=true;}
Api.send_api_request(PageData.delete_comment_success,'delete_comment',params);},'delete_comment_success':function(data){if(!data.success)
return;var comment_id=data.deleted_comment_id;var image_id=data.image_id;Render.render_delete_comment(image_id,comment_id);if(comment_id in PageData.comments){delete PageData.comments[comment_id];}},'like_comment':function(comment_id){var params={'comment_id':comment_id};Api.send_api_request(PageData.like_comment_success,'like_comment',params);},'like_comment_success':function(data){if(!data.success)
return;var comment_id=data.values.comment_id;var curr_likes=data.values.curr_likes;Render.render_like_comment(comment_id,curr_likes);},'mark_reviewed':function(image_id){var params={'image_id':image_id,'source_url':PageData.images[image_id].source_url,'label':PageData.feed.label};Api.send_api_request(PageData.delete_image_success,'mark_reviewed',params);},'remove_tag':function(image_id,tag,gallery_id){if(!window.internal_only){return;}
var params={'image_id':image_id,'source_url':PageData.images[image_id]['source_url'],'tag':tag};if(gallery_id){params.gallery_id=gallery_id;}
Api.send_api_request(PageData.remove_tag_success,'remove_tag',params);},'remove_tag_success':function(data){if(data.success){var image_tags=PageData.images[data.image_id].tags;for(var i=0,l=image_tags.length;i<l;i++){if(image_tags[i].tag==data.tag){image_tags.splice(i,1);break;}}
var selector="#remove_tag_"+data.tag+"_"+data.image_id;$(selector).removeClass("deleting_tag").parent().hide();if($("#backpage").is(":visible")){$(selector+"_lightbox").removeClass("deleting_tag").parent().hide();}}},'like_image':function(image_id,callback){callback=callback||PageData.like_image_success;var params={'image_id':image_id};Api.send_api_request(callback,'add_like',params);},'like_image_success':function(data){if(data.error)return;var result=data.result||data;var image_id=data.image_id;var info;var response_image=result.images[image_id]||{};if(!'num_likes'in response_image){PageData.images[image_id].num_likes=PageData.images[image_id].num_likes||0;PageData.images[image_id].num_likes++;}
$(".liking").removeClass("liking");},'unlike_image':function(image_id){var params={'image_id':image_id};Api.send_api_request(PageData.unlike_image_success,'remove_like',params);},'unlike_image_success':function(data){if(data.error)return;var result=data.result||data;var image_id=data.image_id;var image=PageData.images[image_id];var response_image=result.images[image_id]||{};if(!'num_likes'in response_image){image.num_likes--;}
$(".unliking").removeClass("unliking");},'delete_gallery':function(image_id,gallery_id,cb){if(!image_id)return;var params={'image_id':image_id,'gallery_id':gallery_id||PageData.images[image_id].gallery_id||0};Api.send_api_request(cb||PageData.delete_gallery_success,'delete_gallery',params);},'delete_gallery_success':function(data){if(data.error)return;var image_id=data.image_id;var gallery_id=data.gallery_id;if(PageData.images[image_id]){delete PageData.images[image_id];}
if(PageData.galleries[gallery_id]){delete PageData.my_info.my_galleries[gallery_id];delete PageData.galleries[gallery_id];}
if(!window.MOBILE){Render.render_delete_image(image_id);}},'delete_image':function(image_id){if(!image_id)return;var params={'image_id':image_id};Api.send_api_request(PageData.delete_image_success,'delete_image',null,{'data':params,'spinny_id':'#dialog_spinny'});},'delete_image_success':function(data){if(data.error)return;var image_id=data.image_id;if(PageData.images[image_id]){var source_url=PageData.images[image_id].source_url;delete PageData.images[image_id];}
if(!window.MOBILE){Render.render_delete_image(image_id);}},'reshare_image_form':function(){var image_id=$('#reshared_image_id').val();var params={'reshared_image_id':image_id,'add_source':'reshare'};if(PageData.images[image_id].gallery_id){params.gallery_id=PageData.images[image_id].gallery_id;}
if(params.error){Notifications.renderTemporaryNotification("error",params.error);return;}else{$("#reshare_image_spinny").height($("#share_image_form").height());Api.send_api_request(PageData.reshare_image_success,'reshare_image',params);}},'reshare_image_success':function(data){var image_id=data.reshared_image_id;PageData.track_event('add_reshare',PageData.images[image_id].mixer_source,image_id);var image=PageData.images[image_id];image.already_shared=1;image.num_shares=image.num_shares||0;image.num_shares++;PageData.my_info.current_images++;var my_info=Helpers.copyObj(PageData.my_info);my_info.thats_me=true;Render.render_reshare_image(data,my_info);},'track_image_impressions':function(){var image_ids=[],seen_image_ids=PageData.seen_image_ids||{},$window=$(window),scroll_top=$window.scrollTop(),win_height=$window.height();$('#channel_images>.image').each(function(){var $this=$(this),offset=$this.offset();if(offset.top+$this.height()>scroll_top+200&&offset.top<scroll_top+win_height-200){var image_id=$this.attr('image_id');if(!seen_image_ids[image_id]){seen_image_ids[image_id]=1;image_ids.push(image_id);}}});PageData.seen_image_ids=seen_image_ids;if(image_ids.length){Api.send_api_request(function(){},'track_impressions',{image_ids:image_ids.join(',')});}},'get_fb_post_content':function(item_opts){var message,link,name,description,caption,picture;var item_id=item_opts.item_id;if(item_opts.item_type=="image"){var image=PageData.images[item_id];if(image!=undefined){if(image.caption==undefined||image.caption.length==0){description=image.description||'Yo! Check it out...';}else{description=image.caption;}
picture=image.source_url;link=Helpers.get_external_url_for_image(item_id);name=PageData.my_info.name+' posted';if(image.type!="text")name+=" a "+image.type;name+=" on Likes.";}}else if(item_opts.item_type=="gallery"){var gallery=PageData.galleries[item_id];if(gallery!=undefined){if(gallery.gallery_description==undefined||gallery.gallery_description.length==0){description=image.caption||'Yo! Check it out...';}else{description=gallery.gallery_description;}
picture=gallery.cover_photo_url;link=Helpers.get_external_url_for_gallery(item_id);name=gallery.title;}}
if(link.length){return{description:description,link:link,name:name,likesdotcom:"www.likes.com",picture:picture};}
return null;},'maybe_get_next_page':function(){return;if(window.feed_loaded||window.MOBILE)return;var content_height=Render.get_grid_content_height();if($(window).height()-200>content_height){PageData.get_next_page(null,{lock:false});}},'local_store_full':0,'page_store':function(key,opt_value,undefined){if(!window.localStorage)return null;if(!key&&!opt_value){if(+localStorage['last_stored']<(new Date()).getTime()-3600*1000){localStorage.clear();}
return null;}
key=document.location.pathname+'/'+key;if(opt_value===null){localStorage.removeItem(key);}else if(!PageData.local_storage_full){if(opt_value!==undefined){try{localStorage[key]=opt_value;localStorage['last_stored']=(new Date()).getTime();}catch(e){PageData.local_store_full=1;}}else{return localStorage[key];}}
return null;},'get_feed_success':function(data,do_not_save){PageData.getting_a_feed=false;if(!data||!(data.result||data.markup)){return;}
if(do_not_save!==true){var page=parseInt(PageData.page_store('saved_page_count')||0);PageData.page_store('saved_page_count',page+1);PageData.page_store('feed_page_'+page,JSON.stringify(data));PageData.page_store('last_updated',(new Date()).getTime());}
var result=data.result;if(result){if(window.MOBILE&&State.page_state=="matches"){render_people_paging(result);return;}
var feed_ids=(State.page_state!="matches")?result.feed.image_ids:result.feed.suggested_user_ids;if(!(feed_ids&&feed_ids.length)){PageData.next_page=undefined;if(data.markup){Render.render_get_feed(data);}else{$('#feed_loading_spinny').remove();data.empty_feed=true;Render.render_get_feed(data);}
return;}}
if(data.markup&&data.image_ids&&data.image_ids.length){PageData.feed.image_ids=data.image_ids;}
Render.render_get_feed(data);PageData.next_page=result?result.next_page:1;PageData.maybe_get_next_page();window.feed_loaded=true;},'get_suggested_users_image_feed':function(page,user_id){if(!user_id||!PageData.users[user_id]||!PageData.users[user_id].next_user_image_page)return;page=page||0;var params={'page':page,'user_id':user_id};Api.send_api_request(PageData.get_suggested_users_image_feed_success,'suggested_users_image_feed',params);},'get_suggested_users_image_feed_success':function(data){PageData.users[data.user_id].next_user_image_page=(data.image_ids.length<10)?0:1;Helpers.extendArray(PageData.users[data.user_id].image_ids,data.image_ids);Render.render_get_lightbox_image_feed(data);},'get_gallery_image_feed':function(page,gallery_id){page=page||0;if(!gallery_id||!PageData.galleries[gallery_id]||(page!=0&&!PageData.galleries[gallery_id].next_gallery_image_page))return;var params={'page':page,'gallery_id':gallery_id};Api.send_api_request(PageData.get_gallery_image_feed_success,'gallery_image_feed',params);},'get_gallery_image_feed_success':function(data){var gallery=PageData.galleries[data.gallery_id];gallery.next_gallery_image_page=(data.image_ids.length<10)?0:1;Helpers.extendArray(gallery.image_ids,data.image_ids);Render.render_get_lightbox_image_feed(data);},'get_single_image':function(image_id,callback){Api.send_api_request(callback,'get_single_image',{image_id:image_id});},'get_feed_params':function(page,get_markup){var last_row;var params={};if(page||page===0){params.page=page;}else{params.page=PageData.next_page;}
if(get_markup){params.get_markup=get_markup;params.page_state=State.page_state;}
if(PageData.feed.image_rows||State.page_state=="tagged"){params.position=PageData.feed.image_ids.length;params.skip_count=PageData.feed.skip_count;}
params.per_page=window.MOBILE?10:20;return params;},'get_a_feed':function(opts){opts=opts||{};var type=opts.type;var ajax_opts=opts.ajax_opts||{};var extra_params=opts.params||null;var page=opts.page;if(window.MOBILE)
ajax_opts.spinny_id=$('#next_page_spinny');if(!type)return;if(!page&&page!==0&&(!PageData.next_page||PageData.next_page===undefined)){return;}
PageData.curr_feed_page=page||PageData.curr_feed_page||0;var params=PageData.get_feed_params(opts.page,opts.get_markup);if(extra_params){for(var k in extra_params){if(extra_params.hasOwnProperty(k)){params[k]=extra_params[k];}}}
if(opts.tag){PageData.curr_tag=tag;}
if((type==='tagged_feed'||type==='user_tagged')&&!params.tag){params.tag=PageData.feed.tag;}
if((type==='user_feed'||type==='user_likes'||type==='user_tagged'||type=='user_friends'||type=='get_user_followers'||type=='get_user_friends'||type=='get_user_following'||type=='get_user_blocks')&&!params.user_id){params.user_id=PageData.feed.user_id;}else if(type==='label_feed'&&!params.label){params.label=PageData.feed.label;params.label_param=PageData.feed.label_param;}
if(type==='feed'&&PageData.ads_track_id){params.track_id=PageData.ads_track_id;}
PageData.getting_a_feed=true;Api.send_api_request(opts.callback||PageData.get_feed_success,type,params,ajax_opts);},'get_feed':function(page){return PageData.get_a_feed({type:'feed',page:page,ajax_opts:{spinny_id:"#home_feed_spinny"}});},'get_user_page_feed':function(page,user_id){if(PageData.feed&&PageData.feed.common_domain_sulu)
return false;return PageData.get_a_feed({'type':'user_feed','params':{page:(page!==null&&page!==undefined)?page:PageData.next_page,user_id:user_id,custom_profile:PageData.feed.custom_profile,user_created:PageData.user_created,format:PageData.feed.format}});},'get_user_likes':function(page,user_id){return PageData.get_a_feed({type:'user_likes',params:{user_id:user_id}});},'get_people_list':function(page,user_id){var api='get_user_'+State.page_state;if(State.page_state=='blocked_users'){api='get_user_blocks';}
return PageData.get_a_feed({type:api,params:{user_id:user_id,},ajax_opts:{'spinny_id':'#feed_loading_spinny',},callback:function(data){if(!data||!data.infos||!data.infos.users){PageData.next_page=false;return;}
PageData.next_page=data.next_page;var markup='';$.each(data.infos['users'],function(index,value){var display={'user':value,'my_info':PageData.my_info};markup+=jinja.user_list_row(display,true);});$("#main_content").append(markup);},});},'get_user_friends':function(page,user_id){return PageData.get_a_feed({type:'user_friends',params:{user_id:user_id,sub:State.page_state},ajax_opts:{'spinny_id':'#feed_loading_spinny',},callback:function(data){if(!data||!data.result||!data.result.users){PageData.next_page=false;return;}
PageData.next_page=data.next_page;var markup='';$.each(data.result['users'],function(index,value){var display={'user':value,'my_info':PageData.my_info};markup+=jinja.user_list_row(display,true);});$("#main_content").append(markup);},});},'get_user_tagged':function(page,user_id,tag){return PageData.get_a_feed({type:'user_tagged',params:{user_id:user_id,tag:tag,custom_profile:PageData.feed.custom_profile}});},'get_tag_feed':function(page,tag){return PageData.get_a_feed({type:'tagged_feed',params:{tag:tag},page:page});},'get_discover_feed':function(discover_feed_type,page){return PageData.get_a_feed({type:'discover_feed',params:{discover_feed_type:discover_feed_type},page:page});},'get_everything_feed':function(page){return PageData.get_a_feed({type:'everything_feed',page:page});},'get_label_feed':function(page,label,label_param){return PageData.get_a_feed({type:'label_feed',page:page,params:{label:label,label_param:label_param}});},'get_user_matches':function(page){return PageData.get_a_feed({type:'people_feed',page:page});},'get_people_feed':function(page){return PageData.get_a_feed({type:'people_feed',page:page});},'get_likes':function(image_id,paginate){if(!image_id){return;}
var params={'before_send':Render.render_action_page_before_send,'image_id':image_id};var image=PageData.images[image_id];params.position=(image&&image.liked_ids&&paginate)?image.liked_ids.length+1:0;Api.send_api_request(PageData.get_likes_success,"get_likes_page",params);},'get_likes_success':function(data){if(data.success){Render.render_get_action_users(data);}},'get_comment_likes':function(comment_id){if(!comment_id){return;}
var params={'before_send':Render.render_action_page_before_send,'comment_id':comment_id};var comment=PageData.comments[comment_id];params.position=(comment.liked_ids)?comment.liked_ids.length+1:0;Api.send_api_request(PageData.get_likes_success,"get_comment_likes_page",params);},'get_comment_likes_success':function(data){if(data.success){Render.render_get_action_users(data);}},'get_shares':function(image_id){if(!image_id||!PageData.images[image_id]){return;}
var image=PageData.images[image_id];var params={'before_send':Render.render_action_page_before_send,'image_id':image_id};if(image.gallery_id){var gallery=PageData.galleries[image.gallery_id];params.gallery_id=image.gallery_id;params.original_id=(gallery)?gallery.original_gallery_id:0;params.position=(gallery.resharer_ids&&gallery.resharer_ids.length)?gallery.resharer_ids.length+1:0;}else{params.original_id=image.original_image_id;params.position=(image.resharer_ids&&image.resharer_ids.length)?image.resharer_ids.length+1:0;}
params.num_shares=(gallery)?gallery.num_shares:image.num_shares;Api.send_api_request(PageData.get_shares_success,"get_shares_page",params);},'get_shares_success':function(data){if(data.success){Render.render_get_action_users(data);}},'get_subscriptions':function(page){if(!PageData.next_page){return;}
var params={};params.page=PageData.next_page;params.id_type=State.page_state;params.user_id=PageData.feed.user_id;Api.send_api_request(PageData.get_subscriptions_success,"get_subscriptions_page",params);},'get_subscriptions_success':function(data){if(data.success){$("#main_content").append(data.markup);PageData.next_page=data.next_page;}else{PageData.next_page=undefined;}},'get_next_page':function(feed,opts){if(PageData.next_page===undefined)return;feed=feed||PageData.feed;if(State.page_state==='user'){State.feed_func()(PageData.next_page,PageData.feed.user_id);}else if(State.page_state==='tagged'){State.feed_func()(PageData.next_page,PageData.feed.tag);}else{State.feed_func()(PageData.next_page);}},'get_gallery_homepage':function(include_side){include_side=include_side||0;if(!PageData.next_page){return;}
var params={'position':$(".partner_gallery").length,'v':PageData.v_param,'q':PageData.gallery_keywords,'sort':PageData.gallery_sort,'include_side':include_side};Api.send_api_request(PageData.get_gallery_discover_feed_success,"gallery_homepage",params);},'get_gallery_discover_feed':function(){if(!PageData.next_page){return;}
var params={};params.page=PageData.next_page;if(PageData.gallery_keywords){params.q=PageData.gallery_keywords;}
Api.send_api_request(PageData.get_gallery_discover_feed_success,"gallery_discover_feed",params);},'get_gallery_discover_feed_success':function(data){if(data.success){$("#gallery_grid").append(data.markup);PageData.next_page=data.next_page;if(data.side_markup){$("#new_galleries").append(data.side_markup);}}else{if(data.show_upsell){$("#gallery_homepage_bottom").show();}
PageData.next_page=undefined;}},'set_mature_session':function(){PageData.my_info.mature_session=1;var params={'name':'mature_session','value':1};Api.send_api_request(PageData.set_mature_session_success,'set_session_variable',params);},'set_mature_session_success':function(data){},'change_cover_photo':function(cp_id){var params={'cp_id':cp_id};Api.send_api_request(PageData.change_cover_photo_success,'change_cover_photo',null,{'data':params,'spinny_id':'#dialog_spinny'});},'change_cover_photo_success':function(data){if(data.success){render_change_cover_photo(data);}},'save_user_info':function(data,spinny_id){Api.send_api_request(PageData.display_save_success,'update_user_info',null,{'data':data,'spinny_id':spinny_id?spinny_id:'#save_spinny'});},'save_twitter_user_info':function(data){Api.send_api_request(PageData.display_twitter_save_success,'update_user_info',null,{'data':data,'spinny_id':'#save_spinny'});},'change_password':function(data){Api.send_api_request(PageData.display_save_success,'change_password',null,{'data':data,'spinny_id':'#save_spinny'});},'resend_validation_email':function(){Api.send_api_request(PageData.display_email_success,'resend_validation_email',null);},'delete_facebook':function(data){Api.send_api_request(PageData.display_save_success,'delete_facebook',null,{'data':data,'spinny_id':'#save_spinny'});},'delete_twitter':function(data){Api.send_api_request(PageData.display_save_success,'delete_twitter',null,{'data':data,'spinny_id':'#save_spinny'});},'display_email_success':function(data){var redirect_url=(data.eid)?"/":window.location.pathname;if(data.error){redirect_url+="?error="+encodeURIComponent(data.error);}else if(data.success){redirect_url+="?emailsuccess=true";}
window.location=redirect_url;},'display_validate_email':function(data){var redirect_url=(data.eid)?"/":window.location.pathname;if(data.error){redirect_url+="?error="+encodeURIComponent(data.error);}else if(data.success){redirect_url+="?emailvalid=true";}
window.location=redirect_url;},'display_save_success':function(data){var redirect_url=(data.eid)?"/":window.location.pathname;if(data.error){redirect_url+="?error="+encodeURIComponent(data.error);}else if(data.success){redirect_url+="?success=true";}
window.location=redirect_url;},'display_twitter_save_success':function(data){window.location="/?new_user=1";},'unsubscribe_from_tag':function(tag){if(!PageData.my_info.user_id){return;}
var params={};params.tag=tag;Api.send_api_request(PageData.tag_unsubscription_success,'unsubscribe_from_tag',params);},'subscribe_to_tag':function(tag){if(!PageData.my_info.user_id){return;}
var params={};params.tag=tag;Api.send_api_request(PageData.tag_subscription_success,'subscribe_to_tag',params);},'unsubscribe_from_user':function(user_id){if(!PageData.my_info.user_id){return;}
var params={};params.id=user_id;Api.send_api_request(PageData.unsubscription_success,'unsubscribe_from_user',params);},'subscribe_to_user':function(user_id){if(!PageData.my_info.user_id){return;}
var params={};params.id=user_id;Api.send_api_request(PageData.subscription_success,'subscribe_to_user',params);},'follow_all':function(id,id_type){if(!PageData.my_info.user_id){return;}
var params={};params.id=id;params.id_type=id_type;var featured_ids=(PageData.feed)?PageData.feed.tag_top_users:null;if(id_type=="tagged"&&featured_ids){var extra_ids=[];for(var i=0;i<featured_ids.length;i++){var featured_id=featured_ids[i];if(!State.already_subscribed(featured_id)){extra_ids.push(featured_id);}}
if(extra_ids){params.extra_ids=extra_ids.join(',');}}
Api.send_api_request(PageData.subscription_success,'follow_all',params);var value=(id_type=="tagged")?0:id;PageData.track_event('follow_all',id_type,value);},'subscription_success':function(data){if(window.MOBILE&&data.success)
render_subscribe_success(data.user_ids[0]);},'unsubscription_success':function(data){if(window.MOBILE&&data.success)
render_unsubscribe_success(data.user_ids[0]);},'delete_user':function(){if(PageData&&PageData.partner_page){window.open_verification_dialog(function(auth_id){$.post(Api.get_uri('delete_user'),{auth_id:auth_id},function(response){Notifications.renderTemporaryNotification("success","Success! Your account has been deactivated. Goodbye.");window.location='/';});});}else{Api.send_api_request(function(){window.location='/';},'delete_user');}},'track_event':function(event_type,event_label,event_value){var params={'path':event_type,'referer':State.page_load_uri||'','label':event_label||'','value':event_value||'0'};var opts={'no_spinny':true};Api.send_api_request(null,'track_event',params,opts);},'increment_counter':function(key){var params={'key':key};$.ajax(Api.get_uri('increment_counter'),{data:params});},'get_notifications':function(last_id,per_page,action_type){var params={'last_id':last_id,'per_page':per_page,'action_type':action_type};Api.send_api_request(PageData.get_notifications_success,'get_notifications',null,{'data':params,'spinny_id':'#notification_tab_spinny'});},'get_notifications_success':function(data){if('notifications'in data){notifications=data['notifications'];for(var index=0;index<notifications.length;index++){notification=notifications[index];if('notification_message'in notification&&'name_tag_1_tab'in notification&&'name_tag_2_tab'in notification){notification_message=notification['notification_message'];notification_message=notification_message.replace(/{name_tag_1}/g,notification['name_tag_1_tab']);notification_message=notification_message.replace(/{name_tag_2}/g,notification['name_tag_2_tab']);notification['notification_message']=notification_message;}
if(index==notifications.length-1){PageData.last_notification_id=notification['rendered_activity_id'];}}}
Render.render_notifications(data);},'mark_all_notifications_read':function(){if(!PageData.my_info.user_id){return;}
Api.send_api_request(PageData.mark_all_notifications_read_success,'mark_all_notifications_read',null,null);},'mark_all_notifications_read_success':function(data){PageData.my_info.unread_notification_count=0;Render.render_unread_notification_count();},'mark_all_messages_read':function(data){if(!PageData.my_info.user_id){return;}
Api.send_api_request(PageData.mark_all_messages_read_success,'mark_all_messages_read',null,null);},'mark_all_messages_read_success':function(data){PageData.my_info.unread_message_count=0;Render.render_unread_message_count();},'get_threads':function(page,per_page){if(!PageData.my_info.user_id){return;}
params={'page':page,'sort_unread':true};Api.send_api_request(PageData.get_threads_success,'get_user_threads',null,{'data':params,'spinny_id':'#message_tab_spinny'});},'get_threads_success':function(data){var display={'threads':{},page:data.page};if(data.results&&data.results.threads){display['threads']=data.results.threads;display['next_page']=data.results.next_page;display['my_info']=PageData.my_info;display['enable_desktop_calls']=PageData.experiment_config.enable_desktop_calls;}
Render.render_messages(display);},'unblock_user':function(target_user_id){if(!PageData.my_info.user_id){return;}
var params={'user_id':target_user_id};Api.send_api_request(PageData.unblock_user_success,'unblock_user',params,null);},'unblock_user_success':function(){window.location.href=window.location.href;},'block_user':function(target_user_id){if(!PageData.my_info.user_id){return;}
var params={'user_id':target_user_id,'source_page':State.page_state};var $d=$("#livestream_dialog").length?$("#livestream_dialog"):$("#livestream_wrapper");if($d.size()&&$d.hasClass("my_stream")){params.blocked_by_streamer=true;params.stream_id=$d.attr("image_id");}
Api.send_api_request(PageData.block_user_success,'block_user',params,null);},'block_user_success':function(data){if(State.page_state=="home"||$("#livestream_view").length||$("#livestream_dialog").length){var user_id=data.user_id;Notifications.renderTemporaryNotification("success","User has been blocked. You will not see each other's future posts.");$(".confirm_block[user_id="+user_id+"]").hide();}else{window.location.href=window.location.href;}},'profile_url':function(user_name,include_host){if(window.Mustache&&Mustache.FILTERS.profile){return Mustache.FILTERS.profile(user_name);}
include_host=include_host||false;if(!window.global_ich_data||!global_ich_data.base_domain){if(include_host){return'//'+window.location.host+'/'+user_name;}else{return'/'+user_name;}}
return'//'+user_name.replace(/_/g,'-')+'.'+global_ich_data.base_domain;},'get_friend_points':function(user_id){Api.send_api_request(PageData.get_friend_points_success,'get_friend_point_leaderboard',{'user_id':user_id});},'get_friend_points_success':function(response){if(!response||!response.success){return;}
Helpers.disableScroll();$$("#common_dialog_wrapper").empty().html(jinja.friend_point_dialog(response)).show();},'ud_coords':null,'ud_handler_callback':function(event){coords='';if(event.originalEvent){if(event.clientX||event.clientY){coords=''+event.clientX+':'+event.clientY;}else if(event.which){coords='k:'+event.which;}}
if(coords){PageData.ud_coords=coords;$(document.body).unbind("._udhandlers");}
return true;},'setup_ud_handlers':function(){$(document.body).bind("mousedown._udhandlers",PageData.ud_handler_callback);$(document.body).bind("keydown._udhandlers",PageData.ud_handler_callback);}};function not_placeholder_val($el){if(Forms.placeholderIsSupported()){return $el.val();}
if($el){return(!$el.attr('placeholder')||$el.val()!=$el.attr('placeholder'))?$el.val():'';}}
function hide_account_menu(){$("#account_menu").removeClass('showing');};function show_account_menu(){$("#account_menu").addClass('showing');};function hide_image_mod(){$(".image_mod_options").hide();};function hide_messaging_box(){$("#messaging_box").removeClass("showing");};function show_messaging_box(){$("#messaging_box").addClass('showing');};function hide_notification_box(){$("#notification_box").removeClass("showing");};function show_notification_box(){$("#notification_box").addClass("showing");};function hide_search_results_box(){$('#u-search-results').removeClass("showing");};var last_unread_message_count=null;function maybe_open_messaging_box(include_close){var per_page=8,page=0,$unread_count=$("#messaging_container"),$messaging_box=$('#messaging_box');if(!$messaging_box.hasClass("showing")){show_messaging_box();var unread_count_when_clicked;if($unread_count.find(".unread_count").length){unread_count_when_clicked=$unread_count.find(".unread_count").attr('unread_count');}
if(unread_count_when_clicked!=last_unread_message_count||!($("#messages_list .dropdown_row").length)){if($("#messages_list .dropdown_row").length){$("#messages_list").prepend("<div class='dropdown_row end_of_messages'>Reloading messages...<span><img src='/images/likes/fb_spinny.gif'></span></div>");}
PageData.get_threads(page,per_page);}
last_unread_message_count=unread_count_when_clicked;PageData.track_event('messaging_box','messaging_tab_opened',unread_count_when_clicked);}else if(include_close){hide_messaging_box();}};function maybe_open_notification_box(include_close){var per_page=8,page=0,$unread_count=$("#notification_container"),$notification_box=$('#notification_box');if(!$notification_box.hasClass("showing")){show_notification_box();var unread_count_when_clicked;if($unread_count.find(".unread_count").length){unread_count_when_clicked=$unread_count.find(".unread_count").attr('unread_count');}
if(unread_count_when_clicked||!($notification_box.find(".dropdown_row").length)){PageData.get_notifications('',per_page,PageData.notification_load_action_type);PageData.mark_all_notifications_read();}
PageData.track_event('notification_box','notification_tab_opened',unread_count_when_clicked);}else if(include_close){hide_notification_box();}};$().ready(function(){last_unread_message_count=PageData.my_info.unread_message_count;$$('body').click(function(e){var $notification_box=$('#notification_box');if($notification_box.hasClass('showing')){if(!$(e.target).closest('#notification_container').length){hide_notification_box();}}
var $messaging_box=$('#messaging_box');if($messaging_box.hasClass('showing')){if(e.target.id!=='messaging_container'&&!$('#messaging_container').find(e.target).length){hide_messaging_box(e);}}
var $account_menu=$("#account_menu");if($account_menu.hasClass('showing')){if(e.target.id!=='account_link'&&!$('#account_link').find(e.target).length){hide_account_menu();}}
var $search_results_box=$("#u-search-results");if($search_results_box.hasClass('showing')){if(e.target.id!=='search_container'&&!$('#search_container').find(e.target).length){hide_search_results_box();}}
hide_image_mod();});$('.row_container').bind('mousewheel DOMMouseScroll',function(e){var scrollTo=null;if(e.type==='mousewheel'){scrollTo=(e.originalEvent.wheelDelta*-1);}else if(e.type==='DOMMouseScroll'){scrollTo=40*e.originalEvent.detail;}
if(scrollTo){e.preventDefault();$(this).scrollTop(scrollTo+$(this).scrollTop());}});PageData.loading_more_notifs=false;$("#notification_list, #notification_list_ul").on({'scroll':function(){if(PageData.loading_more_notifs||!PageData.last_notification_id){return;}
var scrollPos=this.scrollTop+$(this).height();var scrollHeight=this.scrollHeight;if(scrollPos>=scrollHeight-50){PageData.loading_more_notifs=true;var per_page=10;PageData.get_notifications(PageData.last_notification_id,per_page,'scroll_action');}}});$('#notification_box').on({'click':function(e){var go_to_url=$(this).attr('notif_url');if(!go_to_url){return;}
PageData.track_event('notification_box','notification_url_clicked');window.location.assign(go_to_url);}},'.dropdown_row');$("#messaging_container").on({'click':function(e){if(State.page_state=='messages'){return window.location.reload();}
if(!$(e.target).parents("#messaging_box").length){maybe_open_messaging_box(include_close=true);}},});$("#notification_container").on({'click':function(e){if(State.page_state=='notifications'){return window.location.reload();}
if(!$(e.target).parents("#notification_box").length){maybe_open_notification_box(include_close=true);}}});PageData.loading_more_messages=false;$("#messages_list").on({'scroll':function(){if(PageData.loading_more_messages||!PageData.top_message_tab_page_num){return;}
var scrollPos=this.scrollTop+$(this).height();var scrollHeight=this.scrollHeight;if(scrollPos>=scrollHeight-50){PageData.loading_more_messages=true;PageData.message_load_action_type='scroll_action';var page=PageData.top_message_tab_page_num;var per_page=8;PageData.get_threads(page,per_page);}}});$("#account_menu_container").click(function(e){if($("#account_menu").hasClass('showing')){hide_account_menu();}else{show_account_menu();}});});var Helpers=(function($){var my={};my.each=$.each;my.disableScroll=function(){var top=$("html").scrollTop();$("html").css("overflow","hidden").scrollTop(top);};my.enableScroll=function(){var top=$("html").scrollTop();$("html").css("overflow","auto").scrollTop(top);};my.deselectText=function(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty();}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges();}}else if(document.selection){document.selection.empty();}};my.assert=function(cond,msg){if(!cond||cond===undefined){throw new Error(msg||'assertion failed'+cond);}};my.whichTransitionEnd=function($elem){var transitions={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd otransitionend','transition':'transitionend'};for(var t in transitions){if($elem.style[t]!==undefined){return transitions[t];}}},my.updateCountdown=function($elem,max,$countdown){var classname,old_classname;max=max||140;$countdown=$countdown||$(".countdown");var remaining=max-$elem.val().length;classname=(remaining<0)?"red":"grey";old_classname=(remaining<0)?"grey":"red";$countdown.removeClass(old_classname).addClass(classname).text(remaining);};my.checkImageURL=function(url){return(url.match(/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/)!=null);};my.get_window_dimensions=function(){PageData.window_height=$(window).height();PageData.window_width=$(window).width();};my.isEmptyObject=function(obj){for(var k in obj){if(obj.hasOwnProperty(k)){return false;}}
return true;};my.makeArrayUniqueObjects=function(array,key_name){var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i][key_name]===a[j][key_name])
a.splice(j--,1);}}
return a;};my.copyObj=function(obj,old_obj,include_funcs,deep,pd_key,id){deep=deep!==undefined?deep:false;var new_obj={};var k;if(old_obj){for(k in old_obj){if(!old_obj.hasOwnProperty(k))continue;new_obj[k]=old_obj[k];}}
var item;for(k in obj){item=obj[k];if(!obj.hasOwnProperty(k)||(!include_funcs&&typeof item=='function')){continue;}
var action_prefix=PageData.get_prefix(k);var final_attr=action_prefix.attr;if(deep){if(typeof item=='object'&&item.length===undefined){item=my.copyObj(obj[k],null,include_funcs,deep);}}else if($.isArray(item)&&new_obj[final_attr]!==undefined){if(!new_obj[final_attr]||new_obj[final_attr]===undefined){new_obj[final_attr]=[];}
if(action_prefix.prefix){item=PageData.handle_action_prefix(action_prefix,k,obj,pd_key,id,true);}else{Helpers.extendArray(new_obj[final_attr],item,true);item=new_obj[k];}}
new_obj[final_attr]=item;}
return new_obj;};my.deepCopy=function(obj){return my.copyObj(obj,null,true,true);};my.extendArray=function(arr_a,arr_b,no_dupes){if(no_dupes){var map={};var member;var i,l;for(i=0,l=arr_a.length;i<l;i++){member=arr_a[i];map[member]=true;}
for(i=0,l=arr_b.length;i<l;i++){member=arr_b[i];if(!map[member]){arr_a.push(member);map[member]=true;}}
return arr_a;}else{return arr_a.push.apply(arr_a,arr_b);}};my.getMapFromIds=function(ids){var id;var i;var l;var map={};if(!ids||!ids.length){return map;}
for(i=0,l=ids.length;i<l;i++){id=ids[i];map[id]=1;}
return map;};my.closeTo=function(numa,numb,max_distance){max_distance=max_distance===undefined?3:max_distance||0;return Math.abs(numa-numb)<=max_distance;};my.filterObjFromMap=function(obj,map){var new_obj={};for(var k in obj){if(map[k]){new_obj[k]=obj[k];}}
return new_obj;};my.INFOS_KEY_MAP={recent_user_ids:'users',image_ids:'images',resharer_ids:'users',subscription_ids:'users',subscriber_ids:'users',liked_ids:'users',comment_ids:'comments'};my.populateShareUserInfo=function(info,type,infos){var id_suffix=type+'_id';if(info[id_suffix]!=info['original_'+id_suffix]){var original_user_id=info.original_user_id;var original_user_info=infos.users[original_user_id];if(original_user_id&&original_user_info){info['original_user_info']=original_user_info;}
var reshared_user_id=info.reshared_user_id;var reshared_user_info=infos.users[reshared_user_id];if(reshared_user_id&&reshared_user_info){info['reshared_user_info']=reshared_user_info;}}};my.buildRenderData=function(ids,id_type,infos,include_users,recursing){if(!ids||ids===undefined)return[];infos=infos||{feed:PageData.feed,users:PageData.users,images:PageData.images,comments:PageData.comments,galleries:PageData.galleries,ads:PageData.ads};id_type=id_type||'images';recursing=recursing||false;include_users=include_users!==undefined?include_users:true;var info;var id;var user_id;var i;var l;var k;var subinfo_key;var user_info;var new_key;var offset;var render_data=[];for(i=0,l=ids.length;i<l;i++){id=ids[i];if(id_type=="users"&&State.is_logged_in()&&id==PageData.my_info.user_id){info=PageData.my_info;}else{if(typeof id!=='number'){if(id.substring(0,2)=="i:"){id_type="images";id=id.substring(2);}else if(id.substring(0,2)=="a:"){id_type="ads";id=id.substring(2);}}
info=infos[id_type][id];}
if(!info){continue;}
if(id_type=="images"||(id_type=='ads'&&info.gallery_id!==undefined)){var max_comments=PageData.experiment_config.desktop_max_comments?PageData.experiment_config.desktop_max_comments:5;if(info.num_comments>max_comments){info.view_all_comments=1;}
if(info.type=="video"&&!info.video_type){if(is_youtube_video(info.attribution_url)){info['video_type']='youtube';}else if(is_vine_video(info.attribution_url)){info['video_type']='vine';}}
if(info['parsed_description']){info['parsed_description'].forEach(function(elem,index){if(elem.type=='text'){info['parsed_description'][index]['content']=elem.content.replace(/[\n\r]/g,'&nbsp;\n');}});}}
if(include_users&&id_type!=='users'){user_id=info.user_id;user_info=infos.users[user_id];if(user_id&&user_info){info=my.copyObj(info,user_info);}
if(id_type=="images"){my.populateShareUserInfo(info,'image',infos);if(info.gallery_id&&id_type!=='ads'){var gallery=my.copyObj(infos.galleries[info.gallery_id],null);my.populateShareUserInfo(gallery,'gallery',infos);var max_comments=PageData.experiment_config.desktop_max_comments?PageData.experiment_config.desktop_max_comments:5;gallery['comments']=(gallery['comment_ids']&&gallery['comment_ids'].length)?my.buildRenderData(gallery['comment_ids'].slice(-max_comments),'comments',infos,true,false):[];if(gallery.comment_ids&&gallery.comment_ids.length>10){gallery.view_all_comments=1;}
gallery['recent_users']=(gallery['recent_user_ids']&&gallery['recent_user_ids'].length)?my.buildRenderData(gallery['recent_user_ids'].slice(0,20),'users',infos,false,true):[];info['gallery_info']=gallery;}}
if(id_type=="comments"&&PageData&&PageData.my_info&&PageData.images[info['image_id']]&&(window.internal_only||PageData.images[info['image_id']].user_id==PageData.my_info.user_id||info['user_id']==PageData.my_info.user_id)){info['admin']=true;}}
if(!recursing){for(k in info){if(!info.hasOwnProperty(k)||!info[k])continue;offset=k.length-4;if(k.substr(offset)=='_ids'){new_key=k.slice(0,offset)+'s';subinfo_key=my.INFOS_KEY_MAP[k]||'users';if(k.slice(k.length-11,k.length)=='comment_ids'){info[new_key]=my.buildRenderData(info[k].slice(-(PageData.experiment_config.desktop_max_comments?PageData.experiment_config.desktop_max_comments:5)),'comments',infos,true,false);}else{info[new_key]=my.buildRenderData(info[k].slice(0,20),subinfo_key,infos,false,true);}}}}
if(info&&!$.isEmptyObject(info)){render_data.push(info);}}
return render_data;};my.buildImageRows=function(image_rows){var rows=[],row,images,image_ids,r,i,l;for(i=0,l=image_rows.length;i<l;i++){row=image_rows[i];image_ids=row['image_ids'];r=my.buildRenderData(image_ids);rows.push({'images':r,'height':row.height});}
return rows;};my.iFrameCreate=function(api){api=api||{};var $iframe=$('<iframe />');$iframe.attr({id:api.iframe_name||api.name+'_iframe',name:api.name}).css({height:'0px',width:'0px',position:'absolute',top:'0',left:'0',display:'none'}).appendTo('body');return $iframe;};my.injectScript=function(src,lock_id){if(lock_id){var $old_script=$('#'+lock_id);if($old_script.length){$old_script.remove();}}
var $script=$('<script />');$script.attr({src:src,type:'text/javascript'}).appendTo('head');return $script;};my.parent=function($elem,selector,i){i=i||0;var $par;$par=$elem.parent();if(!$par.length||$par.is(selector)){return $par}
return my.parent($par,selector,++i);};my.save_comment_obj=function(obj_type,content,comment_info,opts){opts=opts||{};var comment_obj;if(obj_type!="text"&&comment_info['curr_text'].length){comment_obj={'type':'text','content':comment_info['curr_text']};comment_info['comment_map'].push(comment_obj);}
comment_obj={'type':obj_type,'content':content};if(opts.full_url){comment_obj['full_url']=opts.full_url;}
comment_info['comment_map'].push(comment_obj);comment_info['curr_text']="";return comment_info;};my.get_location=function(href){var l=document.createElement("a");l.href=href;return l;};var ending_punc_re=/[^A-Za-z0-9]+$/;var bad_chars_re=/\W/g;var tag_word_re=/[0-9A-Za-z_\-]+/;my.get_tags=function(text,hash){var i,l;var tags=[];var words=text.split(' ');var word;for(i=0,l=words.length;i<l;i++){word=words[i];if(word.length){if(hash&&word[0]==='#'){word=word.slice(1,word.length);}else if(hash&&word[0]!=='#'){continue;}
word=tag_word_re.exec(word);if(word){word=word[0];}else{continue;}
if(word.length>1){tags.push(word);}}}
return tags;};var final_timeout;var give_up=false;my.on_create=function(elem_id,callback,subselector,extra){if(final_timeout===undefined){final_timeout=setTimeout(function(){give_up=true;},10000);}
if(give_up){give_up=false;return;}
var elem=document.getElementById(elem_id);if(!elem){return setTimeout(function(){my.on_create(elem_id,callback,subselector,extra);},200);}
var $elem=$(elem);if(subselector){$elem=$elem.find(subselector);}
if(!$elem.length){return setTimeout(function(){my.on_create(elem_id,callback,subselector,extra);},200);}
if(callback){callback($elem,extra);}};my.in_view=function($elem){var inner_h=$(window).height();var off_h=window.pageYOffset||document.scrollTop||document.body.scrollTop;var elem_height=$elem.height();var elem_top=$elem.offset().top;if(elem_top+elem_height>off_h&&elem_top<off_h+inner_h){return(off_h+inner_h)-elem_top;}
return false;};my.get_image_height=function(src,cb){var $img=$('<img src="'+src+'" style="position: absolute; left: -10000px; top: -10000px;" />');$img.load(function(e){cb($img.height());$img.remove();});$$('body').append($img);};my.get_external_url_for_image=function(image_id){var user_name;if(PageData.images[image_id].user_id==PageData.my_info.user_id){user_name=PageData.my_info.user_name;}else{user_name=PageData.users[PageData.images[image_id].user_id].user_name;}
return window.location.protocol+PageData.profile_url(user_name,true)+'/'+image_id;};my.get_external_url_for_gallery=function(gallery_id){var user_name;var gallery=PageData.galleries[gallery_id];if(gallery.user_id==PageData.my_info.user_id){user_name=PageData.my_info.user_name;}else{user_name=PageData.users[gallery.user_id].user_name;}
return window.location.protocol+PageData.profile_url(user_name,true)+'/'+gallery.path_name;};my.image_ids_already_displayed=function(){var feed_images=$("#channel_images .list_view_item_container").map(function(index,element){var attr_image_id=$(element).attr('image_id');if(attr_image_id!=undefined){return parseInt(attr_image_id);}});var rt_images=[];if(PageData.RT_FEED&&PageData.RT_FEED.map){rt_images=PageData.RT_FEED.map(function(index,element){var img_id=element.image_id;if(img_id!=undefined){return parseInt(img_id);}});}
return feed_images.extend(rt_images);};my.ads_already_displayed=function(){return $("#channel_images .promo").map(function(index,element){var attr_ad_id=$(element).attr('prid');if(attr_ad_id!=undefined){return parseInt(attr_ad_id);}});};my.remove_common_elements=function(array_to_change,reference_array,prefix){var pre=prefix?prefix:'i:';if(typeof array_to_change[0]!=='number'&&typeof reference_array[0]==='number'){reference_array=$.map($(reference_array),function(val,i){return pre+val;});}
return $.makeArray($(array_to_change).not($(reference_array)));};my.remove_consecutive_ads=function(feed_ids,separation){var min_separation=separation||4;var curr_separation=0;function process_feed_state(ids,curr_index,remove){if(ids[curr_index].substring(0,2)=="a:"){if(curr_separation>0){if(remove){ids.splice(curr_index,1);}
return;}
curr_separation=min_separation;}else{curr_separation--;}}
var lookback=PageData.feed.image_ids.length-min_separation*2;for(var j=PageData.feed.image_ids.length-1;j>=0&&j>=lookback;j--){process_feed_state(PageData.feed.image_ids,j,false);}
for(var i=feed_ids.length-1;i>=0;i--){process_feed_state(feed_ids,i,true);}
return feed_ids;};return my;}(jQuery));var yt_url_re=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;var vine_url_re=/^(?:https?:\/\/)?(?:www\.)?vine\.co\/v\/([a-zA-Z0-9])/;function setup_youtube_events(){$("#thepage").on({"click":function(){if($(this).find("iframe").length){return;}
var url=$(this).attr('yt_url');var vid_id=is_youtube_video(url);var cont_id=$(this).attr('id');if(!vid_id||!cont_id){return;}
var user_match=($(this).hasClass("user_match_video"));var width=(user_match)?366:560;var height=(user_match)?228:315;if($(this).hasClass("fill")){width=$(this).css('width');height=$(this).css('height');}
var markup="<iframe width='"+width+"' height='"+height+"' src='//www.youtube.com/embed/"+vid_id+"?autoplay=1' frameborder='0' allowfullscreen></iframe>";$(this).find('.yt_placeholder').empty().html(markup);$(this).find('.overlay_wrapper').empty();}},".ytplayer");}
function is_youtube_video(url){if(!url){return false;}
var vid_id=url.match(yt_url_re);if(vid_id){return vid_id[1];}else{return false;}}
function is_vine_video(url){if(!url){return false;}
var vine_id=url.match(vine_url_re);if(vine_id){return true;}else{return false;}}
$().ready(function(){setup_youtube_events();});jQuery.fn.autogrow=function(options){options=options||{};options.class_name=options.class_name||"comment_text_input";options.min_height=options.min_height||18;var animated=false;if(this.css('min-height'))options.min_height=parseInt(this.css('min-height'));this.bind('keydown',function(e){if(e.which==13&&options.enter_callback){var retval=options.enter_callback(e);if(retval!==undefined)return retval;}
if(options.keydown_callback)options.keydown_callback(e);var $this=$(this);window.setTimeout(function(){var $div=$('<div class="'+options.class_name+'"></div>');$div.text($this.val()+(options.growth_suffix||''));$div.css({'position':'absolute','top':'-10000px','height':'auto','white-space':'pre-wrap','font-family':'"Helvetica Neue",Helvetica,Arial,sans-serif','width':$this.width()+'px'});$this.parent().append($div);var current_height=$this.height();var new_height=Math.floor(Math.max($div.height(),options.min_height));var padding_y;if($this.css("box-sizing")=="border-box"){var padding_y=parseInt($this.css("padding-top"))+parseInt($this.css("padding-bottom"));}
if(Math.abs(new_height-current_height)>5&&!animated){if(padding_y){$this.css("height",new_height+"px");}else{animated=true;$this.animate({'height':new_height+'px'},200,null,function(){animated=false;});}}
e=null;$this=null;$div.remove();$div=null;},10);});return this;};function noop(){};window.console=window.console||{log:noop,error:noop};Array.prototype.max=function(){if(this.hasOwnProperty('length')){return Math.max.apply(Math,this);}};Array.prototype.min=function(){if(this.hasOwnProperty('length')){return Math.min.apply(Math,this);}};jQuery.fn.fadeInSafe=function(opt_time,opt_cb){var $this=this;$this.fadeIn(opt_time,opt_cb);return this;};jQuery.fn.fadeOutSafe=function(opt_time,opt_cb){var $this=this;$this.fadeOut(opt_time,opt_cb);return this;};function num_true_in_object(obj){var num_true=0;for(var k in obj){if(obj[k]){num_true++;}}
return num_true;};function module(name){if(window[name]){return window[name];}
return window[name]={};}
function now(){return(new Date()).getTime();}
function page_ready(){if($.fn.tipsy){$('img.tooltip,a.tooltip,div.tooltip').tipsy({delayIn:100,fade:150,opacity:1,live:true,gravity:function(){return $(this).attr("tooltip-gravity")||'s';}});}}
$().ready(page_ready);function doSetCaretPosition(oField,iCaretPos){if(document.selection){oField.focus();var oSel=document.selection.createRange();oSel.moveStart('character',-oField.value.length);oSel.moveStart('character',iCaretPos);oSel.moveEnd('character',0);oSel.select();}
else if(oField.selectionStart||oField.selectionStart=='0'){oField.selectionStart=iCaretPos;oField.selectionEnd=iCaretPos;oField.focus();}}
function is_ipad(){var ua=navigator.userAgent;var isiPad=/iPad/i.test(ua);return isiPad;}
function is_small_screen_ios_device(){return navigator.userAgent.match(/(iPhone)|(iPod)/i);}
function unwrap_thumbnail(url){if(!url||url===undefined){return;}
var info=url.match(/http:\/\/upload.mylikes.com\/thumb\/yt:[a-z0-9A-Z_\-]+\?thumbnail=([^&]*)&/);if(info){return unescape(info[1]);}
return url;}
function float_message_near($div,message){var $floater=$('<div class="floating_notification">'+message+'</div>');var offset=$div.offset();$$('body').append($floater);$floater.css({top:(offset.top+5)+'px',left:(offset.left+$div.width()/2-$floater.width()/2)+'px'});$floater.animate({top:"-=25",opacity:0},1500,'linear',function(){$floater.remove();});}
function validateURL(val,elem){val=$.trim(val);if(val.length==0){return true;}
if(!/^(https?|ftp):\/\//i.test(val)){val='http://'+val;$(elem).val(val);}
return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&amp;'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(val);}
function getParameterByName(name){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.search);return(results==null)?"":decodeURIComponent(results[1].replace(/\+/g," "));}
function maybe_go_back(e){if(history.length>(navigator.userAgent.match(/Chrome/)?2:1)){history.go(-1);e.preventDefault();return false;}}
error_handling_broken=false;in_error_handler=false;window.onerror=function(m,u,l){if((u==null||u.length==0)&&l==0&&m=='Script error.')return false;if(error_handling_broken)return false;if(in_error_handler){error_handling_broken=true;return false;}
in_error_handler=true;if(window.$){var message="  user: "+(window.PageData&&PageData.my_info&&PageData.my_info.user_name||'loggedout')+' - url: '+window.location.href+'\n';message+='  message: '+m+'\n';message+='  url: '+u+'\n';message+='  line: '+l;if(window.likes_error_tracking){$.post('/api/track_error',{'message':message}).error(function(){error_handling_broken=true;});}}
in_error_handler=false;return false;};function listen_for_key_controls(e){if(e.hasOwnProperty('originalEvent')&&e.originalEvent.altKey===false){$('#next_arrow,#prev_arrow').each(function(){var $this=$(this);if($this&&$this.attr('href')){$this.attr('href',$this.attr('href').replace(/&z=[^&]*/g,''));}});}
if(e.which){switch(e.which){case 37:if($("#prev_arrow").length){window.location.href=$("#prev_arrow").attr('href');}else if(PageData.my_info){window.location.href="/";}
break;case 39:if($("#next_arrow").length){window.location.href=$("#next_arrow").attr('href');}else if($("#next_ad").length){window.location.href=$("#next_ad").attr('href');}else if(PageData.my_info){window.location.href="/";}
break;case 27:if(PageData.my_info){window.location.href="/";}
break;}}};function on_subscribe_success(data){if(data.success){$(".email_notification").fadeIn().delay(4000).fadeOut();$("input.email_input").val("");}}
function scroll_functions_go($this){var $container=$(this);var pixels_from_bottom=(document.getElementById('posts_container').scrollHeight-($container.height()+$container.scrollTop()));var theme;if(PageData.feed.common_domain_sulu){theme='sulu';}else if(PageData.feed.format){theme=PageData.feed.format;}
if(pixels_from_bottom<1000&&PageData.next_page&&State.page_state!="single_image"){if(theme=="collage"&&PageData.next_page==1&&!PageData.MOBILE){return;}else if(theme){get_page(PageData.tag_path);}
else if(PageData.feed.sub_page){if(PageData.feed.sub_page=="likes"){PageData.get_user_likes();}else if(PageData.feed.sub_page=="tagged"){PageData.get_user_tagged(PageData.next_page,PageData.user_info.user_id,PageData.tag_path);}else if(PageData.feed.sub_page=="about"){return;}}else{PageData.get_user_page_feed(PageData.next_page,PageData.user_info.user_id);}}}
var Render=(function(){var my={};my.build_render_sulu_posts=function(display){for(var i=0;i<display['images'].length;i++){if(i%3){$("#main_col").append(ich.list_post(display['images'][i]));if(PageData.MOBILE){$(".list_post").each(function(){if(!($(this).children("div:first").hasClass('sulu_list_post'))){$(this).children("div:first").addClass('sulu_list_post');}});$("span.num_likes, span.num_shares").each(function(){if($(this).html().trim()==""){$(this).html("0");}});}}else{$("#right_col").append(ich.overlay_post(display['images'][i]));}}};my.build_render_penny_posts=function(display){$("#posts_container_inner").append(ich.penny_posts(display));};my.build_render_nova_posts=function(display){if(!PageData.MOBILE){var all_images=display['images'].length;var left_col=right_start=Math.round(all_images*0.4);var right_col=all_images-left_col;for(var i=0;i<left_col;i++){$("#main_col").append(ich.list_post(display['images'][i]));}
for(var x=right_start;x<all_images;x++){$("#overlay_post_list").append(ich.overlay_post(display['images'][x]));}}else{for(var i=0;i<display['images'].length;i++){$("#right_col").append(ich.overlay_post(display['images'][i]));}}};my.build_render_nest_posts=function(display){if(!PageData.MOBILE){var all_images=display['images'].length;var left_col=right_start=Math.round(all_images*0.6);var right_col=all_images-left_col;for(var i=0;i<left_col;i++){$("#main_col").append(ich.list_post(display['images'][i]));}
for(var x=right_start;x<all_images;x++){$("#overlay_post_list").append(ich.overlay_post(display['images'][x]));}
$("a.list_post").each(function(){if(!$(this).find(".link_icon").length){$(this).append('<span class="link_icon"></span>');}})}else{for(var i=0;i<display['images'].length;i++){$("#right_col").append(ich.overlay_post(display['images'][i]));}}};my.build_render_titan_posts=function(display){if(!PageData.MOBILE){var all_images=display['images'].length;var left_col=right_start=Math.round(all_images*0.4);var right_col=all_images-left_col;for(var i=0;i<left_col;i++){$("#main_col").append(ich.list_post(display['images'][i]));$("#main_col").append(ich.social_share(display['images'][i]));}
for(var x=right_start;x<all_images;x++){$("#overlay_post_list").append(ich.overlay_post(display['images'][x]));}}else{for(var i=0;i<display['images'].length;i++){$("#right_col").append(ich.overlay_post(display['images'][i]));}}};my.build_render_arcadia_posts=function(display){if(!PageData.MOBILE){var all_images=display['images'].length;var left_col=right_start=Math.round(all_images*0.6);var right_col=all_images-left_col;for(var i=0;i<left_col;i++){$("#main_col").append(ich.list_post(display['images'][i]));}
for(var x=right_start;x<all_images;x++){$("#overlay_post_list").append(ich.overlay_post(display['images'][x]));}}else{for(var i=0;i<display['images'].length;i++){$("#right_col").append(ich.overlay_post(display['images'][i]));}}};my.build_render_inspire_posts=function(display){if(!PageData.MOBILE){var all_images=display['images'].length;var left_col=right_start=Math.round(all_images*0.6);var right_col=all_images-left_col;for(var i=0;i<left_col;i++){$("#main_col").append(ich.list_post(display['images'][i]));}
for(var x=right_start;x<all_images;x++){$("#overlay_post_list").append(ich.overlay_post(display['images'][x]));}
$("a.list_post").each(function(){if(!$(this).find(".link_icon").length){$(this).append('<span class="link_icon"></span>');}})}else{for(var i=0;i<display['images'].length;i++){$("#right_col").append(ich.overlay_post(display['images'][i]));}}};my.build_render_collage_posts=function(display){if(!PageData.MOBILE){var all_images=display['images'].length;var left_col=right_start=Math.round(all_images*0.4);var right_col=all_images-left_col;for(var i=0;i<left_col;i++){$("#main_col").append(ich.new_list_post(display['images'][i]));}
for(var x=right_start;x<all_images;x++){$("#right_col").append(ich.square_side_post(display['images'][x]));}}else{for(var i=0;i<display['images'].length;i++){display['images'][i]["mobile"]=true;display['images'][i]["theme_format"]=PageData.theme_format;$("#main_col").append(ich.new_list_post(display['images'][i]));}}};my.render_get_feed=function(data){var result=data.result,markup,markup_1,markup_2,display,add_tutorial_markup;display={'show_plus':PageData.feed.show_plus,'my_info':PageData.my_info,'page_state':State.page_state,'internal_only':window.internal_only};if(State.page_state=="user"&&State.is_my_channel){display.is_my_channel=true;}
if(State.page_state=="label"){display.label=PageData.feed.label;}
if(data.markup&&data.markup.length){markup=data.markup;}else if(result.feed&&result.feed.image_rows&&view=="grid"){display.image_rows=Helpers.buildImageRows(result.feed.image_rows);if(result.feed.image_rows.length){markup=ich.grid_fixed_h(display);}else if(!PageData.feed.image_ids.length){markup=ich.grid_fixed_h(display);}}else{if(data.display_images){display.images=data.display_images;}else{var feed_ids=(State.page_state!="people")?result.feed.image_ids:result.feed.suggested_user_ids;feed_ids=Helpers.remove_common_elements(feed_ids,Helpers.image_ids_already_displayed());if(result.ads){feed_ids=Helpers.remove_common_elements(feed_ids,Helpers.ads_already_displayed(),'a:');feed_ids=Helpers.remove_consecutive_ads(feed_ids);}
if(feed_ids.length<1&&!PageData.feed.image_ids.length){PageData.next_page=undefined;}
display.images=Helpers.buildRenderData(feed_ids,'images',result);}
display.hostname=window.location.hostname;if(display.images.length>0||PageData.feed.image_ids.length==0){display.domain_url=PageData.domain_url||window.location.hostname;display.format=PageData.feed.format;display.custom_profile=true;if(display.format=="sulu"){my.build_render_sulu_posts(display);}else if(display.format=="penny"){my.build_render_penny_posts(display);}else if(display.format=="nova"){my.build_render_nova_posts(display);}else if(display.format=="nest"){my.build_render_nest_posts(display);}else if(display.format=="titan"){my.build_render_titan_posts(display);}else if(display.format=="arcadia"){my.build_render_arcadia_posts(display);}else if(display.format=="inspire"){my.build_render_inspire_posts(display);}else if(display.format=="collage"){my.build_render_collage_posts(display);}else{markup=ich.custom_posts(display);}}}
$('#feed_loading_spinny').remove();$("#posts_container").append(markup);};return my;}());$().ready(function(){if(!PageData.initialized){window.State={};PageData.initialize(window.pass_to_js);}
$("body").on({'click':function(){var $full_url=$(this).parent().find(".share_url_full");$full_url.show();}},".share_url");$("body").on({'mousedown':function(e){if(!$(e.target).closest(".basic_dialog_inner").length){$(".basic_dialog").hide();}}},".basic_dialog");$("body").on({'mousedown':function(e){$(".basic_dialog").hide();}},".basic_dialog .close");$("#posts_container").on({"mouseover":function(e){var $this=$(this);if($this.find(".social_media_container").css("visibility")=="hidden"){$(".social_media_container.side").css("visibility","hidden");$(".basic_dialog").hide();$(this).find(".social_media_container").css("visibility","visible");}},"mouseout":function(e){}},".custom_profile_wrapper .image");$("#page_contents").on({'click':function(e){var event_label="control";if(PageData.experiment_config.domains_desktop_front_ad){event_label=(PageData.experiment_config.start_msg)?"start and start msg":"start and next msg";}
PageData.track_event("custom_domain_gallery_started",event_label,PageData.feed.gallery_id);}},".track_next");if($("#next_arrow").length){$(document).keydown(listen_for_key_controls);}
$(window).on({'scroll':function(e){var $posts=$("#posts_container");if(!$posts.length||(Api&&Api.curr_requests.feed)){return;}
scroll_functions_go($(this));}});function email_subscribe(email){var params={'email':email,'user_id':PageData.feed.include_user_id||PageData.feed.user_id,};Api.send_api_request(on_subscribe_success,"email_subscribe",params);}
$(".email_form").submit(function(e){e.preventDefault();var email=$(this).find("input.email_input").val().trim();email_subscribe(email);});});$(window).on('scroll',function(){var $posts=$("#posts_container");var pixels_from_top=$(window).scrollTop();var document_height=$(document).height();var window_height=$(window).height();if(PageData.likes_homepage_sulu||PageData.feed.common_domain_sulu){if(!$posts.length||(Api&&Api.curr_requests.feed)){return;}
if(pixels_from_top==document_height-window_height){scroll_functions_go($(this));}};});$(function(){if(window.v_param||window.s_param){$('[href]').each(function(){var $this=$(this),url=$this.attr('href');if(!url)return;if(this.target=="_blank")return;var match=url.match(/[?&]v=([a-zA-Z0-9\_]+)/);if(window.v_param&&match&&match[1]!=window.v_param){url=url.replace('v='+match[1],'v='+window.v_param);}
match=url.match(/[?&]s=([a-zA-Z0-9\_]+)/);if(window.s_param&&match&&match[1]!=window.s_param){url=url.replace('s='+match[1],'s='+window.s_param);}
$this.attr('href',url);});}
$(".custom_next_button").click(function(e){if($('#ajax_ad_page').length){var js_bundle=window.pass_to_js||window.PageData;var $ad_page=$("#ajax_ad_page");$('#onepager_content').hide();$ad_page.fadeIn(250);window.scrollTo(0,0);if(window.likes_tracking){var track_id=$("#ajax_ad_page").attr("track_id");window.top.likes_tracking_create();window.top.likes_tracking.start_tracking(track_id,'ad_page');window.top.likes_tracking.track_house_ad(js_bundle.ad_page);}
e.preventDefault();return false;}});});$().ready(function(){$("#thepage,#backpage,#page_contents").on({'click':function(){var $this=$(this);var custom=PageData.feed.custom_profile;var image_id,info;if(State.page_state=="single_image"||custom){image_id=$("#single_image_thumbnail").attr("image_id");}else if($("#backpage").is(":visible")){image_id=$('#browser_image').attr("image_id");}else{image_id=Helpers.parent($this,".list_view_item_container").attr("image_id");}
if(!image_id){return;}
info=PageData.images[image_id];if(!info&&custom){return;}
if($this.hasClass('share_twitter')){PageData.track_event('share_external','twitter',image_id);}
if($this.hasClass('share_fb')){PageData.track_event('share_external','facebook',image_id);}
if($this.hasClass('share_tumblr')){PageData.track_event('share_external','tumblr',image_id);}
if($this.hasClass('share_url')){PageData.track_event('share_external','url',image_id);}}},".share_button");});if($("#contact_form_inner").length){function validate_contact_form(name,email,message){var error;var empty_fields=[];if(!name||!name.length){empty_fields.push("name");}
if(!email||!email.length){empty_fields.push("email");}
if(!message||!message.length){empty_fields.push("message");}
if(empty_fields.length){error="Please provide: "+empty_fields.join(", ");return error;}
var filter=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;var email_valid=String(email).search(filter)!=-1;if(!email_valid){return"Email address invalid.";}
if(message.length<10){return"Please write a longer message so we can better help you.";}}
function send_contact_form(){var $this=$("#contact_form_inner");if($this.hasClass('clicked'))
return false;var params={};params.ajax=true;params.name=$("#contacter_name").val();params.email=$.trim($("#contacter_email").val());params.message=$("#contacter_message").val();var $fields=$this.find("input[type='hidden']");for(var i=0,l=$fields.length;i<l;i++){var field=$fields[i];if(field.value&&field.value.length){params[field.name]=field.value;}}
$this.addClass('clicked');Notifications.fadeStaticNotification();$.ajax({type:"POST",dataType:'json',data:$.param(params),url:Api.get_uri('send_help_email'),success:function(data){if(data.success){$('#contact_form_inner').hide();if(data.message){var markup="<p class='message'>"+data.message+"</p>";$("#contact_inner").append(markup);}
$this.removeClass('clicked');}else{if(data.error){Notifications.renderStaticNotification("error",error);}
$this.removeClass('clicked');}}});return false;}}
if($("#contact_map").length){var contact_page={};contact_page.initialize_contact_maps=function(){var myLatlng=new google.maps.LatLng(37.7700670,-122.4076030);var mapOptions={zoom:14,center:myLatlng,mapTypeId:google.maps.MapTypeId.ROADMAP}
var map=new google.maps.Map(document.getElementById('contact_map'),mapOptions);var marker=new google.maps.Marker({position:myLatlng,map:map,title:'MyLikes Office'});google.maps.event.addDomListener(window,'resize',function(){map.setCenter(new google.maps.LatLng(37.774582,-122.408981));});}
$().ready(contact_page.initialize_contact_maps);}
var Notifications=(function(){var my={};my.showNotification=function(type,content,severity,time_to_show){};my.renderStaticNotification=function(severity,content,opt_name){if(typeof content!="string"){if(severity!='error'){return;}
content='Whoops, we had trouble handling your request.';}
$("#staticNotificationBg").html("").remove();if(severity===undefined)severity='recent_action';var colorval,bgcolorval,bgclass;switch(severity){case'recent_action':bgclass='yellow_notification';break;case'error':bgclass='red_notification';break;case'success':bgclass='blue_notification';break;case'success_white':bgclass='white_notification';break;}
var notification_markup="<div id='staticNotificationBg'><div class='staticNotification_inner "+bgclass+"'><div class='transparent_bg'>"+content+"</div><div class='content_over_transparent'>"+content+"</div></div></div>";$("body").append(notification_markup);if(window.MOBILE){$("#staticNotificationBg").fadeIn(500);}else{$("#staticNotificationBg").fadeInSafe(500);}
notification_markup=null;colorval=null;bgcolorval=null;};my.renderTemporaryNotification=function(severity,content,time_to_show){if(typeof content!="string"){if(severity!='error'){return;}
content='Whoops, we had trouble handling your request.';}
$("#tempNotificationBg").html("").remove();if(severity===undefined)severity='recent_action';if(time_to_show===undefined)time_to_show=5000;var colorval,bgcolorval,bgclass;switch(severity){case'recent_action':bgclass='yellow_notification';break;case'error':bgclass='red_notification';break;case'success':bgclass='blue_notification';break;case'success_white':bgclass='white_notification';break;}
var notification_markup="<div id='tempNotificationBg' ";if($("#staticNotificationBg").length){notification_markup+="style='top:115px;'";}
notification_markup+="><div class='tempNotification_inner "+bgclass+"'><div class='transparent_bg'>"+content+"</div><div class='content_over_transparent'>"+content+"</div></div></div>";$("body").append(notification_markup);if(window.MOBILE){$("#tempNotificationBg").fadeIn(500);}else{$("#tempNotificationBg").fadeInSafe(500);}
notification_markup=null;colorval=null;bgcolorval=null;setTimeout(my.fadeNotification,time_to_show);};my.fadeNotification=function(){if(window.MOBILE){$("#tempNotificationBg").fadeOut(1000);}else{$("#tempNotificationBg").fadeOutSafe(1000);}};my.fadeStaticNotification=function(){if(window.MOBILE){$("#staticNotificationBg").fadeOut(1000);}else{$("#staticNotificationBg").fadeOutSafe(1000);}};my.renderNotifications=function(pass_to_js){var i;var notification;pass_to_js=pass_to_js||window.pass_to_js;if(pass_to_js!==undefined&&pass_to_js.page_notifications){i=0;for(i=0;i<pass_to_js.page_notifications.length;i++){notification=pass_to_js.page_notifications[i];if(notification.type==='static'){my.renderStaticNotification(notification.severity,notification.content,notification.name);}else{my.renderTemporaryNotification(notification.severity,notification.content,notification.time_to_show);}}}};return my;}(Notifications));(function(){function nicetime(date){if(typeof(date)=='number'){date=new Date(date*1000);}
if(!date)return'';var diff=(((new Date()).getTime()-date.getTime())/1000),day_diff=Math.floor(diff/86400);if(isNaN(day_diff)||day_diff<0)
return'';return day_diff==0&&(diff<5&&"just now"||diff<60&&(Math.floor(diff)+' seconds ago')||diff<120&&"1 minute ago"||diff<3600&&Math.floor(diff/60)+" minutes ago"||diff<7200&&"1 hour ago"||diff<86400&&Math.floor(diff/3600)+" hours ago")||day_diff==1&&"Yesterday"||day_diff<7&&day_diff+" days ago"||day_diff<14&&"1 week ago"||day_diff<30&&Math.floor(day_diff/7)+" weeks ago"||day_diff<60&&"1 month ago"||Math.floor(day_diff/30)+" months ago";}
function nicetime_simple(date){if(typeof(date)=='number'){date=new Date(date*1000);}
if(!date)return'';var diff=(((new Date()).getTime()-date.getTime())/1000),day_diff=Math.floor(diff/86400);if(isNaN(day_diff)||day_diff<0)
return'';return day_diff==0&&(diff<5&&"now"||diff<60&&(Math.floor(diff)+'s')||diff<3600&&Math.floor(diff/60)+"m"||diff<86400&&Math.floor(diff/3600)+"h")||day_diff<7&&day_diff+"d"||day_diff<365&&Math.floor(day_diff/7)+"w"||Math.floor(day_diff/365)+"y";}
function nicetime_seen(date){if(typeof(date)=='number'){date=new Date(date*1000);}
if(!date)return'';var diff=(((new Date()).getTime()-date.getTime())/1000),day_diff=Math.floor(diff/86400);if(isNaN(day_diff)||day_diff<0){return'';}
date_info=date.toString().split(' ');var zone="",hour=date.getHours(),complete_time="";if(hour>=12){hour=hour-12;zone="PM";}else{zone="AM";}
if(hour==0){hour=12;}
minStr=date.getMinutes().toString();hour=hour.toString();complete_time=(hour.length==1?'0'+hour:hour)+':'+(minStr.length==1?'0'+minStr:minStr)+zone;return day_diff<=1&&complete_time||day_diff<7&&(date_info[0]+complete_time)||day_diff<365&&(date_info[1]+' '+date_info[2])||day_diff>365&&(date_info[1]+' '+date_info[2]+' \''+date_info[3].slice(2,4));}
function format_date(date,format_string){if(typeof(date)=='number'){date=new Date(date*1000);}else if(typeof(date)=='string'){try{date=new Date(date);}catch(e){return'';}}
if(!date)return'';if(!format_string)format_string="%a %b %d %Y";var mthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var zeroPad=function(number){return("0"+number).substr(-2,2);};var dateMarkers={d:['getDate',function(v){return zeroPad(v)}],m:['getMonth',function(v){return zeroPad(v+1)}],b:['getMonth',function(v){return mthNames[v];}],a:['getDay',function(v){return dayNames[v];}],Y:['getFullYear'],H:['getHours',function(v){return zeroPad(v)}],M:['getMinutes',function(v){return zeroPad(v)}],S:['getSeconds',function(v){return zeroPad(v)}],i:['toISOString']};return format_string.replace(/%(.)/g,function(m,p){var rv=date[(dateMarkers[p])[0]]();if(dateMarkers[p][1]!=null)rv=dateMarkers[p][1](rv);return rv;});}
function format_number(num,opt_prec){var precision=opt_prec;if(num==parseInt(num)){var rounded=opt_prec?+num.toPrecision(precision):+num;var characters=rounded.toString();var output='';for(var offset=characters.length;offset>0;offset-=3){output=characters.slice(Math.max(offset-3,0),offset)+(output?','+output:'');}
return output;}
if(precision&&num)return num.toFixed(precision);return num;}
function format_num_k(num,opt_prec){if(!num&&num!==0)return num;opt_prec=opt_prec||3;num=parseInt(num);if(num<1000)return''+num;if(num<10000)return format_number(num,opt_prec);if(num<1000000){num=+num.toPrecision(opt_prec)/1000;return num+'K';}
num=+num.toPrecision(opt_prec)/1000000;return num+'M';}
function format_duration(duration){if(!duration)return"0:00";duration=parseInt(duration);var mins=parseInt(duration/60);var secs=duration%60;return mins.toString()+':'+(secs<10?'0':'')+secs.toString();}
function pluralize(numbered_string){var pluralize_re=/([0-9]+)( *)([^ ]+)/;var match=pluralize_re.exec(numbered_string);if(!match){return numbered_string;}
match.splice(0,1);if(match[0]!='1'&&match[2][match[2].length-1]!='s'){match.push('s');}
pluralize_re=null;return match.join('');}
var GRID_LIST=['50l cb','25','25','25','25','75r cb','25','25','25'],GRID_LIST_MINI=['75l cb','25','25','25','50l cb','50l','75l cb'],MIX_GRID_LIST=['50l cb','25','25','25','25','25 cb','25','50r','25','25'];function grid_size(info){var grid_list=GRID_LIST;var array_length=info.array_length;if(array_length&&array_length<5){if(array_length==1){return'75l';}else if(array_length==2||array_length==4){return'50l';}else if(array_length==3){return info.index<2?'50l':'75l';}else{grid_list=GRID_LIST_MINI;}}
return grid_list[info.index%grid_list.length];}
function grid_size_mix(info){return MIX_GRID_LIST[info.index%MIX_GRID_LIST.length];}
var USER_THUMB_CDN='s.likes-media.com';function user_thumb(thumb_key,size){return get_thumb_url(thumb_key,size,USER_THUMB_CDN,'uimg');}
function get_thumb_url(thumb_key,size,cdn,dir_name){if(!thumb_key||thumb_key.match(/^http/)||(thumb_key.length!=32)||!thumb_key.match(/^[0-9a-f]+$/)){return thumb_key?thumb_key:'';}
if(size==null||size==undefined||size.length==0){size='';}else{size='.'+size;}
return'//'+cdn+'/'+dir_name+'/'+thumb_key+size;}
function breakwords(text){if(!text){return text;}
var words=text.split(/ +/);for(var i=0,l=words.length;i<l;i++){if(words[i].length>8){var parts=[];for(var j=0,wl=words[i].length;j<wl;j+=8){parts.push(escapeHTMLMustache(words[i].slice(j,j+8)));}
words[i]=parts.join('&shy;');}else{words[i]=escapeHTMLMustache(words[i]);}}
return words.join(' ');}
var USERNAME_RE=/(.*)@:([0-9]+):([a-zA-Z0-9_]+)(.*)/;function escape_and_link(text){var words=text.split(/ +/);for(var i=0,l=words.length;i<l;i++){var match=USERNAME_RE.exec(words[i]);if(match){words[i]=escapeHTMLMustache(match[1])+'<a class="bright-blue show_hover_card" user_id="'+match[2]+'" href="/'+match[3]+'">@'+match[3]+'</a>'+escapeHTMLMustache(match[4]);}else if(words[i].length>8){var parts=[];for(var j=0,wl=words[i].length;j<wl;j+=8){parts.push(escapeHTMLMustache(words[i].slice(j,j+8)));}
words[i]=parts.join('&shy;');}else{words[i]=escapeHTMLMustache(words[i]);}}
return words.join(' ');}
function get_from_context(contexts,name){if(typeof(contexts)=="object"&&contexts.length==undefined)return contexts[name];for(var i=0;i<contexts.length;i++){if(contexts[i]&&contexts[i][name]!==undefined)return contexts[i][name];}}
function push_context(context,contexts){if(contexts&&Array.isArray(contexts)){var new_contexts=contexts.slice();new_contexts.unshift(context);return new_contexts;}else if(contexts&&typeof(contexts)=="object"){return[context,contexts];}
return[context];}
function increment_forloop(forloop,item){forloop.index++;forloop.counter=forloop.index+1;forloop.first=forloop.index==0;forloop.last=forloop.array_length&&forloop.index==forloop.array_length-1;forloop.even=forloop.counter%2==0;forloop.odd=!forloop.even;forloop.item=item;}
function slice(obj){if(!obj)return obj;var args=Array.prototype.slice.call(arguments,1);return Array.prototype.slice.apply(obj,args);}
function count(obj,word,show_zero){if(obj===undefined)obj=0;var length=(typeof obj!='number')?obj.length:obj;if(length==0&&!show_zero){return'';}
if(!word)return length;return length+' '+word+(length!=1?'s':'');}
var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;'};function escapeHTMLMustache(string){return String(string).replace(/&(?!\w+;)|[<>\"\']/g,function(s){return escapeMap[s]||s;});}
function linkify(text,link_class){if(!(text||text.length))return text;link_class=link_class||'blue underline';var link_re=/(?:[A-Za-z]{3,5}:\/\/)(?:[A-Za-z0-9\-]+\.)?(?:[A-Za-z0-9\-]+\.)?(?:[A-Za-z0-9\-]+\.)?[A-Za-z0-9\-]+\.[A-Za-z]{2,3}(?:\/[^\s]+)?/g;function linky(match){return"<a href='"+match+"' target='_blank' onclick='window.open(this.href,'_blank');return false;' class='"+link_class+"'>"+match+"</a>";}
text=escapeHTMLMustache(text);return text.replace(link_re,linky);}
function linkify_tags(text,link_class){if(!(text||text.length))return text;link_class=link_class||'blue grid_tag underline';var tag_re=/#[0-9A-Za-z\-]+/g;function linky(match){return"<a href='/tagged/"+match.substring(1)+"' class='"+link_class+"'>"+match+"</a>";}
return text.replace(tag_re,linky);}
function number(text){return parseInt(text)||0;}
function nopad(url){return(url||'')+'.nopad';}
function noanim(url){return(url||'')+'.noanim';}
function truncate_html(html,opt_length,ellipsis){var len=opt_length||30,ellipsis=ellipsis||'...';var $div=$('<div>'+html+'</div>');if($div.text().length<=len)return html;while($div.text().length>len){html=html.slice(0,html.length-1).replace(/<[^>]*$/,'');$div.html(html);}
return $div.html()+ellipsis;}
var RTL_RE=/[\u0509-\u06ff]/g;function is_rtl(text){if(!text)return false;return RTL_RE.test(text);}
function translation_link(text,target_lang){if(!target_lang)target_lang='en';return"http://translate.google.com/#auto/"+target_lang+"/"+encodeURIComponent(text);}
function message_pic_sizing(message,max_width,max_height){if(!max_width)max_width=250;if(!max_height)max_height=250;if(!message||!message.width||!message.height){return'';}
var width=message['width'],height=message['height'];if(width>height){if(width>max_width){height=max_width*height/width;width=max_width;}}else{if(height>max_height){width=max_height*width/height;height=max_height;}}
return'width: '+width+'px; height: '+height+'px';}
function hex_to_rgba(value,alpha){value=value.replace('#','').trim();var parts=[];for(var i=0;i<3;i++){parts.push(parseInt(value.substring((i*2)+1,(i*2)+3),16));}
parts.push(alpha);return"rgba("+parts.join(',')+")"}
window.Jasinja={escape:function(html){if(typeof html=='string'){return escapeHTMLMustache(html);}else if(html&&html.is_safe){return html.html;}
return html;},"utils":{"extend":function(base,child){if(child==undefined)return base;var current={"blocks":{}};for(var key in base.blocks){if(!child.blocks[key]){current.blocks[key]=base.blocks[key];}else{current.blocks[key]=child.blocks[key];}}
return current;},"slice":function(val,start,stop){if(typeof(val)=="string"){return val.substring(start,stop);}else if(val instanceof Array){return val.slice(start,stop);}},"loop":function(iter){function LoopObject(){this.iter=iter;this.l=iter?iter.length:0;this.i=0;this.update=function(){if(arguments.length)this.i=arguments[0];this.index=this.i+1;this.index0=this.i;this.revindex=this.l-this.i;this.revindex0=this.l-this.i-1;this.first=!this.i;this.last=this.i==this.l-1;}
this.cycle=function(){return arguments[this.index0%arguments.length];};}
return new LoopObject();},"contains":function(n,hs){if(hs instanceof Array){for(var i=0;i<hs.length;i++){if(hs[i]==n)return true;}
return false;}else if(typeof(hs)=="string"){return!!hs.match(RegExp(n));}else if(typeof(hs)=="object"){return hs[n]!==undefined;}else{throw new TypeError("containment is undefined: "+n+" in "+JSON.stringify(hs));}},"strjoin":function(){var buf=[];for(var i=0;i<arguments.length;i++){buf.push(arguments[i].toString());}
return buf.join("");},"strmul":function(s,n){var buf=[];for(var i=0;i<n;i++){buf.push(s);}
return buf.join('');},},"filters":{safe:function(thing){return{html:thing,is_safe:1};},"attr":function(obj,name){return obj[name];},"abs":function(n){return Math.abs(n);},"batch":function(ls,num,fill){fill=fill===undefined?null:fill;var res=[];var tmp=[];for(var i=0;i<ls.length;i++){if(tmp.length==num){res.push(tmp);tmp=[];}
tmp.push(ls[i]);}
if(tmp.length&&tmp.length<num&&fill){for(var i=num-1;i>0;i--){tmp.push(fill);}}
if(tmp.length)res.push(tmp);return res;},"capitalize":function(s){s=s.toLowerCase();return s.charAt(0).toUpperCase()+s.substring(1);},"center":function(s,width){width=arguments[1]?width:80;var pre=Math.floor((width-s.length)/2);var post=Math.ceil((width-s.length)/2);var buf=[];for(var i=0;i<pre;i++){buf.push(' ');}
buf.push(s);for(var i=0;i<post;i++){buf.push(' ');}
return buf.join('');},"count":function(val){return Jasinja.filters['length'](val);},"d":function(val,alt,bool){bool=bool||false;if(!bool){return val!==undefined?val:alt;}else{return val?val:alt;}},"default":function(val,alt,bool){return Jasinja.filters.d(val,alt,bool);},"dictsort":function(val){var keys=this.list(val);keys.sort();var ls=[];for(var i=0;i<keys.length;i++){ls.push([keys[i],val[keys[i]]]);}
return ls;},"e":function(s){return this.escape(s);},"escape":function(s){s=s.replace('&','&amp;');s=s.replace('<','&lt;');s=s.replace('>','&gt;');s=s.replace('"','&#34;');s=s.replace("'",'&#39;');return s;},"forceescape":function(s){return this.escape(s);},"filesizeformat":function(val,binary){binary=arguments[1]?binary:false;var bytes=parseFloat(val);var base=binary?1024:1000;var middle=binary?'i':'';if(bytes<base){var multi=bytes==1?'':'s';return this.format("%i Byte%s",bytes,multi);}else if(bytes<base*base){return this.format("%.1f K%sB",bytes/base,middle);}else if(bytes<base*base*base){return this.format("%.1f M%sB",bytes/(base*base),middle);}
return this.format("%.1f G%sB",bytes/(base*base*base),middle);},"first":function(val){if(typeof(val)=="string"){return val.charAt(0);}else if(val instanceof Array){return val[0];}},"float":function(val){return parseFloat(val)||0.0;},"format":function(fmt){var vals=Array.prototype.slice.call(arguments,1);var regex=new RegExp('\%([0 ]?)((?:[0-9]+)?)(\.[0-9]+)?([fis%])');while(regex.test(fmt)){var parts=regex.exec(fmt);var ext=parts[1]?parts[1]:' ';var wantlen=parseInt(parts[2]);var type=parts[0].substring(parts[0].length-1);var val=vals.shift();if(type=="f"){val=parseFloat(val);if(parts[3]){val=val.toFixed(parseInt(parts[3].substring(1)));}else{val=val.toString();}
if(val.length<wantlen){val=Jasinja.utils.strmul(ext,wantlen-val.length)+val;}
fmt=fmt.replace(parts[0],val);}else if(type=="i"){val=parseInt(val).toString();if(val.length<wantlen){val=Jasinja.utils.strmul(ext,wantlen-val.length)+val;}
fmt=fmt.replace(parts[0],val);}else if(type=="s"){if(val.length<wantlen){val=Jasinja.utils.strmul(ext,wantlen-val.length)+val;}
fmt=fmt.replace(parts[0],val.toString());}else if(type=="%"){fmt=fmt.replace("%%","%");}}
return fmt;},"groupby":function(ls,attr){var groups={};for(var i=0;i<ls.length;i++){var key=ls[i][attr];if(!(key in groups))groups[key]=[];groups[key].push(ls[i]);}
var res=[];for(var key in groups){res.push({0:key,grouper:key,1:groups[key],list:groups[key]});}
return res;},"indent":function(s,w,first){w=w===undefined?4:w;first=first===undefined?false:first;var indent=Jasinja.utils.strmul(' ',w);var res=s.split('\n').join('\n'+indent);if(first)res=indent+res;return res;},"int":function(val){return Math.floor(val)||0;},"last":function(val){if(typeof(val)=="string"){return val.charAt(val.length-1);}else if(val instanceof Array){return val[val.length-1];}},"list":function(val){if(val instanceof Array){return val;}else if(typeof(val)=="string"){var ls=[];for(var i=0;i<val.length;i++){ls.push(val.charAt(i));}
return ls;}else if(typeof(val)=="object"){var ls=[];for(var key in val){ls.push(key);}
return ls;}else{throw new TypeError("containment is undefined");}},"lower":function(s){return s.toLowerCase();},"join":function(val,d){return val.join(d);},"random":function(ls){return ls[Math.floor(Math.random()*ls.length)]},"replace":function(s,o,n){return s.replace(o,n,'g');},"reverse":function(r){var c=r.slice(0);c.reverse();return c;},"round":function(val){var num=arguments[1]?arguments[1]:0;var mul=num?num*10:1;return Math.round(val*mul)/mul;},"slice":function(ls,num,fill){var ssize=Math.floor(ls.length/num);var extra=ls.length%num;var offset=0;var res=[];var offset=0;for(var i=0;i<num;i++){var start=offset+i*ssize;if(i<extra)offset+=1;var end=offset+(i+1)*ssize;var tmp=ls.slice(start,end);if(fill!==undefined&&i>=extra){tmp.push(fill);}
res.push(tmp);}
return res;},"sort":function(val){var c=val.slice(0);c.sort();return c;},"string":function(val){return val.toString();},"sum":function(ls,attrib,start){start=start===undefined?0:start;for(var i=0;i<ls.length;i++){if(attrib===undefined)start+=ls[i];else start+=ls[i][attrib];}
return start;},"title":function(s){return s.replace(/[a-zA-Z]+/g,this.capitalize);},"translation_link":translation_link,"message_pic_sizing":message_pic_sizing,"trim":function(s){return s.replace(/^\s+|\s+$/g,'');},"upper":function(s){return s.toUpperCase();},"wordcount":function(s){return s.split(/\s+/g).length;},"xmlattr":function(d,space){space=space===undefined?true:space;var tmp=[];for(var k in d){if(d[k]===null||d[k]===undefined)continue;tmp.push(this.format('%s="%s"',this.escape(k),this.escape(d[k])));}
var res=(space?' ':'')+tmp.join(' ');return res;},truncate:function(m,opt_length){if(m){var length=+opt_length||30;return m.length>length-3?m.substr(0,length-3)+'...':m;}
return m;},truncate_html:truncate_html,length:function(m){if(!m)return 0;if(m.length!==undefined)return m.length;var key_count=0;for(var key in m){if(m.hasOwnProperty(key))key_count++;}
return key_count;},is_context:function(m){return m&&(Array.isArray(m)||typeof m=="object");},is_not_context:function(m){return!Mustache.FILTERS.is_context(m);},quote_plus:function(m){return encodeURIComponent(m).replace(/%20/g,'+');},iter_items:function(m){var items=[];for(var key in m){if(m.hasOwnProperty(key)){items.push([key,m[key]]);}}
return items;},replace:function(m,opt_find,opt_replace){if(opt_find&&opt_replace!==undefined){return m.replace(opt_find,opt_replace);}
return m;},json:function(m){return JSON.stringify(m).replace(/<\//g,'<\\/');},child_tag:function(tag){return(tag.indexOf(':')!==-1)?tag.split(':')[1]:tag;},format_number:format_number,format_num_k:format_num_k,format_duration:format_duration,format_date:format_date,nicetime:nicetime,nicetime_simple:nicetime_simple,nicetime_seen:nicetime_seen,pluralize:pluralize,grid_size:grid_size,grid_size_mix:grid_size_mix,breakwords:breakwords,escape_and_link:escape_and_link,slice:slice,count:count,linkify:linkify,linkify_tags:linkify_tags,number:number,is_rtl:is_rtl,user_thumb:user_thumb,hex_to_rgba:hex_to_rgba,is_online:function(user_id){return window.RT&&window.RT.online_users[user_id];},in_list:function(obj,arr){if(!arr)return false;return arr.indexOf&&arr.indexOf(obj)>-1;},add_url_param:function(url,param){if(!param)return url;return(url.match(/[?]/)?'&':'?')+param;},escape_unsafe_tags:function(text){var WL=new RegExp("<br ?/?>|<b>|</b>|<p>|</p>|<i>|</i>","i");var last_index=0;var escaped_text='';text.replace(WL,function(tag,offset,string){escaped_text+=escapeHTMLMustache(text.substring(last_index,offset))+tag;last_index=offset+tag.length;});escaped_text+=escapeHTMLMustache(text.substring(last_index));return escaped_text;}},"tests":{"callable":function(val){return typeof(val)=="function";},"defined":function(val){return val!==undefined;},"divisibleby":function(val,num){return!(val%num);},"even":function(val){return this.divisibleby(val,2);},"lower":function(val){return val.toLowerCase()==val;},"none":function(val){return val===null;},"number":function(val){return typeof(val)=="number";},"odd":function(val){return!this.divisibleby(val,2);},"undefined":function(val){return val===undefined;},"upper":function(val){return val.toUpperCase()==val;},"string":function(val){return typeof(val)=="string";}},"templates":{"nsfw_overlay.html":{"macros":{},"blocks":{},"render":function(ctx,tmpl){tmpl=Jasinja.utils.extend(this,tmpl);var _buf=[];var locals={},loop;if(((!ctx.my_info.mature_session&&!ctx.image.nsfw_ok)&&!ctx.my_info.is_mature)){_buf.push('<div class="nsfw_overlay" image_id="');_buf.push(Jasinja.escape(ctx.image.image_id));_buf.push('">\n    <div class="floater"></div>\n    <div class="content textcenter">\n        NSFW\n    </div>\n</div>\n');}
return _buf.join("");}},"image_overlay.html":{"macros":{},"blocks":{},"render":function(ctx,tmpl){tmpl=Jasinja.utils.extend(this,tmpl);var _buf=[];var locals={},loop;_buf.push("<div class='image_overlay ");_buf.push(Jasinja.escape(ctx.image.classname));_buf.push(' ');if(ctx.page_state!='search'){_buf.push('full_banner');}
_buf.push("'>\n");if(ctx.image.type=='image'){if(ctx.page_state!='search'){if(ctx.image.user_name==ctx.my_info.user_name){if(ctx.view=='grid'){_buf.push('                    <span class="remove_image_button top_bar tooltip" title="Remove" image_id="');_buf.push(Jasinja.escape(ctx.image.image_id));_buf.push('"></span>\n');}}
_buf.push('\n            <div image_id="');_buf.push(Jasinja.escape(ctx.image.image_id));_buf.push('" class="overlay_like button ');if(!ctx.image.already_liked){_buf.push('blue_button ');}else{_buf.push(' blue_button_set set ');}
_buf.push(' like_image_button">\n                <span class="like_small like_icon floatleft"></span>\n                <span class="label">Like');if(ctx.already_liked){_buf.push('d');}
_buf.push('</span>\n            </div>\n');}
_buf.push('\n');if(ctx.portable_search){_buf.push('        <div class="floater"></div>\n        <div class="search_add_image button blue_button"><div class="reshare_small"></div>Add Image</div>\n');}}
_buf.push('</div>\n');return _buf.join("");}},"gallery_collage.html":{"macros":{},"blocks":{},"render":function(ctx,tmpl){tmpl=Jasinja.utils.extend(this,tmpl);var _buf=[];var locals={},loop;var _loopvar0=Jasinja.utils.loop(ctx.image.sub_images);for(_loopvar0.i=0;_loopvar0.i<_loopvar0.l;_loopvar0.i++){var sub=locals.sub=_loopvar0.iter[_loopvar0.i];loop=_loopvar0;loop.update();if(loop.first){_buf.push('        <div class="gallery_list_collage cols_');_buf.push(Jasinja.escape(Jasinja.filters.length(ctx.image.sub_images)));_buf.push('">\n');if(ctx.custom_profile){_buf.push('        <a href="');if(ctx.domain_url){_buf.push('http://');_buf.push(Jasinja.escape(ctx.domain_url));}
_buf.push('/');if(ctx.image.gallery_info){_buf.push(Jasinja.escape(ctx.image.path_name));if(ctx.image.post_id){_buf.push('?utm_campaign=ml&utm_term=');_buf.push(Jasinja.escape(ctx.image.post_id));}}
_buf.push('">\n');}}
_buf.push('            <div class="collage_image floatleft ');if(loop.last){_buf.push(' last');}
_buf.push('" style="background-image:url(\'');_buf.push(Jasinja.escape(sub.thumb_url));if(Jasinja.filters.length(ctx.images.sub_images)>1){_buf.push('.200x200.crop');}else{_buf.push('.600x');}
_buf.push('\');background-size:cover;background-position:center;" />\n            </div>\n');if(loop.last){_buf.push('        <div class="clear"></div>\n');if(ctx.custom_profile){_buf.push('                </a>\n');}
_buf.push('        </div>\n');}}
return _buf.join("");}},"linkified_comment.html":{"macros":{},"blocks":{},"render":function(ctx,tmpl){tmpl=Jasinja.utils.extend(this,tmpl);var _buf=[];var locals={},loop;if(ctx.caption){var _loopvar0=Jasinja.utils.loop(ctx.caption);for(_loopvar0.i=0;_loopvar0.i<_loopvar0.l;_loopvar0.i++){var row=locals.row=_loopvar0.iter[_loopvar0.i];loop=_loopvar0;loop.update();if(row.type=='nl'){_buf.push('<br />');}
if(row.type=='start_s'){_buf.push('<span class="');_buf.push(Jasinja.escape(row.style));_buf.push('">');}
if(row.type=='end_s'){_buf.push('</span>');}
if(row.type=='text'){if(row.emoji){_buf.push('<span class="emoji">');_buf.push(Jasinja.escape(Jasinja.filters.safe(row.content)));_buf.push('</span>');}else{_buf.push(Jasinja.escape(row.content));}}
if(row.type=='user'){if(row.user){_buf.push('<span class="hover_card_div"><a class="likes-blue underline show_hovercard" href="');_buf.push(Jasinja.escape(Jasinja.filters.profile(row.user.user_name)));_buf.push('" user_id="');_buf.push(Jasinja.escape(row.user.user_id));_buf.push('">');}
if((row.user&&row.user.name)){_buf.push(Jasinja.escape(row.user.name));}else{_buf.push(Jasinja.escape(row.content));}
if(row.user){_buf.push('</a></span>');}}
if(row.type=='url'){_buf.push('<a target="_blank" rel="nofollow" class="likes-blue underline" href="');if(row.full_url){_buf.push(Jasinja.escape(row.full_url));}else{_buf.push(Jasinja.escape(row.content));}
_buf.push('">');_buf.push(Jasinja.escape(row.content));_buf.push('</a>');}
if(row.type=='tag'){_buf.push('<a class="likes-blue underline" href="/tagged/');_buf.push(Jasinja.escape(Jasinja.filters.quote_plus(row.tag)));_buf.push('">');_buf.push(Jasinja.escape(row.content));_buf.push('</a>');}
if(row.type=='see_more_start'){_buf.push('<span class="comment_ellipses">... <a class="likes-blue underline tiny_link view_full_comment">See More</a></span><span class="long_comment" style="display:none;">');}
if(row.type=='see_more_end'){_buf.push('</span>');}}}
return _buf.join("");}},"fb_share_src.html":{"macros":{},"blocks":{},"render":function(ctx,tmpl){tmpl=Jasinja.utils.extend(this,tmpl);var _buf=[];var locals={},loop;if(ctx.share_app_id){_buf.push(' share_app_id="');_buf.push(Jasinja.escape(ctx.share_app_id));_buf.push('"');}else{_buf.push('href="https://www.facebook.com/sharer/sharer.php?u=');_buf.push(Jasinja.escape(Jasinja.filters.quote_plus(ctx.gallery_share_url)));_buf.push('" onclick="window.open($(this).attr(\'href\'),\'fb_popup\',\'width=600,height=310\');return false;" ');}
_buf.push(' gallery_share_url="');_buf.push(Jasinja.escape(Jasinja.filters.quote_plus(ctx.gallery_share_url)));_buf.push('"\n');return _buf.join("");}}}};var Mustache=window.Mustache=window.Mustache||{};Mustache.FILTERS=Mustache.FILTERS||Jasinja.filters;function include_mustache(ctx,tmpl,name,context){var data=$.extend({},ctx||{},context||{});return ich[name](data,true);}
var jinja=window.jinja=window.jinja||{};for(var name in Jasinja.templates){(function(name,func){if(Jasinja.templates.hasOwnProperty(name)){jinja[name.replace(/(^.*\/|\.html$)/g,'')]=function(data,raw){if(window.$)data=$.extend({},window.global_ich_data||{},data||{});func.macros={include_mustache:include_mustache};var result=func.render(data);return(window.$&&!raw)?$(result):result;};}})(name,Jasinja.templates[name]);}})();